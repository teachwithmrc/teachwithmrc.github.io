<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Word Mapping Generator</title>
    <script src="newtry_FIXED-3.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'BoxesFont';
            src: url('fonts/boxes.ttf') format('truetype');
        }
        body {
            font-family: 'Poppins', sans-serif;
            margin: 40px;
            text-align: center;
        }
        h1 { font-size: 36px; margin-bottom: 5px; }
        h2 { font-size: 20px; margin-bottom: 20px; }
        .table-section {
            border: 2px solid #000;
            padding: 20px;
            margin: 12px auto;
            width: fit-content;
            box-sizing: border-box;
        }
        .section-label {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 12px;
        }
        .skill-button {
            border: 2px solid #000;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
            margin: 5px;
        }
        .skill-button.selected {
            background-color: #007bff;
            color: white;
            box-shadow: 0 0 4px rgba(0, 123, 255, 0.5);
        }
        .option-box {
            padding: 10px 14px;
            border: 2px solid #000;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            display: inline-block;
        }
        .option-box.selected {
            background-color: #d9c9ff;
        }
        .page { 
            display: flex; 
            justify-content: space-between; 
            page-break-after: always; 
            margin-top: 30px;
        }
        .column { 
            display: flex; 
            flex-direction: column; 
            justify-content: space-around; 
        }
        .block { 
            margin-bottom: 40px; 
            text-align: center; 
        }
        .word { 
            font-size: 28px; 
            font-weight: 600; 
        }
        .pattern { 
            font-size: 40px; 
            font-family: 'BoxesFont', monospace;
        }
        #error-message {
            color: red;
            margin: 10px;
            min-height: 20px;
        }
        @media print {
            body { margin: 0; }
            h1, h2, .table-section, button, #error-message { display: none; }
            #output { margin: 0; }
            .page { width: 100%; display: flex; justify-content: space-between; }
        }
    </style>
</head>
<body>
    <h1>Word Mapping</h1>
    <h2>Skill: <span id="selected-skills"></span></h2>
    <div id="error-message"></div>

    <div class="table-section">
        <div class="section-label">Step 1: Select a Skill</div>
        <button class="skill-button" data-skill="Short A" aria-label="Select Short A skill">Short A</button>
        <button class="skill-button" data-skill="Short O" aria-label="Select Short O skill">Short O</button>
        <button class="skill-button" data-skill="FLSZ Words" aria-label="Select FLSZ Words skill">FLSZ Words</button>
    </div>

    <div class="table-section">
        <div class="section-label">Step 2: Options</div>
        <div class="option-box" id="includeBlendsOption" role="button" tabindex="0" aria-label="Toggle include blends">Include Blends?</div>
    </div>

    <div class="table-section">
        <div class="section-label">Step 3: Generate & Print</div>
        <button onclick="generatePage()" style="font-size: 18px; padding: 10px 24px;">Generate</button>
        <button onclick="window.print()" style="font-size: 18px; padding: 10px 24px;">Print</button>
    </div>

    <div id="output"></div>

    <script>
        let currentSkill = "";
        let includeBlends = false;

        const skillButtons = document.querySelectorAll('.skill-button');
        skillButtons.forEach(button => {
            button.addEventListener('click', () => {
                skillButtons.forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                currentSkill = button.dataset.skill;
                document.getElementById('selected-skills').innerText = currentSkill;
                document.getElementById('error-message').innerText = '';
            });
        });

        document.getElementById('includeBlendsOption').addEventListener('click', function () {
            includeBlends = !includeBlends;
            this.classList.toggle('selected', includeBlends);
        });

        document.getElementById('includeBlendsOption').addEventListener('keydown', function (e) {
            if (e.key === 'Enter' || e.key === ' ') {
                includeBlends = !includeBlends;
                this.classList.toggle('selected', includeBlends);
                e.preventDefault();
            }
        });

        function getWordsForSkill(skill, blends) {
            let list = soundBoxWords[skill] || [];
            if (blends) {
                const blendsKey = skill + " with Blends";
                if (soundBoxWords[blendsKey]) {
                    list = list.concat(soundBoxWords[blendsKey]);
                } else {
                    console.warn(`No blends found for ${blendsKey}`);
                }
            }
            return shuffle(list);
        }

        function generatePage() {
            document.getElementById('error-message').innerText = '';
            if (!currentSkill) {
                document.getElementById('error-message').innerText = "Please select a skill first.";
                return;
            }
            if (!window.soundBoxWords) {
                document.getElementById('error-message').innerText = "⚠️ Word data not loaded. Check your script path.";
                return;
            }
            let words = getWordsForSkill(currentSkill, includeBlends);
            if (words.length === 0) {
                document.getElementById('error-message').innerText = `No words found for skill: ${currentSkill}`;
                return;
            }
            if (words.length < 8) {
                document.getElementById('error-message').innerText = `Only ${words.length} words available for ${currentSkill}. Displaying all.`;
                words = shuffle(words);
            } else {
                words = shuffle(words).slice(0, 8);
            }
            const output = document.getElementById('output');
            output.innerHTML = "";
            const page = document.createElement('div');
            page.className = "page";
            const col1 = document.createElement('div');
            col1.className = "column";
            const col2 = document.createElement('div');
            col2.className = "column";
            words.forEach((entry, idx) => {
                const block = document.createElement('div');
                block.className = 'block';
                block.innerHTML = `
                    <div class="word">${entry.word}</div>
                    <div class="pattern">${entry.pattern}</div>
                `;
                if (idx < 4) col1.appendChild(block);
                else col2.appendChild(block);
            });
            page.appendChild(col1);
            page.appendChild(col2);
            output.appendChild(page);
        }

        function shuffle(arr) {
            return [...arr].sort(() => Math.random() - 0.5);
        }
    </script>
</body>
</html>
