<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ultimate Word Mapping Generator</title>
  <script src="newtry_FULL.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    @font-face {
      font-family: 'BoxesFont';
      src: url('fonts/boxes2.otf') format('truetype');
    }

    :root{
      --ink:#1f365f;
      --panel-blue:#e6eefc;
      --panel-peach:#fde8db;
      --panel-mint:#e8f6ef;
      --panel-lilac:#efe9ff;
      --panel-sand:#fff2d9;
      --white:#fff;
      --radius:18px;
    }

    body { font-family: 'Poppins', sans-serif; margin: 36px; text-align: center; color:#0a0a0a; }
    h1 { font-size: 36px; margin-bottom: 6px; font-weight: 800; }
    h2 { font-size: 18px; margin: 0 0 18px; font-weight: 600; }

    .controls { max-width: 1100px; margin: 0 auto; }

    /* Panel shell */
    .skill-group{
      border:3px solid var(--ink);
      border-radius: var(--radius);
      margin:14px auto;
      max-width:1100px;
      overflow:hidden;
      box-shadow: 0 2px 0 rgba(31,54,95,.08);
      text-align:left;
    }
    .skill-group .group-header{
      display:flex; align-items:center; justify-content:center;
      padding:18px 20px;
      font-weight:800; font-size:22px; letter-spacing:.3px;
      cursor:pointer; user-select:none;
      border-bottom:3px solid var(--ink);
    }
    .skill-group.blue  .group-header{ background:var(--panel-blue); }
    .skill-group.peach .group-header{ background:var(--panel-peach); }
    .skill-group.mint  .group-header{ background:var(--panel-mint); }
    .skill-group.lilac .group-header{ background:var(--panel-lilac); }
    .skill-group.sand  .group-header{ background:var(--panel-sand); }

    .group-header::after{
      content:"â–¾"; margin-left:10px; transform:translateY(-1px) rotate(0deg);
      transition:.2s transform;
    }
    .skill-group.open .group-header::after{ transform:translateY(-1px) rotate(180deg); }

    .group-content{
      display:none;
      background:#fff;
      padding:14px 18px 18px;
      text-align:center;           /* <-- center the choices */
    }
    .skill-group.open .group-content{ display:block; }

    /* White pill buttons */
    .skill-pill{
      display:inline-block;
      background:var(--white);
      border:3px solid var(--ink);
      border-radius:14px;
      padding:10px 16px;
      margin:8px;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.6);
      transition: transform .05s ease, background .2s, color .2s, box-shadow .2s;
    }
    .skill-pill:active{ transform: scale(.98); }
    .skill-pill.selected{
      background:#1f6feb;
      color:#fff;
      box-shadow: 0 0 0 3px rgba(31,111,235,.2);
    }

    /* Step panels */
    .table-section { border: 2px solid #000; padding: 16px; margin: 16px auto; width: fit-content; box-sizing: border-box; text-align: left; border-radius: 10px; }
    .section-label { font-weight: 700; font-size: 16px; margin-bottom: 10px; text-align: center; }

    .option-grid { display: flex; justify-content: center; flex-wrap: wrap; gap: 12px; margin-top: 8px; }
    .option-box { padding: 10px 14px; border: 2px solid #000; border-radius: 10px; cursor: pointer; font-weight: 700; }
    .option-box.selected { background-color: #d9c9ff; }

    /* Worksheet Layout */
    .word-table { width: 100%; border-collapse: collapse; margin-top: 20px; border: 2px solid black; }
    .word-table td { width: 50%; text-align: center; vertical-align: middle; padding: 10px 0; border: 2px solid black; }

    .worksheet-title { font-size: 40px; margin-bottom: 5px; font-weight: 800; }
    .worksheet-directions { font-size: 22px; margin-bottom: 20px; }

    .word { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
    .pattern {
      font-size: 60px;
      transform: scale(1.5);
      display: inline-block;
      font-family: 'BoxesFont', monospace;
      font-weight: normal;
      line-height: 1;
    }

    @media print {
      body { margin: 0; }
      h1, h2, .controls, .table-section, button { display: none !important; }
      #output { margin: 0; }
      .worksheet-title, .worksheet-directions { display: block; text-align: center; }
    }
  </style>
</head>
<body>
  <h1>Word Mapping Generator</h1>
  <h2>Skills: <span id="selected-skills"></span></h2>

  <div class="controls">

    <!-- Short Vowels -->
    <div class="skill-group blue" data-group="short-vowels">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-short-vowels" aria-expanded="true">
        Short Vowels
      </div>
      <div id="g-short-vowels" class="group-content" role="region">
        <button class="skill-pill" data-skill="Short A">Short A</button>
        <button class="skill-pill" data-skill="Short E">Short E</button>
        <button class="skill-pill" data-skill="Short I">Short I</button>
        <button class="skill-pill" data-skill="Short O">Short O</button>
        <button class="skill-pill" data-skill="Short U">Short U</button>
        <button class="skill-pill" data-skill="Mixed CVC">Mixed CVC</button>
        <button class="skill-pill" data-skill="FLSZ Words">FLSZ</button>
      </div>
    </div>

    <!-- Digraphs -->
    <div class="skill-group peach" data-group="digraphs">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-digraphs" aria-expanded="true">
        Digraphs
      </div>
      <div id="g-digraphs" class="group-content" role="region">
        <button class="skill-pill" data-skill="Digraph(ck)">ck</button>
        <button class="skill-pill" data-skill="Digraph(sh)">sh</button>
        <button class="skill-pill" data-skill="Digraph(th)">th</button>
        <button class="skill-pill" data-skill="Digraph(ch)">ch</button>
        <button class="skill-pill" data-skill="Digraph(wh)">wh</button>
        <button class="skill-pill" data-skill="Digraphs Mixed">Digraphs Mixed</button>
      </div>
    </div>

    <!-- Glued Sounds -->
    <div class="skill-group mint" data-group="glued">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-glued" aria-expanded="true">
        Glued Sounds
      </div>
      <div id="g-glued" class="group-content" role="region">
        <button class="skill-pill" data-skill="Glued(all)">-all</button>
        <button class="skill-pill" data-skill="Glued(-ng)">-ng</button>
        <button class="skill-pill" data-skill="Glued(-nk)">-nk</button>
        <button class="skill-pill" data-skill="Glued Mixed">Glued Mixed</button>
      </div>
    </div>

    <!-- Silent E (VCe) -->
    <div class="skill-group lilac" data-group="vce">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-vce" aria-expanded="true">
        Silent E (VCe)
      </div>
      <div id="g-vce" class="group-content" role="region">
        <button class="skill-pill" data-skill="VCe(a_e)">a_e</button>
        <button class="skill-pill" data-skill="VCe(i_e)">i_e</button>
        <button class="skill-pill" data-skill="VCe(o_e)">o_e</button>
        <button class="skill-pill" data-skill="VCe(u_e)">u_e</button>
        <button class="skill-pill" data-skill="Mixed VCe">Mixed VCe</button>
      </div>
    </div>

    <!-- R-Controlled -->
    <div class="skill-group sand" data-group="r-controlled">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-rctrl" aria-expanded="false">
        R-Controlled
      </div>
      <div id="g-rctrl" class="group-content" role="region">
        <button class="skill-pill" data-skill="R-Controlled(ar)">ar</button>
        <button class="skill-pill" data-skill="R-Controlled(or)">or</button>
        <button class="skill-pill" data-skill="R-Controlled(er,ir,ur)">er/ir/ur</button>
        <button class="skill-pill" data-skill="Mixed R-Controlled">Mixed R-Controlled</button>
      </div>
    </div>

    <!-- Vowel Teams -->
    <div class="skill-group blue" data-group="vowel-teams">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-vowel-teams" aria-expanded="false">
        Vowel Teams
      </div>
      <div id="g-vowel-teams" class="group-content" role="region">
        <button class="skill-pill" data-skill="Long A">Long A (ai/ay)</button>
        <button class="skill-pill" data-skill="Long E">Long E (ee/ea)</button>
        <button class="skill-pill" data-skill="Long I">Long I (igh/-y/ie)</button>
        <button class="skill-pill" data-skill="Long O">Long O (oa/ow/oe)</button>
        <button class="skill-pill" data-skill="Long U">Long U (oo/ew/ue)</button>
        <button class="skill-pill" data-skill="Mixed Vowel Teams">Mixed Vowel Teams</button>
      </div>
    </div>

    <!-- Diphthongs -->
    <div class="skill-group peach" data-group="diphthongs">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-diph" aria-expanded="false">
        Diphthongs
      </div>
      <div id="g-diph" class="group-content" role="region">
        <button class="skill-pill" data-skill="oy/oi">oy/oi</button>
        <button class="skill-pill" data-skill="ow/ou">ow/ou</button>
      </div>
    </div>

    <!-- Variant Vowels -->
    <div class="skill-group mint" data-group="variant-vowels">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-variant" aria-expanded="false">
        Variant Vowels
      </div>
      <div id="g-variant" class="group-content" role="region">
        <button class="skill-pill" data-skill="au/aw">au/aw</button>
        <button class="skill-pill" data-skill="oo">oo</button>
      </div>
    </div>

    <!-- Soft C & G -->
    <div class="skill-group lilac" data-group="soft-cg">
      <div class="group-header" role="button" tabindex="0" aria-controls="g-soft" aria-expanded="false">
        Soft C & G
      </div>
      <div id="g-soft" class="group-content" role="region">
        <button class="skill-pill" data-skill="Soft Endings">-ce/-ge/-dge</button>
        <button class="skill-pill" data-skill="Soft C">Soft C (ce/ci/cy)</button>
        <button class="skill-pill" data-skill="Soft G">Soft G (ge/gi/gy)</button>
      </div>
    </div>

    <!-- Step 2: Include Blends -->
    <div class="table-section">
      <div class="section-label">Step 2: Include Blends?</div>
      <div class="option-grid">
        <div class="option-box" id="includeBlendsYes">Yes (4+ sounds)</div>
        <div class="option-box" id="includeBlendsNo">No (3 sounds)</div>
      </div>
    </div>

    <!-- Step 3: Generate & Print -->
    <div class="table-section">
      <div class="section-label">Step 3: Generate & Print</div>
      <button onclick="generatePage()" style="font-size: 18px; padding: 10px 24px;">Generate</button>
      <button onclick="window.print()" style="font-size: 18px; padding: 10px 24px;">Print</button>
    </div>
  </div>

  <div id="output"></div>

  <script>
    // ---------- Panel toggling (no accordion; panels act independently) ----------
    document.addEventListener('click', (e)=>{
      const header = e.target.closest('.group-header');
      if(!header) return;
      const group = header.parentElement;
      const willOpen = !group.classList.contains('open');
      group.classList.toggle('open', willOpen);
      header.setAttribute('aria-expanded', String(willOpen));
    });

    // Open up to VCe on load
    ['short-vowels','digraphs','glued','vce'].forEach(key=>{
      const grp = document.querySelector(`.skill-group[data-group="${key}"]`);
      if (grp) {
        grp.classList.add('open');
        const header = grp.querySelector('.group-header');
        if (header) header.setAttribute('aria-expanded','true');
      }
    });

    // ---------- Skill selection ----------
    let selectedSkills = new Set();
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.skill-pill');
      if(!btn) return;
      const skill = btn.dataset.skill;
      if(selectedSkills.has(skill)){ selectedSkills.delete(skill); btn.classList.remove('selected'); }
      else{ selectedSkills.add(skill); btn.classList.add('selected'); }
      document.getElementById('selected-skills').textContent = Array.from(selectedSkills).join(', ');
    });

    // ---------- Blends toggle ----------
    let includeBlends = null;
    document.getElementById('includeBlendsYes').addEventListener('click', function(){
      includeBlends = true; this.classList.add('selected');
      document.getElementById('includeBlendsNo').classList.remove('selected');
    });
    document.getElementById('includeBlendsNo').addEventListener('click', function(){
      includeBlends = false; this.classList.add('selected');
      document.getElementById('includeBlendsYes').classList.remove('selected');
    });

    // ---------- Generator ----------
    function shuffle(arr){ return [...arr].sort(()=>Math.random() - 0.5); }

    function generatePage() {
      if (selectedSkills.size === 0) return alert("Select at least one skill!");
      if (includeBlends === null) return alert("Please choose Include Blends: Yes or No");
      if (typeof soundBoxWords === 'undefined') {
        alert("Missing data: soundBoxWords (check newtry_FULL.js is loaded).");
        return;
      }

      const source = soundBoxWords;
      let allWords = [];
      selectedSkills.forEach(skill => { allWords = allWords.concat(getWordsForSkill(skill, source, includeBlends)); });
      if (allWords.length === 0) return alert("No words found for the selected skills.");

      while (allWords.length < 8) allWords = allWords.concat(allWords);
      allWords = shuffle(allWords).slice(0, 8);

      const output = document.getElementById('output');
      output.innerHTML = '';

      const title = document.createElement('div');
      title.className = 'worksheet-title';
      title.textContent = `${Array.from(selectedSkills).join(', ')} Word Mapping`;

      const directions = document.createElement('div');
      directions.className = 'worksheet-directions';
      directions.textContent = "Read each word, write it in the sound boxes correctly, read it again.";

      output.appendChild(title);
      output.appendChild(directions);

      const table = document.createElement('table');
      table.className = 'word-table';
      for (let r = 0; r < 4; r++) {
        const tr = document.createElement('tr');
        for (let c = 0; c < 2; c++) {
          const td = document.createElement('td');
          const idx = r * 2 + c;
          if (idx < allWords.length) {
            td.innerHTML = `
              <div class="word">${allWords[idx].word}</div>
              <div class="pattern">${allWords[idx].pattern}</div>
            `;
          }
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
      output.appendChild(table);
    }

    /** Unified skill fetch with Blend logic **/
    function getWordsForSkill(skill, source, blends) {
      const blendSuffixes = [" with Blends", " with Digraphs and Blends"];
      const glueNgParts = ["ang", "ing", "ong", "ung"];
      const glueNkParts = ["ank", "ink", "onk", "unk"];

      function fetchSet(base) {
        if (!blends) return source[base] || [];
        let result = [];
        blendSuffixes.forEach(suffix => {
          const key = `${base}${suffix}`;
          if (source[key]) result = result.concat(source[key]);
        });
        return result;
      }

      switch (skill) {
        case "Short A": return fetchSet("Short A");
        case "Short E": return fetchSet("Short E");
        case "Short I": return fetchSet("Short I");
        case "Short O": return fetchSet("Short O");
        case "Short U": return fetchSet("Short U");
        case "Mixed CVC":
          return [].concat(fetchSet("Short A"), fetchSet("Short E"), fetchSet("Short I"), fetchSet("Short O"), fetchSet("Short U"));

        case "Digraph(ck)": return fetchSet("Digraph(ck)");
        case "Digraph(sh)": return fetchSet("Digraph(sh)");
        case "Digraph(th)": return fetchSet("Digraph(th)");
        case "Digraph(ch)": return fetchSet("Digraph(ch)");
        case "Digraph(wh)": return fetchSet("Digraph(wh)");
        case "Digraphs Mixed":
          return [].concat(fetchSet("Digraph(ck)"), fetchSet("Digraph(sh)"), fetchSet("Digraph(th)"), fetchSet("Digraph(ch)"), fetchSet("Digraph(wh)"));

        case "Glued(all)": return fetchSet("Glued(all)");
        case "Glued(-ng)": return glueNgParts.flatMap(p => fetchSet(`Glued(${p})`));
        case "Glued(-nk)": return glueNkParts.flatMap(p => fetchSet(`Glued(${p})`));
        case "Glued Mixed":
          return [].concat(fetchSet("Glued(all)"), glueNgParts.flatMap(p => fetchSet(`Glued(${p})`)), glueNkParts.flatMap(p => fetchSet(`Glued(${p})`)));

        case "VCe(a_e)": return fetchSet("VCe(a_e)");
        case "VCe(i_e)": return fetchSet("VCe(i_e)");
        case "VCe(o_e)": return fetchSet("VCe(o_e)");
        case "VCe(u_e)": return fetchSet("VCe(u_e)");
        case "Mixed VCe":
          return [].concat(fetchSet("VCe(a_e)"), fetchSet("VCe(i_e)"), fetchSet("VCe(o_e)"), fetchSet("VCe(u_e)"));

        case "R-Controlled(ar)": return fetchSet("R-Controlled(ar)");
        case "R-Controlled(or)": return fetchSet("R-Controlled(or)");
        case "R-Controlled(er,ir,ur)": return fetchSet("R-Controlled(er,ir,ur)");
        case "Mixed R-Controlled":
          return [].concat(fetchSet("R-Controlled(ar)"), fetchSet("R-Controlled(or)"), fetchSet("R-Controlled(er,ir,ur)"));

        case "Long A": return fetchSet("Long A");
        case "Long E": return fetchSet("Long E");
        case "Long I": return fetchSet("Long I");
        case "Long O": return fetchSet("Long O");
        case "Long U": return fetchSet("Long U");
        case "Mixed Vowel Teams":
          return [].concat(fetchSet("Long A"), fetchSet("Long E"), fetchSet("Long I"), fetchSet("Long O"), fetchSet("Long U"));

        case "oy/oi": return fetchSet("oy/oi");
        case "ow/ou": return fetchSet("ow/ou");

        case "au/aw": return fetchSet("au/aw");
        case "oo": return fetchSet("oo");

        case "Soft Endings": return fetchSet("Soft Endings");
        case "Soft C": return fetchSet("Soft C");
        case "Soft G": return fetchSet("Soft G");

        default: return fetchSet(skill);
      }
    }
  </script>
</body>
</html>
