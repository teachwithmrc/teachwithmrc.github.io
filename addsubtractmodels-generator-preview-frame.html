<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add and Subtract with Manipulatives or Hundreds Chart - PREVIEW MODE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: "Poppins", sans-serif;
      background: #fff;
    }

    .frame-wrap {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      border: 0;
      background: #fff;
    }

    .live-frame {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
      background: #fff;
    }

    .preview-watermark {
      position: absolute;
      left: 0;
      right: 0;
      top: 420px;
      bottom: 0;
      z-index: 20;
      pointer-events: none;
      background: rgba(255, 255, 255, 0.06);
      background-image: url("data:image/svg+xml,%3Csvg width='250' height='250' viewBox='0 0 250 250' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='20' y='150' fill='%23000' opacity='0.14' transform='rotate(-45 125 125)' font-family='Poppins' font-weight='900' font-size='30'%3EPREVIEW MODE%3C/text%3E%3C/svg%3E");
    }

    .preview-shade {
      position: absolute;
      left: 0;
      right: 0;
      top: 520px;
      bottom: 0;
      z-index: 30;
      pointer-events: none;
      background: linear-gradient(
        to bottom,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.16) 38%,
        rgba(255,255,255,0.26) 100%
      );
      backdrop-filter: blur(0.9px);
      -webkit-backdrop-filter: blur(0.9px);
    }

    @media print {
      body { display: none !important; }
    }
  </style>
  <script src="preview_customize_toggle_injector.js" defer></script>
  <script src="preview_tryme_mobile_mode.js?v=20260226-tryme5" defer></script>
</head>
<body oncontextmenu="return false;">
  <div class="frame-wrap">
    <iframe
      id="liveFrame"
      class="live-frame"
      src="manipulatives_add_sub_generator.html?v=20260223-manip-live1"
      title="Add and Subtract with Manipulatives or Hundreds Chart Preview"
      loading="eager"
    ></iframe>

    <div class="preview-watermark" aria-hidden="true"></div>
    <div class="preview-shade" aria-hidden="true"></div>
  </div>

  <script>
    (function () {
      const liveFrame = document.getElementById("liveFrame");

      function blockedAction() {
        alert("This feature is locked in Preview Mode.\nPlease join membership for full worksheet access.");
      }

      function blockShortcuts(event) {
        const blocked = (event.ctrlKey || event.metaKey) && ["p", "s", "u"].includes(String(event.key || "").toLowerCase());
        if (blocked) {
          event.preventDefault();
          blockedAction();
        }
      }

      document.addEventListener("keydown", blockShortcuts);

      liveFrame.addEventListener("load", function () {
        try {
          const frameDoc = liveFrame.contentDocument || liveFrame.contentWindow.document;
          if (!frameDoc) return;
          const frameWin = liveFrame.contentWindow;

          function hideNode(node) {
            if (!node) return;
            node.style.display = "none";
          }

          frameDoc.addEventListener("contextmenu", function (e) {
            e.preventDefault();
          });

          frameDoc.addEventListener("keydown", function (e) {
            const blocked = (e.ctrlKey || e.metaKey) && ["p", "s", "u"].includes(String(e.key || "").toLowerCase());
            if (blocked) {
              e.preventDefault();
              blockedAction();
            }
          });

          const printBtn = frameDoc.getElementById("printBtn");
          if (printBtn) {
            printBtn.addEventListener("click", function (e) {
              e.preventDefault();
              blockedAction();
            }, true);
            hideNode(printBtn);
          }

          // Preview UI simplification:
          // Keep only Generate + visual mode (Base-10 / Hundreds Chart) + 2-digit + 2-digit setup.
          hideNode(frameDoc.querySelector(".op-switch"));
          hideNode(frameDoc.getElementById("chartOrderField"));
          hideNode(frameDoc.querySelector(".source-options"));
          hideNode(frameDoc.getElementById("customProblemPanel"));
          hideNode(frameDoc.querySelector(".options-box"));

          const pageLayoutField = frameDoc.getElementById("pageLayout")?.closest(".field");
          hideNode(pageLayoutField);

          const digitsA = frameDoc.getElementById("digitsA");
          const digitsB = frameDoc.getElementById("digitsB");
          const opAddBtn = frameDoc.getElementById("opAddBtn");
          const sourceRandom = frameDoc.getElementById("sourceRandom");
          const sourceCustom = frameDoc.getElementById("sourceCustom");
          const generateBtn = frameDoc.getElementById("generateBtn");

          if (opAddBtn) {
            opAddBtn.click();
          }

          if (sourceRandom && sourceCustom) {
            sourceRandom.checked = true;
            sourceCustom.checked = false;
            sourceRandom.dispatchEvent(new frameWin.Event("change", { bubbles: true }));
          }

          if (digitsA) {
            digitsA.dispatchEvent(new frameWin.Event("change", { bubbles: true }));
          }
          if (digitsB) {
            digitsB.dispatchEvent(new frameWin.Event("change", { bubbles: true }));
          }

          if (generateBtn) {
            setTimeout(function () { generateBtn.click(); }, 30);
          }

          const host = frameDoc.getElementById("worksheetHost");
          if (host) {
            host.style.filter = "blur(1.35px) saturate(0.9)";
          }

          const subtitle = frameDoc.querySelector(".screen-only .subtitle");
          if (subtitle) {
            subtitle.textContent = "Preview mode: Choose digits and Base-10 Blocks or Hundreds Chart, then Generate.";
          }
        } catch (err) {
          // If browser blocks frame scripting, fallback still shows lock overlays.
        }
      });
    })();
  </script>
</body>
</html>
