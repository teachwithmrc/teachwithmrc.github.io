<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mobile Generator Wrapper</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&amp;display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #edf4fb;
      --panel: #ffffff;
      --line: #bed0e3;
      --ink: #103052;
      --muted: #4c6580;
      --accent: #2f79b8;
      --soft: #e9f3ff;
      --shadow: 0 10px 24px rgba(16, 48, 82, 0.12);
    }

    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", sans-serif;
      color: var(--ink);
      background: var(--bg);
      height: 100%;
    }

    .shell {
      width: min(1180px, calc(100% - 16px));
      margin: 8px auto;
      background: var(--panel);
      border: 2px solid var(--line);
      border-radius: 12px;
      box-shadow: var(--shadow);
      overflow: hidden;
      min-height: calc(100dvh - 16px);
      display: grid;
      grid-template-rows: auto auto 1fr;
    }

    .head {
      padding: 10px 10px 8px;
      background: linear-gradient(140deg, #f4f9ff, #eaf3fe);
      border-bottom: 2px solid #d3e2f1;
    }

    .title {
      margin: 0;
      font-size: clamp(1rem, 2.8vw, 1.25rem);
      line-height: 1.2;
      font-weight: 800;
      color: #153e66;
    }

    .src {
      margin: 6px 0 0;
      font-size: 0.77rem;
      color: var(--muted);
      word-break: break-all;
      line-height: 1.35;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      padding: 8px 10px;
      border-bottom: 2px solid #d3e2f1;
      background: #fff;
    }

    .btn {
      height: 36px;
      border: 2px solid #a9c6e4;
      border-radius: 10px;
      background: #f7fbff;
      color: #134069;
      font: inherit;
      font-size: 0.8rem;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0 8px;
    }

    .btn.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .viewer {
      position: relative;
      background: #f3f8ff;
    }

    #generatorFrame {
      width: 100%;
      height: calc(100dvh - 176px);
      border: 0;
      background: #fff;
      display: block;
    }

    .notice {
      margin: 0;
      padding: 8px 10px;
      font-size: 0.75rem;
      color: #5a728d;
      line-height: 1.35;
      border-top: 2px solid #d3e2f1;
      background: #f7fbff;
    }

    @media (min-width: 760px) {
      .controls {
        grid-template-columns: repeat(6, minmax(0, 1fr));
      }
      #generatorFrame {
        height: calc(100dvh - 170px);
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <header class="head">
      <h1 id="pageTitle" class="title">Mobile Generator</h1>
      <p id="sourcePath" class="src">Loading...</p>
    </header>

    <div class="controls">
      <a class="btn" href="../mobile_nav_hub_v1.html">Back to Mobile Hub</a>
      <a id="openOriginalBtn" class="btn primary" href="#" target="_blank" rel="noopener">Open Original</a>
      <button id="zoomOutBtn" class="btn" type="button">Zoom -</button>
      <button id="zoomResetBtn" class="btn" type="button">Zoom 100%</button>
      <button id="zoomInBtn" class="btn" type="button">Zoom +</button>
      <button id="refreshBtn" class="btn" type="button">Refresh</button>
    </div>

    <main class="viewer">
      <iframe id="generatorFrame" title="Mobile Generator Content" loading="lazy"></iframe>
      <p id="notice" class="notice">Mobile mode is active. If a page still looks crowded, use Zoom controls.</p>
    </main>
  </div>

  <script>
    const frame = document.getElementById("generatorFrame");
    const pageTitle = document.getElementById("pageTitle");
    const sourcePath = document.getElementById("sourcePath");
    const openOriginalBtn = document.getElementById("openOriginalBtn");
    const notice = document.getElementById("notice");
    const zoomOutBtn = document.getElementById("zoomOutBtn");
    const zoomResetBtn = document.getElementById("zoomResetBtn");
    const zoomInBtn = document.getElementById("zoomInBtn");
    const refreshBtn = document.getElementById("refreshBtn");

    const params = new URLSearchParams(window.location.search);
    const rawSrc = params.get("src") || "";
    const rawTitle = params.get("title") || "";

    function humanizePath(path) {
      return path
        .replace(/^(\.\.\/)+/, "")
        .replace(/\.html?$/i, "")
        .replace(/[_-]+/g, " ")
        .replace(/\s+/g, " ")
        .trim()
        .replace(/\b\w/g, (m) => m.toUpperCase());
    }

    function isSafeSrc(src) {
      return /^[a-zA-Z0-9_./-]+(\.html?)?(\?.*)?$/.test(src);
    }

    if (!rawSrc || !isSafeSrc(rawSrc)) {
      pageTitle.textContent = "Invalid Generator Path";
      sourcePath.textContent = "Missing or invalid src query parameter.";
      openOriginalBtn.setAttribute("disabled", "disabled");
      notice.textContent = "Use a generated mobile link from /mobile_generators/index.html.";
      throw new Error("Invalid src query");
    }

    const title = rawTitle || humanizePath(rawSrc);
    let zoom = 1;

    pageTitle.textContent = title + " (Mobile)";
    sourcePath.textContent = rawSrc;
    openOriginalBtn.href = rawSrc;
    frame.src = rawSrc;

    function applyMobileOverrides() {
      try {
        const doc = frame.contentDocument;
        if (!doc) return;

        let viewportMeta = doc.querySelector('meta[name="viewport"]');
        if (!viewportMeta) {
          viewportMeta = doc.createElement("meta");
          viewportMeta.setAttribute("name", "viewport");
          const head = doc.head || doc.documentElement;
          head.appendChild(viewportMeta);
        }
        viewportMeta.setAttribute("content", "width=device-width, initial-scale=1");

        if (!doc.getElementById("mobile-wrapper-overrides")) {
          const style = doc.createElement("style");
          style.id = "mobile-wrapper-overrides";
          style.textContent = [
            "html, body { max-width: 100% !important; overflow-x: auto !important; }",
            "body { margin: 8px !important; padding: 0 !important; }",
            "img, canvas, video, svg { max-width: 100% !important; height: auto !important; }",
            "table { max-width: 100% !important; }",
            "input, select, textarea, button { font-size: 16px !important; }"
          ].join("\n");
          (doc.head || doc.documentElement).appendChild(style);
        }

        if (doc.body) doc.body.style.zoom = String(zoom);
      } catch (_err) {
        notice.textContent = "Loaded, but advanced mobile overrides were not available for this page.";
      }
    }

    function setZoom(nextZoom) {
      zoom = Math.max(0.7, Math.min(1.35, nextZoom));
      applyMobileOverrides();
      notice.textContent = "Zoom: " + Math.round(zoom * 100) + "%";
    }

    frame.addEventListener("load", () => {
      applyMobileOverrides();
      notice.textContent = "Mobile mode is active. Zoom: " + Math.round(zoom * 100) + "%";
    });

    zoomOutBtn.addEventListener("click", () => setZoom(zoom - 0.1));
    zoomResetBtn.addEventListener("click", () => setZoom(1));
    zoomInBtn.addEventListener("click", () => setZoom(zoom + 0.1));
    refreshBtn.addEventListener("click", () => {
      frame.src = rawSrc;
    });
  </script>
</body>
</html>
