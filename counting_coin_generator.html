<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Counting Coins Generator</title>
  <style>
    :root {
      --ink: #1b1b1b;
      --line: #d7d7d7;
      --bg: #f8f8fb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px;
      font-family: Arial, Helvetica, sans-serif;
      color: var(--ink);
      background: #fff;
    }

    .app { max-width: 980px; margin: 0 auto; }

    h1 {
      margin: 0 0 6px;
      text-align: center;
      font-size: 1.8rem;
    }

    .subtitle {
      text-align: center;
      margin: 0 0 12px;
      color: #555;
      font-size: 0.95rem;
    }

    .controls {
      border: 2px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      display: grid;
      gap: 10px;
      background: var(--bg);
      margin-bottom: 12px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      align-items: center;
    }

    .field {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
    }

    input[type="number"], select, button { font: inherit; }
    input[type="number"] { width: 84px; padding: 4px 6px; }

    .coin-select {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .coin-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid #cfcfcf;
      border-radius: 999px;
      padding: 6px 10px;
      background: #fff;
      font-size: 0.92rem;
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    button {
      border: 1px solid #333;
      background: #fff;
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      font-weight: 700;
    }

    button.primary {
      background: #111;
      color: #fff;
    }

    .sheet {
      border: 2px solid var(--line);
      border-radius: 12px;
      padding: 14px;
    }

    .sheet-header {
      border-bottom: 2px solid #bdbdbd;
      padding-bottom: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: end;
    }

    .title {
      margin: 0;
      font-size: 1.55rem;
      font-weight: 800;
    }

    .directions {
      margin: 4px 0 0;
      font-size: 0.95rem;
    }

    .name-line {
      white-space: nowrap;
      font-size: 0.95rem;
    }

    .name-line span {
      display: inline-block;
      min-width: 160px;
      border-bottom: 1px solid #222;
      transform: translateY(-2px);
    }

    .problems {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .problem {
      border: 1px solid #cfcfcf;
      border-radius: 10px;
      padding: 8px;
      display: grid;
      grid-template-columns: 28px 1fr 150px;
      align-items: center;
      gap: 8px;
      min-height: 112px;
    }

    .pnum {
      font-weight: 800;
      font-size: 1rem;
      text-align: center;
    }

    .coin-area {
      padding: 2px;
      min-height: 95px;
      display: flex;
      flex-wrap: nowrap;
      gap: 6px;
      align-content: flex-end;
      align-items: flex-end;
      overflow: hidden;
    }

    .coin-item {
      width: var(--coin-size, 48px);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      flex: 0 0 auto;
      min-height: 100%;
    }

    .coin-img {
      width: var(--coin-size, 48px);
      height: var(--coin-size, 48px);
      object-fit: contain;
      display: block;
    }

    .answer {
      font-size: 1rem;
      font-weight: 700;
      text-align: right;
      padding-right: 6px;
    }

    .answer .line {
      display: inline-block;
      width: 76px;
      border-bottom: 2px solid #222;
      transform: translateY(-3px);
      margin-left: 4px;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 0.78rem;
      text-align: right;
      color: #666;
    }

    @media print {
      body { padding: 0; }
      .controls, .subtitle { display: none !important; }
      .app { max-width: none; }
      .sheet {
        border: none;
        border-radius: 0;
        padding: 0.35in;
      }
      @page { size: letter; margin: 0.35in; }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Counting Coins Generator</h1>
    <p class="subtitle">Generate 6 counting coin problems per page.</p>

    <section class="controls">
      <div class="row">
        <strong>1) Allowed coins:</strong>
        <div class="coin-select" id="coinSelect"></div>
      </div>

      <div class="row">
        <div class="field">
          <label for="maxAmount"><strong>2) Top amount (¢)</strong></label>
          <input id="maxAmount" type="number" min="1" max="200" value="60" />
        </div>

        <div class="field">
          <label for="coinStyle"><strong>3) Coin style</strong></label>
          <select id="coinStyle">
            <option value="coin">Coin</option>
            <option value="dot">Coin with dot</option>
            <option value="number-dot">Coin with number dot</option>
          </select>
        </div>

        <div class="field">
          <label for="coinSide"><strong>Coin side</strong></label>
          <select id="coinSide">
            <option value="front" selected>Front only</option>
            <option value="back">Back only</option>
            <option value="both">Front + Back (mixed)</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button id="generateBtn" class="primary" type="button">Generate Worksheet</button>
        <button type="button" onclick="window.print()">Print Page</button>
      </div>
    </section>

    <section class="sheet" id="sheet"></section>
  </div>

  <script>
    const COINS = [
      {
        key: 'quarter',
        label: 'Quarter (25¢)',
        value: 25,
        ratio: 1.355,
        front: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f715cda9ca3b4afc8.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fa41b87e63abb7442.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f9d610155e6cdbf3d.png'
        },
        back: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fc21b0392f87c6169.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f52c95225a81d6b04.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fa41b879e95bb7444.png'
        }
      },
      {
        key: 'dime',
        label: 'Dime (10¢)',
        value: 10,
        ratio: 1,
        front: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f7213971802a4d866.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f715cda2f49b4afc9.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f7f6dcfe6062f2e8f.png'
        },
        back: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fc21b033a7b7c6168.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f3fdd0ee03cca84ee.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f715cda4952b4afc7.png'
        }
      },
      {
        key: 'nickel',
        label: 'Nickel (5¢)',
        value: 5,
        ratio: 1.184,
        front: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f30ec4a3836469e61.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fa41b87e109bb7445.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f9d6101d9bacdbf3e.png'
        },
        back: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f9d61013067cdbf3c.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fc21b0357637c6163.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f52c952264f1d6b05.png'
        }
      },
      {
        key: 'penny',
        label: 'Penny (1¢)',
        value: 1,
        ratio: 1.064,
        front: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f3fdd0e810fca84ef.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fa41b876939bb7443.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f30ec4a0905469e63.png'
        },
        back: {
          coin: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f3fdd0e9a03ca84ed.png',
          dot: 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fc21b0302667c616a.png',
          'number-dot': 'https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fc21b035da47c616b.png'
        }
      }
    ];

    const DIME_BASE_SIZE = 46;
    const COIN_RENDER_ORDER = ['quarter', 'dime', 'nickel', 'penny'];

    const coinSelect = document.getElementById('coinSelect');
    const sheet = document.getElementById('sheet');

    function buildCoinSelectors() {
      COINS.forEach((coin) => {
        const wrapper = document.createElement('label');
        wrapper.className = 'coin-pill';

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.value = coin.key;
        cb.checked = coin.key !== 'penny';

        const text = document.createElement('span');
        text.textContent = coin.label;

        wrapper.appendChild(cb);
        wrapper.appendChild(text);
        coinSelect.appendChild(wrapper);
      });
    }

    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getAllowedCoins() {
      const checked = [...coinSelect.querySelectorAll('input:checked')].map((input) => input.value);
      return COINS.filter((coin) => checked.includes(coin.key));
    }

    function orderCoinsForDisplay(picks) {
      return COIN_RENDER_ORDER.flatMap((key) => picks.filter((coin) => coin.key === key));
    }

    function buildProblem(allowed, topAmount) {
      const coinCount = randomInt(3, 9);
      const picks = [];

      let safety = 0;
      while (safety < 350) {
        safety += 1;
        picks.length = 0;

        for (let i = 0; i < coinCount; i += 1) {
          picks.push(allowed[randomInt(0, allowed.length - 1)]);
        }

        const total = picks.reduce((sum, c) => sum + c.value, 0);
        if (total > 0 && total <= topAmount) {
          return { picks, total };
        }
      }

      const smallest = allowed.reduce((min, c) => Math.min(min, c.value), Number.POSITIVE_INFINITY);
      const fallbackCount = Math.max(1, Math.min(coinCount, Math.floor(topAmount / smallest)));
      const fallbackCoin = allowed.find((c) => c.value === smallest) || allowed[0];
      const fallbackPicks = Array.from({ length: fallbackCount }, () => fallbackCoin);
      return { picks: orderCoinsForDisplay(fallbackPicks), total: fallbackPicks.reduce((s, c) => s + c.value, 0) };
    }

    function getCoinImageUrl(coin, styleMode, sideMode) {
      const side = sideMode === 'both' ? (Math.random() < 0.5 ? 'front' : 'back') : sideMode;
      const selectedSide = coin[side] || coin.front;
      return selectedSide[styleMode] || selectedSide.coin || coin.front.coin;
    }

    function getCoinSizePx(coin) {
      return Math.round(DIME_BASE_SIZE * (coin.ratio || 1));
    }

    function coinHTML(coin, styleMode, sideMode) {
      const src = getCoinImageUrl(coin, styleMode, sideMode);
      const altSide = sideMode === 'both' ? 'front or back' : sideMode;
      const coinSize = getCoinSizePx(coin);
      return `
        <div class="coin-item" style="--coin-size:${coinSize}px;">
          <img class="coin-img" src="${src}" alt="${coin.label} ${altSide}" loading="lazy">
        </div>
      `;
    }

    function renderWorksheet() {
      const allowed = getAllowedCoins();
      const topAmountInput = document.getElementById('maxAmount');
      const styleMode = document.getElementById('coinStyle').value;
      const sideMode = document.getElementById('coinSide').value;
      const topAmount = Math.max(1, Math.min(200, Number.parseInt(topAmountInput.value, 10) || 1));
      topAmountInput.value = String(topAmount);

      if (allowed.length === 0) {
        alert('Please select at least one coin type.');
        return;
      }

      const smallest = allowed.reduce((min, c) => Math.min(min, c.value), Number.POSITIVE_INFINITY);
      if (topAmount < smallest) {
        alert(`Top amount must be at least ${smallest}¢ for the selected coins.`);
        return;
      }

      const rows = [];
      for (let i = 1; i <= 6; i += 1) {
        const problem = buildProblem(allowed, topAmount);
        const orderedPicks = orderCoinsForDisplay(problem.picks);
        rows.push(`
          <article class="problem">
            <div class="pnum">${i}.</div>
            <div class="coin-area">${orderedPicks.map((coin) => coinHTML(coin, styleMode, sideMode)).join('')}</div>
            <div class="answer">Total: <span class="line"></span> ¢</div>
          </article>
        `);
      }

      sheet.innerHTML = `
        <header class="sheet-header">
          <div>
            <p class="title">Counting Coins</p>
            <p class="directions"><strong>Directions:</strong> Count the coins and write the total amount in cents.</p>
          </div>
          <div class="name-line"><strong>Name:</strong> <span></span></div>
        </header>
        <div class="problems">${rows.join('')}</div>
        <div class="footer-note">Copyright - InterventionStation.com - @TeachwithMrC</div>
      `;
    }

    buildCoinSelectors();
    document.getElementById('generateBtn').addEventListener('click', renderWorksheet);
    renderWorksheet();
  </script>
</body>
</html>
