<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Add and Subtract Using Ten Frames</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --ink:#111;
    --line:#6f6f6f; /* worksheet divider gray */
    --bg:#fff;
  }

  *{ box-sizing:border-box; }
  html, body{
    margin:0;
    padding:0;
    background:var(--bg);
    color:var(--ink);
    font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    overflow-x:hidden; /* FIX: prevents sideways scroll */
  }

  .wrap{
    width:100%;
    max-width: 900px;   /* letter-friendly */
    margin: 0 auto;
    padding: 12px 12px 16px;
  }

  /* Controls (hidden on print) */
  .controls{
    border:2px solid var(--ink);
    border-radius:14px;
    padding:12px;
    margin-bottom:12px;
    width:100%;
  }
  .controlsRow{
    display:flex;
    flex-wrap:wrap;
    gap:10px 12px;
    align-items:flex-end;
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width: 150px;
  }
  label{ font-size:12px; font-weight:800; }
  select, input{
    height:36px;
    border:2px solid var(--ink);
    border-radius:10px;
    padding:6px 10px;
    font-family:"Poppins", sans-serif;
    font-size:14px;
    width: 170px;
    background:#fff;
  }

  .check{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:13px;
    font-weight:700;
    margin-top: 2px;
    user-select:none;
  }
  .check input{ width:18px; height:18px; }

  .btns{
    display:flex;
    gap:10px;
    margin-left:auto;
    flex-wrap:wrap;
  }
  button{
    height:38px;
    border:2px solid var(--ink);
    border-radius:10px;
    padding:0 14px;
    font-family:"Poppins", sans-serif;
    font-weight:900;
    cursor:pointer;
    background:#111;
    color:#fff;
  }
  button.secondary{
    background:#fff;
    color:#111;
  }

  /* Sheet */
  .sheet{
    width:100%;
    background:#fff;
  }

  .title{
    text-align:center;
    font-size:30px;
    font-weight:900;
    margin: 4px 0 10px;
  }

  /* 8 problems: 2 columns x 4 rows */
  .table{
    width:100%;
    border:1.5px solid var(--line);
  }
  .row{
    display:grid;
    grid-template-columns: 1fr 1fr;
    width:100%;
  }
  .cellBox{
    min-height: 200px; /* smaller so it fits */
    border-right:1.5px solid var(--line);
    border-bottom:1.5px solid var(--line);
    padding: 12px 12px 10px; /* tighter */
    overflow:hidden;
  }
  .row .cellBox:last-child{ border-right:none; }
  .table .row:last-child .cellBox{ border-bottom:none; }

  .expr{
    font-size:24px; /* slightly smaller */
    font-weight:900;
    letter-spacing:.2px;
    margin:0 0 10px;
  }
  .blank{
    display:inline-block;
    width:105px;
    border-bottom:3px solid var(--ink);
    transform: translateY(-4px);
  }

  .frames{
    display:grid;
    gap:10px;          /* tighter */
    width: 100%;
    max-width: 260px;  /* smaller frames */
  }

  /* Ten frame */
  .tenframe{
    width: 100%;
  }

  .tfGrid{
    display:grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(2, 1fr);
    border:1.5px solid var(--line);
    width:100%;
  }
  .tfCell{
    border:1.5px solid var(--line);
    aspect-ratio: 1 / 1;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
  }

  /* X cross-out (subtraction option) */
  .cross::before, .cross::after{
    content:"";
    position:absolute;
    width:88%;
    height:3px;
    background:var(--ink);
    left:6%;
    top:50%;
    transform-origin:center;
  }
  .cross::before{ transform:translateY(-50%) rotate(45deg); }
  .cross::after{ transform:translateY(-50%) rotate(-45deg); }

  .footer{
    text-align:center;
    font-size:12px;
    font-weight:800;
    margin-top:10px;
  }

  @media print{
    .controls{ display:none !important; }
    .wrap{ max-width:none; padding:0; }
    .title{ margin-top:0; }
  }
</style>
</head>

<body>
<div class="wrap">

  <!-- Controls -->
  <div class="controls">
    <div class="controlsRow">
      <div class="field">
        <label for="mode">Operation</label>
        <select id="mode">
          <option value="add">Addition</option>
          <option value="sub">Subtraction</option>
        </select>
      </div>

      <div class="field">
        <label for="minVal">Lowest #</label>
        <input id="minVal" type="number" min="0" max="20" value="0">
      </div>

      <div class="field">
        <label for="maxVal">Highest # (≤20)</label>
        <input id="maxVal" type="number" min="1" max="20" value="20">
      </div>

      <div class="field">
        <label>Ten-frame model</label>
        <div class="check">
          <input id="prefillFirst" type="checkbox" checked>
          <label for="prefillFirst">Prefill first number in the ten frames</label>
        </div>
      </div>

      <div class="field" id="subModeWrap" style="display:none;">
        <label for="subDisplay">Subtraction display</label>
        <select id="subDisplay">
          <option value="crossOut">Cross out on top frame + answer frame</option>
          <option value="prefillOnly">Prefill minuend only (no cross-out)</option>
        </select>
      </div>

      <div class="btns">
        <button id="btnGen">Generate 8</button>
        <button class="secondary" id="btnPrint">Print</button>
      </div>
    </div>
  </div>

  <!-- Sheet -->
  <div class="sheet">
    <div class="title">Add and Subtract Using Ten Frames</div>
    <div class="table" id="table"></div>
    <div class="footer">Copyright - Generated from InterventionStation.com - @TeachWithMrC</div>
  </div>

</div>

<script>
  const $ = (id) => document.getElementById(id);

  function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
  function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function normalizeBounds(){
    let lo = clamp(parseInt($("minVal").value || "0",10), 0, 20);
    let hi = clamp(parseInt($("maxVal").value || "20",10), 1, 20);
    if (hi < lo) [lo,hi] = [hi,lo];
    $("minVal").value = lo;
    $("maxVal").value = hi;
    return { lo, hi };
  }

  // rule: no "max + anything" / "__ + max"
  function violatesNoMaxAddend(a,b,hi){ return a === hi || b === hi; }

  // Addition: prefer "make-a-ten" crossing 10 (like 9+4, 8+5, 7+6)
  function makeAddition(lo,hi){
    for (let t=0;t<180;t++){
      const a = randInt(6,9);
      const bMin = Math.max(1, 11 - a);   // forces cross 10
      const bMax = Math.min(9, hi - a);   // keep b 1..9
      if (bMin > bMax) continue;

      const b = randInt(bMin, bMax);
      const sum = a + b;

      if (sum < lo || sum > hi) continue;
      if (violatesNoMaxAddend(a,b,hi)) continue; // prevents 20 + __

      return { a, b, ans: sum };
    }

    // fallback safe
    for (let t=0;t<400;t++){
      const a = randInt(lo, Math.max(lo, hi-1));
      const b = randInt(1, Math.max(1, hi-a));
      const sum = a + b;
      if (sum>=lo && sum<=hi && !violatesNoMaxAddend(a,b,hi)) return { a,b,ans:sum };
    }
    return { a:9, b:4, ans:13 };
  }

  // Subtraction: prefer crossing 10 (15-7, 14-6, 13-5) and keep subtrahend 1..9
  function makeSubtraction(lo,hi){
    for (let t=0;t<220;t++){
      const a = randInt(Math.max(11, lo, 1), hi);
      const bMin = Math.max(1, (a-10)+1); // must cross 10
      const bMax = Math.min(9, a-1);
      if (bMin > bMax) continue;

      const b = randInt(bMin, bMax);
      const ans = a - b;

      if (ans < lo || ans > hi) continue;
      return { a, b, ans };
    }

    // fallback
    for (let t=0;t<400;t++){
      const a = randInt(lo, hi);
      const b = randInt(1, Math.max(1, a));
      const ans = a - b;
      if (ans>=lo && ans<=hi) return { a,b,ans };
    }
    return { a:15, b:7, ans:8 };
  }

  // Convert number (0..20) into two frames of 10 booleans
  function dotBooleans(n){
    n = clamp(n, 0, 20);
    const f1 = Array(10).fill(false);
    const f2 = Array(10).fill(false);
    const first = Math.min(10, n);
    for (let i=0;i<first;i++) f1[i] = true;
    const rest = Math.max(0, n-10);
    for (let i=0;i<rest;i++) f2[i] = true;
    return [f1,f2];
  }

  // SVG CIRCLE DOT (prints reliably)
  function makeDotSVG(){
    const ns = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(ns,"svg");
    svg.setAttribute("viewBox","0 0 100 100");
    svg.style.width = "74%";
    svg.style.height = "74%";

    const c = document.createElementNS(ns,"circle");
    c.setAttribute("cx","50");
    c.setAttribute("cy","50");
    c.setAttribute("r","38");
    c.setAttribute("fill","#111");
    svg.appendChild(c);

    return svg;
  }

  function buildTenFrame(frameDotsBool, crossSet = null){
    const frame = document.createElement("div");
    frame.className = "tenframe";

    const grid = document.createElement("div");
    grid.className = "tfGrid";

    for (let i=0;i<10;i++){
      const cell = document.createElement("div");
      cell.className = "tfCell";

      if (frameDotsBool[i]){
        cell.appendChild(makeDotSVG());
        if (crossSet && crossSet.has(i)) cell.classList.add("cross");
      }
      grid.appendChild(cell);
    }

    frame.appendChild(grid);
    return frame;
  }

  function buildProblemCell(q){
    const { mode, a, b, ans } = q;
    const prefillFirst = $("prefillFirst").checked;
    const subDisplay = $("subDisplay").value;

    const cell = document.createElement("div");
    cell.className = "cellBox";

    const op = (mode==="add") ? "+" : "−";
    const expr = document.createElement("div");
    expr.className = "expr";
    expr.innerHTML = `${a} ${op} ${b} = <span class="blank"></span>`;
    cell.appendChild(expr);

    const framesWrap = document.createElement("div");
    framesWrap.className = "frames";

    if (mode === "add"){
      if (prefillFirst){
        // KEY BEHAVIOR YOU ASKED FOR:
        // Show TWO ten frames representing the first number (a) across 0..20.
        // Student will draw +b dots in the empty spaces (e.g., 9 + 4 => fill 1 on top + 3 on bottom)
        const [a1,a2] = dotBooleans(a);
        framesWrap.appendChild(buildTenFrame(a1));
        framesWrap.appendChild(buildTenFrame(a2));
      } else {
        // If not prefilled, show blank frames (teacher wants students to model everything)
        framesWrap.appendChild(buildTenFrame(Array(10).fill(false)));
        framesWrap.appendChild(buildTenFrame(Array(10).fill(false)));
      }
    } else {
      // Subtraction
      const [m1,m2] = dotBooleans(a);

      if (prefillFirst){
        if (subDisplay === "crossOut"){
          // Cross out b on the top frame(s), then show answer frame(s)
          const [ans1, ans2] = dotBooleans(ans);

          // Cross out from (a-b) to (a-1) in the 0..20 fill order.
          // We store separate sets per frame.
          const cross1 = new Set();
          const cross2 = new Set();

          for (let k = a - b; k < a; k++){
            if (k < 10) cross1.add(k);
            else cross2.add(k - 10);
          }

          framesWrap.appendChild(buildTenFrame(m1, cross1));
          framesWrap.appendChild(buildTenFrame(m2, cross2));

          // Answer shown as filled dots (helps kids see remainder)
          framesWrap.appendChild(buildTenFrame(ans1));
          framesWrap.appendChild(buildTenFrame(ans2));
        } else {
          // Prefill minuend only (kids do the crossing out themselves)
          framesWrap.appendChild(buildTenFrame(m1));
          framesWrap.appendChild(buildTenFrame(m2));
        }
      } else {
        // No prefill: blank frames
        framesWrap.appendChild(buildTenFrame(Array(10).fill(false)));
        framesWrap.appendChild(buildTenFrame(Array(10).fill(false)));
      }
    }

    cell.appendChild(framesWrap);
    return cell;
  }

  function buildSheet(){
    const {lo,hi} = normalizeBounds();
    const mode = $("mode").value;

    const qs = [];
    const seen = new Set();
    let guard = 0;

    while (qs.length < 8 && guard < 900){
      guard++;

      const q = (mode==="add") ? makeAddition(lo,hi) : makeSubtraction(lo,hi);
      const key = (mode==="add") ? `${q.a}+${q.b}` : `${q.a}-${q.b}`;

      if (mode==="add"){
        // avoid commutative dupes
        const key2 = `${q.b}+${q.a}`;
        if (seen.has(key) || seen.has(key2)) continue;
        if (violatesNoMaxAddend(q.a,q.b,hi)) continue;
      } else {
        if (seen.has(key)) continue;
      }

      seen.add(key);
      qs.push({ mode, ...q });
    }

    const table = $("table");
    table.innerHTML = "";

    for (let r=0; r<4; r++){
      const row = document.createElement("div");
      row.className = "row";
      row.appendChild(buildProblemCell(qs[r*2]));
      row.appendChild(buildProblemCell(qs[r*2 + 1]));
      table.appendChild(row);
    }
  }

  function syncUI(){
    const mode = $("mode").value;
    $("subModeWrap").style.display = (mode==="sub") ? "" : "none";
    buildSheet();
  }

  $("btnGen").addEventListener("click", buildSheet);
  $("btnPrint").addEventListener("click", () => window.print());
  $("mode").addEventListener("change", syncUI);
  ["minVal","maxVal","prefillFirst","subDisplay"].forEach(id => $(id).addEventListener("change", buildSheet));

  syncUI();
</script>
</body>
</html>
