<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Add and Subtract Using Ten Frames</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --ink:#111;
    --line:#6f6f6f; /* worksheet-divider gray */
    --bg:#fff;

    /* PDF-like colors (optional) */
    --aColor:#e21818; /* red */
    --bColor:#f2d21b; /* yellow */
    --subColor:#111;  /* black */
    --cross:#111;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  .wrap{
    max-width: 900px;
    margin: 0 auto;
    padding: 14px 14px 18px;
  }

  /* Controls (hidden on print) */
  .controls{
    border:2px solid var(--ink);
    border-radius:14px;
    padding:12px;
    margin-bottom:14px;
  }
  .controlsRow{
    display:flex;
    flex-wrap:wrap;
    gap:10px 12px;
    align-items:flex-end;
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  label{ font-size:12px; font-weight:700; }
  select, input{
    height:38px;
    border:2px solid var(--ink);
    border-radius:10px;
    padding:6px 10px;
    font-family:"Poppins", sans-serif;
    font-size:14px;
    width: 160px;
    background:#fff;
  }
  .check{
    display:flex;
    align-items:center;
    gap:8px;
    margin-top:2px;
    font-size:13px;
    font-weight:600;
  }
  .check input{ width:18px; height:18px; }
  .btns{
    display:flex;
    gap:10px;
    margin-left:auto;
    flex-wrap:wrap;
  }
  button{
    height:40px;
    border:2px solid var(--ink);
    border-radius:10px;
    padding:0 14px;
    font-family:"Poppins", sans-serif;
    font-weight:800;
    cursor:pointer;
    background:#111;
    color:#fff;
  }
  button.secondary{
    background:#fff;
    color:#111;
  }

  /* Worksheet */
  .sheet{
    background:#fff;
  }

  .title{
    text-align:center;
    font-size:32px;
    font-weight:800;
    margin: 6px 0 12px;
  }

  /* 2 columns x 4 rows like the PDF */
  .table{
    border:1.5px solid var(--line);
  }
  .row{
    display:grid;
    grid-template-columns: 1fr 1fr;
  }
  .cellBox{
    min-height: 240px;
    border-right:1.5px solid var(--line);
    border-bottom:1.5px solid var(--line);
    padding: 18px 18px 16px;
  }
  .row .cellBox:last-child{ border-right:none; }
  .table .row:last-child .cellBox{ border-bottom:none; }

  .expr{
    font-size:28px;
    font-weight:800;
    letter-spacing:.2px;
    margin:0 0 12px;
  }
  .blank{
    display:inline-block;
    width:120px;
    border-bottom:3px solid var(--ink);
    transform: translateY(-4px);
  }

  .frames{
    display:grid;
    gap:14px;
    max-width: 360px;
  }

  .tenframe{
    width: 360px;
    max-width: 100%;
  }

  .tfGrid{
    display:grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(2, 1fr);
    border:1.5px solid var(--line);
  }
  .tfCell{
    border:1.5px solid var(--line);
    aspect-ratio: 1 / 1;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
  }

  /* X cross-out (subtraction option) */
  .cross::before, .cross::after{
    content:"";
    position:absolute;
    width:90%;
    height:3px;
    background:var(--cross);
    left:5%;
    top:50%;
    transform-origin:center;
  }
  .cross::before{ transform:translateY(-50%) rotate(45deg); }
  .cross::after{ transform:translateY(-50%) rotate(-45deg); }

  .footer{
    text-align:center;
    font-size:12px;
    font-weight:700;
    margin-top:10px;
  }

  @media print{
    .controls{ display:none !important; }
    .wrap{ max-width:none; padding:0; }
    .title{ margin-top:0; }
  }
</style>
</head>

<body>
<div class="wrap">

  <!-- Controls -->
  <div class="controls">
    <div class="controlsRow">
      <div class="field">
        <label for="mode">Operation</label>
        <select id="mode">
          <option value="add">Addition</option>
          <option value="sub">Subtraction</option>
        </select>
      </div>

      <div class="field">
        <label for="minVal">Lowest #</label>
        <input id="minVal" type="number" min="0" max="20" value="0">
      </div>

      <div class="field">
        <label for="maxVal">Highest # (≤20)</label>
        <input id="maxVal" type="number" min="1" max="20" value="20">
      </div>

      <div class="field" id="subModeWrap" style="display:none;">
        <label for="subDisplay">Subtraction Model</label>
        <select id="subDisplay">
          <option value="twoFrames">Two frames (A on top, B on bottom)</option>
          <option value="crossOut">Cross out on top frame + answer frame</option>
        </select>
      </div>

      <div class="field">
        <label>&nbsp;</label>
        <div class="check">
          <input id="useColor" type="checkbox" checked>
          <label for="useColor">Use PDF-style colors (red/yellow)</label>
        </div>
      </div>

      <div class="btns">
        <button id="btnGen">Generate 8</button>
        <button class="secondary" id="btnPrint">Print</button>
      </div>
    </div>
  </div>

  <!-- Sheet -->
  <div class="sheet">
    <div class="title">Add and Subtract Using Ten Frames</div>

    <div class="table" id="table"></div>

    <div class="footer">Copyright - Generated from InterventionStation.com - @TeachWithMrC</div>
  </div>

</div>

<script>
  const $ = (id) => document.getElementById(id);

  function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
  function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function normalizeBounds(){
    let lo = clamp(parseInt($("minVal").value || "0",10), 0, 20);
    let hi = clamp(parseInt($("maxVal").value || "20",10), 1, 20);
    if (hi < lo) [lo,hi] = [hi,lo];
    $("minVal").value = lo;
    $("maxVal").value = hi;
    return { lo, hi };
  }

  // rule: no "max + anything" / "__ + max"
  function violatesNoMaxAddend(a,b,hi){ return a === hi || b === hi; }

  // Prefer crossing 10 for addition (make-a-ten feel)
  function makeAddition(lo,hi){
    for (let t=0;t<120;t++){
      const a = randInt(6,9);
      const bMin = Math.max(1, 11 - a);        // ensures cross 10
      const bMax = Math.min(9, hi - a);
      if (bMin > bMax) continue;

      const b = randInt(bMin, bMax);
      const sum = a + b;

      if (sum < lo || sum > hi) continue;
      if (violatesNoMaxAddend(a,b,hi)) continue;

      return { a, b, ans: sum };
    }

    // fallback safe
    for (let t=0;t<300;t++){
      const a = randInt(lo, Math.max(lo, hi-1));
      const b = randInt(1, Math.max(1, hi-a));
      const sum = a + b;
      if (sum>=lo && sum<=hi && !violatesNoMaxAddend(a,b,hi)) return { a,b,ans:sum };
    }
    return { a:8, b:4, ans:12 };
  }

  // Prefer crossing 10 for subtraction (e.g., 15-7, avoid 16-3 by default)
  function makeSubtraction(lo,hi){
    for (let t=0;t<160;t++){
      const a = randInt(Math.max(11, lo, 1), hi);
      const bMin = Math.max(1, (a-10)+1); // must cross 10
      const bMax = Math.min(9, a-1);
      if (bMin > bMax) continue;

      const b = randInt(bMin, bMax);
      const ans = a - b;

      if (ans < lo || ans > hi) continue;
      return { a, b, ans };
    }

    // fallback
    for (let t=0;t<300;t++){
      const a = randInt(lo, hi);
      const b = randInt(1, Math.max(1, a));
      const ans = a - b;
      if (ans>=lo && ans<=hi) return { a,b,ans };
    }
    return { a:15, b:7, ans:8 };
  }

  // Ten-frame dot mapping across 0..20 (two frames of 10)
  function dotBooleans(n){
    n = clamp(n, 0, 20);
    const f1 = Array(10).fill(false);
    const f2 = Array(10).fill(false);
    const first = Math.min(10, n);
    for (let i=0;i<first;i++) f1[i] = true;
    const rest = Math.max(0, n-10);
    for (let i=0;i<rest;i++) f2[i] = true;
    return [f1,f2];
  }

  // SVG oval dot (prints reliably)
  function makeDotSVG(color){
    const ns = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(ns,"svg");
    svg.setAttribute("viewBox","0 0 100 100");
    svg.style.width = "82%";
    svg.style.height = "58%";

    const ell = document.createElementNS(ns,"ellipse");
    ell.setAttribute("cx","50");
    ell.setAttribute("cy","50");
    ell.setAttribute("rx","44");
    ell.setAttribute("ry","30");
    ell.setAttribute("fill", color);

    // subtle outline like the PDF
    ell.setAttribute("stroke", "#111");
    ell.setAttribute("stroke-width", "2");

    svg.appendChild(ell);
    return svg;
  }

  function buildTenFrame(totalDotsBool, dotColor, crossSet = null){
    const frame = document.createElement("div");
    frame.className = "tenframe";

    const grid = document.createElement("div");
    grid.className = "tfGrid";

    for (let i=0;i<10;i++){
      const cell = document.createElement("div");
      cell.className = "tfCell";

      if (totalDotsBool[i]){
        cell.appendChild(makeDotSVG(dotColor));
        if (crossSet && crossSet.has(i)) cell.classList.add("cross");
      }
      grid.appendChild(cell);
    }

    frame.appendChild(grid);
    return frame;
  }

  function problemCellHTML({mode,a,b,ans}, useColor, subDisplay){
    const cell = document.createElement("div");
    cell.className = "cellBox";

    const op = (mode==="add") ? "+" : "−";
    const expr = document.createElement("div");
    expr.className = "expr";
    expr.innerHTML = `${a} ${op} ${b} = <span class="blank"></span>`;
    cell.appendChild(expr);

    const framesWrap = document.createElement("div");
    framesWrap.className = "frames";

    if (mode === "add"){
      const [a1,a2] = dotBooleans(a);
      const [b1,b2] = dotBooleans(b);

      const aColor = useColor ? getComputedStyle(document.documentElement).getPropertyValue("--aColor").trim() : "#111";
      const bColor = useColor ? getComputedStyle(document.documentElement).getPropertyValue("--bColor").trim() : "#111";

      // PDF-style: top = first addend, bottom = second addend
      framesWrap.appendChild(buildTenFrame(a1, aColor));
      framesWrap.appendChild(buildTenFrame(b1, bColor));

    } else {
      const subColor = useColor ? getComputedStyle(document.documentElement).getPropertyValue("--subColor").trim() : "#111";

      if (subDisplay === "twoFrames"){
        // PDF-ish: top = minuend, bottom = subtrahend (no cross-out)
        const [m1] = dotBooleans(a);
        const [s1] = dotBooleans(b);

        framesWrap.appendChild(buildTenFrame(m1, subColor));
        framesWrap.appendChild(buildTenFrame(s1, subColor));
      } else {
        // Cross out on top, answer on bottom (more teacher-friendly for subtraction)
        const [m1] = dotBooleans(a);
        const [ans1] = dotBooleans(ans);

        // cross out the last b dots in the filled order (left-to-right)
        const cross = new Set();
        for (let k = a-b; k < a; k++){
          if (k < 10) cross.add(k);
        }

        framesWrap.appendChild(buildTenFrame(m1, subColor, cross));
        framesWrap.appendChild(buildTenFrame(ans1, subColor));
      }
    }

    cell.appendChild(framesWrap);
    return cell;
  }

  function buildSheet(){
    const {lo,hi} = normalizeBounds();
    const mode = $("mode").value;
    const useColor = $("useColor").checked;
    const subDisplay = $("subDisplay").value;

    // Build 8 questions: 4 rows × 2
    const qs = [];
    const seen = new Set();

    let guard = 0;
    while (qs.length < 8 && guard < 600){
      guard++;

      const q = (mode==="add") ? makeAddition(lo,hi) : makeSubtraction(lo,hi);
      const key = (mode==="add")
        ? `${q.a}+${q.b}` // keep addition unique-ish
        : `${q.a}-${q.b}`;

      // Also avoid commutative dupes in addition
      if (mode==="add"){
        const key2 = `${q.b}+${q.a}`;
        if (seen.has(key) || seen.has(key2)) continue;
      } else {
        if (seen.has(key)) continue;
      }

      // apply “no max + anything” rule in addition
      if (mode==="add" && violatesNoMaxAddend(q.a,q.b,hi)) continue;

      seen.add(key);
      qs.push({ mode, ...q });
    }

    const table = $("table");
    table.innerHTML = "";

    for (let r=0; r<4; r++){
      const row = document.createElement("div");
      row.className = "row";

      const left = qs[r*2];
      const right = qs[r*2 + 1];

      row.appendChild(problemCellHTML(left, useColor, subDisplay));
      row.appendChild(problemCellHTML(right, useColor, subDisplay));

      table.appendChild(row);
    }
  }

  function syncUI(){
    const mode = $("mode").value;
    $("subModeWrap").style.display = (mode==="sub") ? "" : "none";
    buildSheet();
  }

  $("btnGen").addEventListener("click", buildSheet);
  $("btnPrint").addEventListener("click", () => window.print());
  $("mode").addEventListener("change", syncUI);
  ["minVal","maxVal","useColor","subDisplay"].forEach(id => $(id).addEventListener("change", buildSheet));

  // init
  syncUI();
</script>
</body>
</html>
