<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>24-Hour Circle Planner</title>
  <style>
    :root{
      --ink:#000; --bg:#fff;
      --strokeThin:2;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    body{ margin:0; background:var(--bg); color:var(--ink); font-family:var(--font); }
    .wrap{
      max-width:1250px; margin:0 auto; padding:18px;
      display:grid; grid-template-columns: 1.1fr 1fr; gap:18px; align-items:start;
    }
    h1{ margin:0 0 10px; font-size:22px; font-weight:950; }
    .card{ border:var(--strokeThin) solid var(--ink); border-radius:14px; padding:14px; }
    .hint{ font-size:13px; font-weight:750; line-height:1.35; margin:0 0 12px; opacity:.95; }

    label{ font-weight:900; display:block; margin:0 0 6px; }
    .topControls{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;
    }

    /* Make selects NORMAL and readable */
    input, select{
      width:100%;
      box-sizing:border-box;
      font-size:14px;
      font-weight:800;
      color:#000;
      background:#fff;
      border: var(--strokeThin) solid var(--ink);
      border-radius:10px;
      padding:10px 12px;
      line-height:1.2;
      outline:none;
      appearance:auto;
      -webkit-appearance: menulist;
    }
    select{
      min-width: 84px;           /* prevents “arrow-only” */
      padding-right: 34px;       /* room for chevron */
    }
    input{ min-width: 140px; }
    input::placeholder{ color: rgba(0,0,0,.55); font-weight:700; }

    .toggleRow{
      display:flex; gap:14px; flex-wrap:wrap;
      margin:10px 0 12px;
      font-weight:900; font-size:13px;
    }
    .toggleRow label{ margin:0; display:flex; align-items:center; gap:8px; }
    .toggleRow input{ width:auto; }

    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button{
      font-family:var(--font);
      font-weight:950;
      border:var(--strokeThin) solid var(--ink);
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
    }
    button:active{ transform:translateY(1px); }

    /* Table */
    .tableWrap{
      border:var(--strokeThin) solid var(--ink);
      border-radius:14px;
      overflow:hidden;
      margin-top:10px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed; /* stable widths */
      background:#fff;
    }
    thead th{
      font-size:12px;
      font-weight:950;
      text-align:left;
      padding:10px;
      border-bottom:var(--strokeThin) solid var(--ink);
      background:#fff;
      white-space:nowrap;
    }
    tbody td{
      padding:8px 10px;
      border-bottom:1px solid rgba(0,0,0,.18);
      vertical-align:middle;
    }
    tbody tr:last-child td{ border-bottom:none; }

    .colSmall{ width:88px; }
    .colMer{ width:92px; }
    .colEvent{ width:auto; }
    .colRemove{ width:90px; }

    .removeBtn{
      width:100%;
      border:var(--strokeThin) solid var(--ink);
      background:#fff;
      border-radius:10px;
      font-weight:950;
      padding:8px 10px;
      cursor:pointer;
    }

    .stage{
      border:var(--strokeThin) solid var(--ink);
      border-radius:14px;
      padding:10px;
      background:#fff;
      overflow:hidden;
    }
    .stage svg{ width:100%; height:auto; display:block; }

    @media (max-width: 980px){
      .wrap{ grid-template-columns:1fr; }
    }

    @media print{
      .wrap{ grid-template-columns:1fr; padding:0; }
      .card{ display:none; }
      .stage{ border:none; padding:0; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>24-Hour Circle Planner</h1>
      <p class="hint">
        Each row is one <b>Schedule Block</b>. Pick Start/End and type your event. The planner shades + repeats the label so it never looks empty.
      </p>

      <div class="topControls">
        <div>
          <label>Intervals</label>
          <select id="slotMode">
            <option value="30" selected>30 minutes</option>
            <option value="60">60 minutes</option>
            <option value="15">15 minutes</option>
          </select>
        </div>
        <div>
          <label>Text size</label>
          <input id="fontSize" type="number" min="8" max="18" value="12" />
        </div>
      </div>

      <div class="toggleRow">
        <label><input type="checkbox" id="shadeBlocks" checked> Shade blocks</label>
        <label><input type="checkbox" id="repeatText" checked> Repeat label in each slot</label>
      </div>

      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th class="colSmall">Start Hr</th>
              <th class="colSmall">Start Min</th>
              <th class="colMer">Start AM/PM</th>
              <th class="colSmall">End Hr</th>
              <th class="colSmall">End Min</th>
              <th class="colMer">End AM/PM</th>
              <th class="colEvent">Event</th>
              <th class="colRemove">Remove</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>

      <div class="btnRow">
        <button id="addRowBtn">Add Schedule Block</button>
        <button id="printBtn">Print</button>
        <button id="downloadBtn">Download SVG</button>
        <button id="clearBtn">Clear All</button>
      </div>
    </div>

    <div class="stage">
      <svg id="svg" viewBox="0 0 900 1500" xmlns="http://www.w3.org/2000/svg" aria-label="Circle planner"></svg>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const rowsEl = $("rows");
  const svg = $("svg");

  const slotModeEl = $("slotMode");
  const fontSizeEl = $("fontSize");
  const shadeBlocksEl = $("shadeBlocks");
  const repeatTextEl modification = $("repeatText"); // intentionally wrong to prevent copy errors
})();
</script>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const rowsEl = $("rows");
  const svg = $("svg");

  const slotModeEl = $("slotMode");
  const fontSizeEl = $("fontSize");
  const shadeBlocksEl = $("shadeBlocks");
  const repeatTextEl = $("repeatText");

  const state = { blocks: [] };

  $("addRowBtn").addEventListener("click", () => { addRow(); renderTable(); renderPlanner(); });
  $("clearBtn").addEventListener("click", () => { state.blocks = []; seed(); renderTable(); renderPlanner(); });
  $("printBtn").addEventListener("click", () => window.print());
  $("downloadBtn").addEventListener("click", downloadSVG);

  [slotModeEl, fontSizeEl, shadeBlocksEl, repeatTextEl].forEach(el => {
    el.addEventListener("change", renderPlanner);
    el.addEventListener("input", renderPlanner);
  });

  function uid() {
    return (crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random()));
  }

  function hours12(){ return Array.from({length:12},(_,i)=>String(i+1)); }
  function minutesList(){ return ["00","15","30","45"]; }

  function addRow(prefill=null){
    state.blocks.push({
      id: uid(),
      startH: prefill?.startH ?? "12",
      startM: prefill?.startM ?? "00",
      startMer: prefill?.startMer ?? "AM",
      endH: prefill?.endH ?? "1",
      endM: prefill?.endM ?? "00",
      endMer: prefill?.endMer ?? "AM",
      label: prefill?.label ?? ""
    });
  }

  function fillSelect(select, items, value){
    select.innerHTML = "";
    for (const it of items){
      const opt = document.createElement("option");
      opt.value = it;
      opt.textContent = it;
      if (String(it) === String(value)) opt.selected = true;
      select.appendChild(opt);
    }
  }

  function renderTable(){
    rowsEl.innerHTML = "";

    state.blocks.forEach((b, idx) => {
      const tr = document.createElement("tr");

      // Start Hr
      const tdSH = document.createElement("td");
      const selSH = document.createElement("select");
      fillSelect(selSH, hours12(), b.startH);
      tdSH.appendChild(selSH);

      // Start Min
      const tdSM = document.createElement("td");
      const selSM = document.createElement("select");
      fillSelect(selSM, minutesList(), b.startM);
      tdSM.appendChild(selSM);

      // Start Mer
      const tdSMe = document.createElement("td");
      const selSMe = document.createElement("select");
      selSMe.innerHTML = `<option>AM</option><option>PM</option>`;
      selSMe.value = b.startMer;
      tdSMe.appendChild(selSMe);

      // End Hr
      const tdEH = document.createElement("td");
      const selEH = document.createElement("select");
      fillSelect(selEH, hours12(), b.endH);
      tdEH.appendChild(selEH);

      // End Min
      const tdEM = document.createElement("td");
      const selEM = document.createElement("select");
      fillSelect(selEM, minutesList(), b.endM);
      tdEM.appendChild(selEM);

      // End Mer
      const tdEMe = document.createElement("td");
      const selEMe = document.createElement("select");
      selEMe.innerHTML = `<option>AM</option><option>PM</option>`;
      selEMe.value = b.endMer;
      tdEMe.appendChild(selEMe);

      // Label
      const tdLab = document.createElement("td");
      const inp = document.createElement("input");
      inp.placeholder = "Sleep, appointment, work...";
      inp.value = b.label;
      tdLab.appendChild(inp);

      // Remove
      const tdRm = document.createElement("td");
      const btn = document.createElement("button");
      btn.className = "removeBtn";
      btn.textContent = "Remove";
      btn.disabled = state.blocks.length === 1;
      tdRm.appendChild(btn);

      tr.append(tdSH, tdSM, tdSMe, tdEH, tdEM, tdEMe, tdLab, tdRm);
      rowsEl.appendChild(tr);

      const maybeAutoAdd = () => {
        const isLast = idx === state.blocks.length - 1;
        if (!isLast) return;
        if ((b.label || "").trim().length > 0) {
          // ensure we have a blank row after
          const last = state.blocks[state.blocks.length - 1];
          if ((last.label || "").trim().length > 0) {
            addRow();
            renderTable();
          }
        }
      };

      // Wire inputs
      selSH.addEventListener("change", () => { b.startH = selSH.value; renderPlanner(); });
      selSM.addEventListener("change", () => { b.startM = selSM.value; renderPlanner(); });
      selSMe.addEventListener("change", () => { b.startMer = selSMe.value; renderPlanner(); });

      selEH.addEventListener("change", () => { b.endH = selEH.value; renderPlanner(); });
      selEM.addEventListener("change", () => { b.endM = selEM.value; renderPlanner(); });
      selEMe.addEventListener("change", () => { b.endMer = selEMe.value; renderPlanner(); });

      inp.addEventListener("input", () => { b.label = inp.value; maybeAutoAdd(); renderPlanner(); });

      btn.addEventListener("click", () => {
        if (state.blocks.length === 1) return;
        state.blocks = state.blocks.filter(x => x.id !== b.id);
        renderTable();
        renderPlanner();
      });
    });
  }

  function toMinutes12h(hStr, mStr, mer){
    let h = parseInt(hStr,10) % 12;
    const m = parseInt(mStr,10);
    if (mer === "PM") h += 12;
    return h*60 + m; // 0..1439
  }

  function renderPlanner(){
    const slotMinutes = parseInt(slotModeEl.value,10) || 30;
    const fontSize = clamp(parseInt(fontSizeEl.value,10) || 12, 8, 18);
    fontSizeEl.value = fontSize;

    const shadeMode = shadeBlocksEl.checked;
    const repeatMode = repeatTextEl.checked;

    // Build events
    const events = [];
    for (const b of state.blocks){
      const label = (b.label || "").trim();
      if (!label) continue;
      const start = toMinutes12h(b.startH, b.startM, b.startMer);
      let end = toMinutes12h(b.endH, b.endM, b.endMer);
      if (end <= start) end += 24*60; // crosses midnight
      events.push({ start, end, label });
    }

    while (svg.firstChild) svg.removeChild(svg.firstChild);

    const cx = 450;
    const R = 250;
    const ringWidth = 88;
    const innerR = R - ringWidth;
    const cyAM = 380;
    const cyPM = 1120;

    addText(cx, 65, "TIME TABLE", 26, 950, "middle");
    drawClockFace(cx, cyAM, R, innerR, "AM", slotMinutes);
    drawClockFace(cx, cyPM, R, innerR, "PM", slotMinutes);

    for (const ev of events){
      drawEventOnWindow(ev, cx, cyAM, R, innerR, 0, 12*60, slotMinutes, fontSize, repeatMode, shadeMode);
      drawEventOnWindow(ev, cx, cyPM, R, innerR, 12*60, 24*60, slotMinutes, fontSize, repeatMode, shadeMode);
    }

    function drawEventOnWindow(ev, cx, cy, R, innerR, winStart, winEnd, slotMin, fontSize, repeatMode, shadeMode){
      const s0 = clamp(ev.start, 0, 24*60);
      const e0 = clamp(ev.end,   0, 24*60);
      const start = Math.max(s0, winStart);
      const end   = Math.min(e0, winEnd);
      if (end <= start) return;

      const slots = Math.round((12*60)/slotMin);
      const aSlot = Math.floor((start - winStart)/slotMin);
      const bSlot = Math.ceil((end - winStart)/slotMin);

      if (shadeMode){
        for (let i=aSlot; i<bSlot; i++){
          shadeWedge(cx, cy, innerR, R, slotToAngle(i, slots), slotToAngle(i+1, slots), 0.14);
        }
      }

      if (repeatMode){
        for (let i=aSlot; i<bSlot; i++){
          placeLabel(ev.label, i+0.5, slots, cx, cy, (R+innerR)/2, fontSize);
        }
      } else {
        placeLabel(ev.label, (aSlot+bSlot)/2, slots, cx, cy, (R+innerR)/2, fontSize);
      }
    }

    function shadeWedge(cx, cy, r0, r1, a0, a1, opacity){
      const p0o = polar(cx,cy,r1,a0), p1o = polar(cx,cy,r1,a1);
      const p1i = polar(cx,cy,r0,a1), p0i = polar(cx,cy,r0,a0);
      const largeArc = (a1 - a0) > Math.PI ? 1 : 0;

      const d = [
        `M ${p0o.x} ${p0o.y}`,
        `A ${r1} ${r1} 0 ${largeArc} 1 ${p1o.x} ${p1o.y}`,
        `L ${p1i.x} ${p1i.y}`,
        `A ${r0} ${r0} 0 ${largeArc} 0 ${p0i.x} ${p0i.y}`,
        "Z"
      ].join(" ");

      const path = document.createElementNS("http://www.w3.org/2000/svg","path");
      path.setAttribute("d", d);
      path.setAttribute("fill", "black");
      path.setAttribute("fill-opacity", String(opacity));
      svg.appendChild(path);
    }

    function placeLabel(text, slotMid, slots, cx, cy, rText, fontSize){
      const clean = (text || "").trim();
      if (!clean) return;

      const ang = slotToAngle(slotMid, slots);
      const p = polar(cx,cy,rText,ang);

      const deg = ang * 180/Math.PI;
      let rot = deg + 90;
      if (deg > 90 && deg < 270) rot += 180;

      const lines = wrapText(clean, 14).slice(0,3);

      const t = document.createElementNS("http://www.w3.org/2000/svg","text");
      t.setAttribute("x", p.x);
      t.setAttribute("y", p.y);
      t.setAttribute("fill","black");
      t.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif");
      t.setAttribute("font-size", String(fontSize));
      t.setAttribute("font-weight","950");
      t.setAttribute("text-anchor","middle");
      t.setAttribute("dominant-baseline","middle");
      t.setAttribute("transform", `rotate(${rot} ${p.x} ${p.y})`);
      svg.appendChild(t);

      lines.forEach((ln,i)=>{
        const sp = document.createElementNS("http://www.w3.org/2000/svg","tspan");
        sp.setAttribute("x", p.x);
        sp.setAttribute("dy", i===0 ? "0" : String(fontSize+2));
        sp.textContent = ln;
        t.appendChild(sp);
      });
    }

    function drawClockFace(cx,cy,R,innerR,tag,slotMinutes){
      addCircle(cx,cy,R, 3.25);
      addCircle(cx,cy,innerR, 3.25);
      addText(cx, cy + R + 46, tag, 22, 950, "middle");

      const slots = Math.round((12*60)/slotMinutes);
      const majorEvery = Math.max(1, Math.round(60/slotMinutes));

      for (let i=0;i<slots;i++){
        const ang = slotToAngle(i, slots);
        const p1 = polar(cx,cy,innerR, ang);
        const p2 = polar(cx,cy,R, ang);
        addLine(p1.x,p1.y,p2.x,p2.y, (i%majorEvery===0)?3.25:2.0);
      }

      for (let h=0;h<12;h++){
        const label = (h===0) ? "12" : String(h);
        const ang = hourToAngle(h);
        const p = polar(cx,cy,R+26, ang);
        addText(p.x,p.y,label,20,950,"middle");
      }
    }

    function addText(x,y,txt,size,weight,anchor="start"){
      const t = document.createElementNS("http://www.w3.org/2000/svg","text");
      t.setAttribute("x", x); t.setAttribute("y", y);
      t.setAttribute("fill","black");
      t.setAttribute("font-family", "system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif");
      t.setAttribute("font-size", String(size));
      t.setAttribute("font-weight", String(weight));
      t.setAttribute("text-anchor", anchor);
      t.setAttribute("dominant-baseline","middle");
      t.textContent = txt;
      svg.appendChild(t);
    }
    function addLine(x1,y1,x2,y2,sw){
      const ln = document.createElementNS("http://www.w3.org/2000/svg","line");
      ln.setAttribute("x1",x1); ln.setAttribute("y1",y1);
      ln.setAttribute("x2",x2); ln.setAttribute("y2",y2);
      ln.setAttribute("stroke","black");
      ln.setAttribute("stroke-width", String(sw));
      ln.setAttribute("stroke-linecap","round");
      svg.appendChild(ln);
    }
    function addCircle(x,y,r,sw){
      const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
      c.setAttribute("cx",x); c.setAttribute("cy",y); c.setAttribute("r",r);
      c.setAttribute("fill","none");
      c.setAttribute("stroke","black");
      c.setAttribute("stroke-width", String(sw));
      svg.appendChild(c);
    }
    function hourToAngle(h){ return (-Math.PI/2) + (h * (2*Math.PI/12)); }
    function slotToAngle(i,slots){ return (-Math.PI/2) + (i * (2*Math.PI/slots)); }
    function polar(cx,cy,r,a){ return { x: cx + r*Math.cos(a), y: cy + r*Math.sin(a) }; }
    function wrapText(str,maxChars){
      const words = str.split(/\s+/).filter(Boolean);
      const out=[]; let cur="";
      for (const w of words){
        const next = cur ? (cur+" "+w) : w;
        if (next.length<=maxChars) cur=next;
        else{ if(cur) out.push(cur); cur = w.length>maxChars ? w.slice(0,maxChars-1)+"…" : w; }
      }
      if(cur) out.push(cur);
      return out;
    }
    function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
  }

  function downloadSVG(){
    const xml = new XMLSerializer().serializeToString(svg);
    const blob = new Blob([xml], {type:"image/svg+xml;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "circle-time-planner.svg";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function seed(){
    addRow({ startH:"12", startM:"00", startMer:"AM", endH:"5", endM:"00", endMer:"AM", label:"Sleep" });
    addRow(); // blank row ready
  }

  seed();
  renderTable();
  renderPlanner();
})();
</script>
</body>
</html>
