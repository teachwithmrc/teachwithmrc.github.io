<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coin Counter Generator - PREVIEW MODE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: "Poppins", sans-serif;
      background: #fff;
    }

    .frame-wrap {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      border: 0;
      background: #fff;
    }

    .live-frame {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
      background: #fff;
    }

    .preview-watermark {
      position: absolute;
      left: 0;
      right: 0;
      top: 420px;
      bottom: 0;
      z-index: 20;
      pointer-events: none;
      background: rgba(255, 255, 255, 0.06);
      background-image: url("data:image/svg+xml,%3Csvg width='250' height='250' viewBox='0 0 250 250' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='20' y='150' fill='%23000' opacity='0.14' transform='rotate(-45 125 125)' font-family='Poppins' font-weight='900' font-size='30'%3EPREVIEW MODE%3C/text%3E%3C/svg%3E");
    }

    .preview-shade {
      position: absolute;
      left: 0;
      right: 0;
      top: 520px;
      bottom: 0;
      z-index: 30;
      pointer-events: none;
      background: linear-gradient(
        to bottom,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.14) 40%,
        rgba(255,255,255,0.24) 100%
      );
      backdrop-filter: blur(0.9px);
      -webkit-backdrop-filter: blur(0.9px);
    }

    @media print {
      body { display: none !important; }
    }
  </style>
  <script src="preview_customize_toggle_injector.js" defer></script>
</head>
<body oncontextmenu="return false;">
  <div class="frame-wrap">
    <iframe
      id="liveFrame"
      class="live-frame"
      src="counting_coin_generator.html?v=20260223-coin-live1"
      title="Coin Counter Generator Preview"
      loading="eager"
    ></iframe>

    <div class="preview-watermark" aria-hidden="true"></div>
    <div class="preview-shade" aria-hidden="true"></div>
  </div>

  <script>
    (function () {
      const liveFrame = document.getElementById("liveFrame");

      function blockedAction() {
        alert("This feature is locked in Preview Mode.\nPlease join membership for full worksheet access.");
      }

      function blockShortcuts(event) {
        const blocked = (event.ctrlKey || event.metaKey) && ["p", "s", "u"].includes(String(event.key || "").toLowerCase());
        if (blocked) {
          event.preventDefault();
          blockedAction();
        }
      }

      document.addEventListener("keydown", blockShortcuts);

      liveFrame.addEventListener("load", function () {
        try {
          const frameWin = liveFrame.contentWindow;
          const frameDoc = liveFrame.contentDocument || frameWin.document;
          if (!frameDoc) return;
          const watermark = document.querySelector(".preview-watermark");
          const shade = document.querySelector(".preview-shade");

          frameDoc.addEventListener("contextmenu", function (e) {
            e.preventDefault();
          });

          frameDoc.addEventListener("keydown", function (e) {
            const blocked = (e.ctrlKey || e.metaKey) && ["p", "s", "u"].includes(String(e.key || "").toLowerCase());
            if (blocked) {
              e.preventDefault();
              blockedAction();
            }
          });

          if (frameWin) {
            frameWin.print = blockedAction;
          }

          const printLikeButtons = frameDoc.querySelectorAll("button");
          printLikeButtons.forEach(function (btn) {
            if (/print/i.test(btn.textContent || "")) {
              btn.addEventListener("click", function (e) {
                e.preventDefault();
                blockedAction();
              }, true);
            }
          });

          const sheet = frameDoc.getElementById("sheet");
          if (sheet) {
            sheet.style.filter = "blur(1.2px) saturate(0.92)";
            const start = Math.max(300, Math.round(sheet.getBoundingClientRect().top + 6));
            if (watermark) {
              watermark.style.top = start + "px";
            }
            if (shade) {
              shade.style.top = (start + 100) + "px";
            }
          }

          const subtitle = frameDoc.querySelector(".subtitle");
          if (subtitle) {
            subtitle.textContent = "Preview mode: Generate is enabled, lower worksheet area is locked for members.";
          }
        } catch (err) {
          // If browser blocks frame scripting, fallback still shows lock overlays.
        }
      });
    })();
  </script>
</body>
</html>
