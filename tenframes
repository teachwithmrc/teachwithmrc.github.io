<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ten Frame Addition/Subtraction Generator</title>

  <!-- Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#111;
      --line:#111;
      --soft:#f6f7fb;
      --accent:#6EC1FF;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:#fff;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 16px 28px;
    }

    .header{
      border:2px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      margin-bottom:14px;
    }
    .headerTop{
      background:var(--accent);
      padding:14px 16px;
    }
    .headerTop h1{
      margin:0;
      font-size:22px;
      font-weight:800;
      color:#fff;
      letter-spacing:.3px;
    }
    .headerBody{
      padding:14px 16px 16px;
      background:#fff;
    }

    .controls{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
      align-items:end;
    }

    .field{
      grid-column: span 3;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .field.wide{ grid-column: span 6; }
    .field.small{ grid-column: span 2; }
    .field label{
      font-size:12px;
      font-weight:600;
    }
    select, input[type="number"]{
      height:38px;
      border:2px solid var(--line);
      border-radius:10px;
      padding:6px 10px;
      font-family:"Poppins", sans-serif;
      font-size:14px;
      outline:none;
      background:#fff;
      width:100%;
    }

    .checks{
      grid-column: span 12;
      display:flex;
      flex-wrap:wrap;
      gap:10px 16px;
      margin-top:6px;
      padding-top:10px;
      border-top:1px solid #e7e7e7;
    }
    .check{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:13px;
    }
    .check input{ width:18px; height:18px; }

    .actions{
      grid-column: span 12;
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    button{
      height:40px;
      border:2px solid var(--line);
      border-radius:10px;
      background:#fff;
      font-family:"Poppins", sans-serif;
      font-weight:800;
      padding:0 14px;
      cursor:pointer;
    }
    button.primary{
      background:#111;
      color:#fff;
    }

    /* Page (print area) */
    .sheet{
      border:2px solid var(--line);
      border-radius:14px;
      padding:14px 14px 10px;
      background:#fff;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px 14px;
      margin-top:6px;
    }

    .q{
      border:2px solid var(--line);
      border-radius:14px;
      padding:10px 10px 8px;
      min-height:138px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .qTop{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
    }

    .expr{
      font-size:18px;
      font-weight:800;
      line-height:1.1;
      white-space:nowrap;
    }
    .blank{
      display:inline-block;
      border-bottom:2px solid var(--line);
      width:80px;
      transform: translateY(-2px);
    }

    .frames{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }

    .tenframe{
      border:2px solid var(--line);
      border-radius:10px;
      padding:6px;
    }
    .tfGrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap:6px;
    }
    .cell{
      border:2px solid var(--line);
      border-radius:8px;
      aspect-ratio: 1 / 1;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }

    .dot{
      width:70%;
      height:70%;
      border-radius:999px;
      background:#111;
    }

    /* “Added” dots for addition (second addend) */
    .dot.add{
      background:#111;
      outline:3px solid #fff; /* subtle differentiation but still b/w */
      outline-offset:-2px;
    }

    /* Cross-out for subtraction */
    .cross::before, .cross::after{
      content:"";
      position:absolute;
      width:90%;
      height:3px;
      background:#111;
      left:5%;
      top:50%;
      transform-origin:center;
    }
    .cross::before{ transform:translateY(-50%) rotate(45deg); }
    .cross::after{ transform:translateY(-50%) rotate(-45deg); }

    .footer{
      margin-top:10px;
      font-size:11px;
      text-align:center;
      border-top:2px solid var(--line);
      padding-top:8px;
      font-weight:600;
    }

    /* Print */
    @media print{
      body{ background:#fff; }
      .header{ display:none; }
      .wrap{ padding:0; margin:0; max-width:none; }
      .sheet{ border:none; border-radius:0; padding:0; }
      .q{ break-inside:avoid; }
      button, select, input{ display:none !important; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="headerTop">
        <h1>Ten Frame Addition / Subtraction Generator</h1>
      </div>
      <div class="headerBody">
        <div class="controls">
          <div class="field">
            <label for="mode">Operation</label>
            <select id="mode">
              <option value="add">Addition</option>
              <option value="sub">Subtraction</option>
            </select>
          </div>

          <div class="field small">
            <label for="minVal">Lowest #</label>
            <input id="minVal" type="number" min="0" max="20" value="0"/>
          </div>

          <div class="field small">
            <label for="maxVal">Highest #</label>
            <input id="maxVal" type="number" min="1" max="20" value="20"/>
          </div>

          <div class="field wide">
            <label>Defaults (recommended)</label>
            <div style="font-size:12px; line-height:1.3;">
              Addition defaults to <b>crossing 10</b> (make-a-ten). Subtraction defaults to <b>crossing 10</b> (like 15−7) and avoids easy ones (like 16−3).
            </div>
          </div>

          <div class="checks">
            <div class="check">
              <input id="preferMakeTen" type="checkbox" checked />
              <label for="preferMakeTen">Prefer “make-a-ten / cross 10” problems</label>
            </div>

            <div class="check" id="addPrefillWrap">
              <input id="addPrefill" type="checkbox" checked />
              <label for="addPrefill">Addition: show first number filled + show added dots</label>
            </div>

            <div class="check" id="subPrefillWrap" style="display:none;">
              <input id="subPrefill" type="checkbox" checked />
              <label for="subPrefill">Subtraction: show minuend filled</label>
            </div>

            <div class="check" id="subCrossWrap" style="display:none;">
              <input id="subCross" type="checkbox" checked />
              <label for="subCross">Subtraction: cross out the dots being taken away</label>
            </div>
          </div>

          <div class="actions">
            <button class="primary" id="btnGen">Generate 10 Questions</button>
            <button id="btnPrint">Print</button>
          </div>
        </div>
      </div>
    </div>

    <div class="sheet" id="sheet">
      <div class="grid" id="grid"></div>
      <div class="footer">Copyright - Generated from InterventionStation.com - @TeachWithMrC</div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const modeEl = $("mode");
    const minEl = $("minVal");
    const maxEl = $("maxVal");

    const preferMakeTenEl = $("preferMakeTen");

    const addPrefillEl = $("addPrefill");
    const subPrefillEl = $("subPrefill");
    const subCrossEl  = $("subCross");

    const addPrefillWrap = $("addPrefillWrap");
    const subPrefillWrap = $("subPrefillWrap");
    const subCrossWrap   = $("subCrossWrap");

    const gridEl = $("grid");

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
    function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }
    function shuffle(arr){
      for (let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function normalizeBounds(){
      let lo = clamp(parseInt(minEl.value || "0", 10), 0, 20);
      let hi = clamp(parseInt(maxEl.value || "20", 10), 1, 20);
      if (hi < lo) [lo, hi] = [hi, lo];
      minEl.value = lo;
      maxEl.value = hi;
      return { lo, hi };
    }

    // Rule: no "max + anything" (e.g., 20 + __) and also avoid "__ + max"
    function violatesNoMaxAddend(a, b, hi){
      return (a === hi || b === hi);
    }

    // Build “make-a-ten friendly” addition:
    // - Prefer a in 6..9 and b so that a+b crosses 10 (if possible) and <= hi.
    function makeAddition(lo, hi, preferMakeTen){
      // Attempt several times to satisfy constraints.
      for (let t = 0; t < 60; t++){
        let a, b;

        if (preferMakeTen && hi >= 11){
          a = randInt(6, 9);
          // Need b so that sum crosses 10: b >= (11 - a)
          const bMin = Math.max(1, 11 - a);
          const bMax = Math.min(hi - a, 9); // keep b reasonable
          if (bMin > bMax) continue;
          b = randInt(bMin, bMax);
        } else {
          a = randInt(Math.max(lo, 0), hi - 1);
          b = randInt(Math.max(lo, 0), hi - a);
          if (b === 0) b = 1;
        }

        const sum = a + b;
        if (sum < lo || sum > hi) continue;
        if (violatesNoMaxAddend(a, b, hi)) continue;
        if (a < 0 || b < 0) continue;

        return { a, b, ans: sum };
      }

      // Fallback: pick any safe pair with sum <= hi and neither addend == hi
      for (let t = 0; t < 200; t++){
        const a = randInt(0, hi - 1);
        const b = randInt(1, Math.max(1, hi - a));
        const sum = a + b;
        if (sum >= lo && sum <= hi && !violatesNoMaxAddend(a, b, hi)){
          return { a, b, ans: sum };
        }
      }

      // Absolute fallback
      return { a: 8, b: 4, ans: 12 };
    }

    // Build “crossing 10” subtraction:
    // Choose minuend m (>=11) and subtrahend s such that:
    // - 0 <= m-s
    // - Prefer crossing 10: s > (m - 10)
    // This naturally avoids 16-3 (since 3 <= 6).
    function makeSubtraction(lo, hi, preferMakeTen){
      for (let t = 0; t < 80; t++){
        const mMin = Math.max(1, lo, preferMakeTen ? 11 : lo);
        const m = randInt(mMin, hi);

        let sMin = 1;
        let sMax = m - 1;

        if (preferMakeTen && m >= 11){
          sMin = Math.max(1, (m - 9));    // keeps result <=9 (like 15-7 -> 8)
          sMax = Math.min(9, m - 1);      // keep s in 1..9 by default
          // must cross 10:
          sMin = Math.max(sMin, (m - 10) + 1);
        }

        if (sMin > sMax) continue;

        const s = randInt(sMin, sMax);
        const d = m - s;

        if (d < 0) continue;
        if (d < lo || d > hi) continue;

        return { a: m, b: s, ans: d };
      }

      // Fallback: any valid subtraction within bounds
      for (let t = 0; t < 200; t++){
        const m = randInt(lo, hi);
        const s = randInt(1, Math.max(1, m));
        const d = m - s;
        if (d >= lo && d <= hi && d >= 0){
          return { a: m, b: s, ans: d };
        }
      }

      return { a: 15, b: 7, ans: 8 };
    }

    // Ten-frame rendering helpers
    function dotsForNumber(n){
      // Return two arrays of 10 booleans each (frame1, frame2) where true=dot.
      const f1 = Array(10).fill(false);
      const f2 = Array(10).fill(false);
      const clamped = clamp(n, 0, 20);

      const first = Math.min(10, clamped);
      for (let i = 0; i < first; i++) f1[i] = true;

      const rest = Math.max(0, clamped - 10);
      for (let i = 0; i < rest; i++) f2[i] = true;

      return [f1, f2];
    }

    function buildTenFrame(frameDots, opts){
      // opts: { addedIdx:Set, crossedIdx:Set }
      const wrap = document.createElement("div");
      wrap.className = "tenframe";

      const grid = document.createElement("div");
      grid.className = "tfGrid";

      for (let i = 0; i < 10; i++){
        const cell = document.createElement("div");
        cell.className = "cell";

        if (frameDots[i]){
          const dot = document.createElement("div");
          dot.className = "dot";
          if (opts?.addedIdx?.has(i)) dot.classList.add("add");
          cell.appendChild(dot);

          if (opts?.crossedIdx?.has(i)) cell.classList.add("cross");
        }
        grid.appendChild(cell);
      }

      wrap.appendChild(grid);
      return wrap;
    }

    function buildQuestionCard(q){
      // q: { mode, a, b, ans, showAddPrefill, showSubPrefill, showSubCross }
      const card = document.createElement("div");
      card.className = "q";

      const top = document.createElement("div");
      top.className = "qTop";

      const expr = document.createElement("div");
      expr.className = "expr";

      const op = q.mode === "add" ? "+" : "−";
      expr.innerHTML = `${q.a} ${op} ${q.b} = <span class="blank"></span>`;
      top.appendChild(expr);

      card.appendChild(top);

      const frames = document.createElement("div");
      frames.className = "frames";

      // Always show two frames (up to 20)
      // Addition display:
      // - Frame A: dots for first number (a)
      // - Frame B: dots show full sum, but mark the "added" portion as .add (b dots after a)
      if (q.mode === "add"){
        if (!q.showAddPrefill){
          // If not prefilled, just show empty frames for students to model.
          frames.appendChild(buildTenFrame(Array(10).fill(false)));
          frames.appendChild(buildTenFrame(Array(10).fill(false)));
        } else {
          const [a1, a2] = dotsForNumber(q.a);
          frames.appendChild(buildTenFrame(a1));
          frames.appendChild(buildTenFrame(a2));

          // Second set: show sum, highlight which dots are the "b"
          const sum = q.ans;
          const [s1, s2] = dotsForNumber(sum);

          // Determine which indices correspond to "added" dots:
          // We'll simulate filling left-to-right; the first q.a dots are base, the next q.b are added.
          const addedF1 = new Set();
          const addedF2 = new Set();

          const base = q.a;
          const addCount = q.b;

          // Added dots positions (0-based in 20-slot space)
          for (let k = base; k < base + addCount; k++){
            if (k < 10) addedF1.add(k);
            else addedF2.add(k - 10);
          }

          frames.appendChild(buildTenFrame(s1, { addedIdx: addedF1 }));
          frames.appendChild(buildTenFrame(s2, { addedIdx: addedF2 }));
        }
      }

      // Subtraction display:
      // - Show minuend filled; optionally cross out the last b dots (rightmost in fill order)
      if (q.mode === "sub"){
        if (!q.showSubPrefill){
          frames.appendChild(buildTenFrame(Array(10).fill(false)));
          frames.appendChild(buildTenFrame(Array(10).fill(false)));
        } else {
          const [m1, m2] = dotsForNumber(q.a);

          if (!q.showSubCross){
            frames.appendChild(buildTenFrame(m1));
            frames.appendChild(buildTenFrame(m2));
          } else {
            // Build sets of crossed indices in 20-slot space (cross out the last q.b dots)
            const crossedF1 = new Set();
            const crossedF2 = new Set();

            const startCross = q.a - q.b; // dots from here to q.a-1 get crossed
            for (let k = startCross; k < q.a; k++){
              if (k < 10) crossedF1.add(k);
              else crossedF2.add(k - 10);
            }

            frames.appendChild(buildTenFrame(m1, { crossedIdx: crossedF1 }));
            frames.appendChild(buildTenFrame(m2, { crossedIdx: crossedF2 }));
          }
        }
      }

      card.appendChild(frames);
      return card;
    }

    function generate(){
      const { lo, hi } = normalizeBounds();
      const mode = modeEl.value;
      const preferMakeTen = !!preferMakeTenEl.checked;

      const showAddPrefill = !!addPrefillEl.checked;
      const showSubPrefill = !!subPrefillEl.checked;
      const showSubCross = !!subCrossEl.checked;

      const questions = [];
      const seen = new Set();

      // create 10 unique-ish questions
      let guard = 0;
      while (questions.length < 10 && guard < 600){
        guard++;

        let q;
        if (mode === "add"){
          q = makeAddition(lo, hi, preferMakeTen);
          const keyA = `${q.a}+${q.b}`;
          const keyB = `${q.b}+${q.a}`;
          if (seen.has(keyA) || seen.has(keyB)) continue;
          seen.add(keyA);

          questions.push({
            mode,
            a:q.a, b:q.b, ans:q.ans,
            showAddPrefill
          });
        } else {
          q = makeSubtraction(lo, hi, preferMakeTen);
          const key = `${q.a}-${q.b}`;
          if (seen.has(key)) continue;
          seen.add(key);

          questions.push({
            mode,
            a:q.a, b:q.b, ans:q.ans,
            showSubPrefill,
            showSubCross
          });
        }
      }

      gridEl.innerHTML = "";
      questions.forEach(item => gridEl.appendChild(buildQuestionCard(item)));
    }

    function syncModeUI(){
      const mode = modeEl.value;
      if (mode === "add"){
        addPrefillWrap.style.display = "";
        subPrefillWrap.style.display = "none";
        subCrossWrap.style.display = "none";
      } else {
        addPrefillWrap.style.display = "none";
        subPrefillWrap.style.display = "";
        subCrossWrap.style.display = "";
      }
      generate();
    }

    $("btnGen").addEventListener("click", generate);
    $("btnPrint").addEventListener("click", () => window.print());

    modeEl.addEventListener("change", syncModeUI);
    [minEl, maxEl, preferMakeTenEl, addPrefillEl, subPrefillEl, subCrossEl].forEach(el => {
      el.addEventListener("change", generate);
    });

    // Init
    syncModeUI();
  </script>
</body>
</html>
