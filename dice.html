<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Roll and Read</title>

  <script src="fluencyDataFull_v3.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 20px;
      text-align: center;
    }

    @page {
      size: landscape;
      margin: 0.3in;
    }

    h2 {
      font-size: 32px;
      margin: 0;
    }

    .subtitle {
      font-size: 18px;
      margin-bottom: 10px;
    }

    table {
      border-collapse: collapse;
      margin: 0 auto;
    }

    td {
      border: 2px solid black;
      text-align: center;
      vertical-align: middle;
      padding: 8px 12px;
      min-width: 100px;
      max-width: 180px;
      word-wrap: break-word;
    }

    .dice-cell {
      border: none;
      padding: 4px;
    }

    .word-cell {
      font-size: 22px;
      font-weight: 600;
    }

    .sentence-cell {
      font-size: 18px;
    }

    #gridHeader {
      margin-bottom: 10px;
    }

    #gridContainer {
      page-break-inside: avoid;
    }

    .copyright {
      margin-top: 15px;
      font-size: 12px;
    }
  </style>
</head>
<body>

  <div id="gridHeader"></div>
  <div id="gridContainer"></div>

  <div class="copyright">© 2025 TeachwithMrC - Intervention Station</div>

  <script>
    // Example skill map for display
    const skillMap = {
      "0.1": "A",
      "0.2": "O",
      "0.3": "I",
      "0.4": "U",
      "0.5": "E"
    };

    // Example selected skills for demo
    const selectedSkills = new Set(["0.1", "0.2"]); // short A & O
    const contentType = "words"; // could be 'words', 'sentences', or 'both'
    const gridSize = 30; // 18, 24, or 30

    function generateGrid() {
      const selected = Array.from(selectedSkills);
      if (!selected.length || !contentType) {
        alert("❗ Please select skills and a content type.");
        return;
      }

      // Determine columns/rows based on grid size
      const cols = 6;
      const rows = gridSize / cols + 1; // +1 for dice row

      // Format selected skills for title
      const skillNames = selected.map(skill => {
        if (skill === "mixed") return "Mixed CVC";
        if (skill === "0.6") return "FLSZ";
        if (skill === "0.7") return "FLSZ and CVC";
        return `Short ${skillMap[skill]}`;
      }).join(", ");

      // Build pool of words/sentences equally split per skill
      const perSkill = Math.floor(gridSize / selected.length);
      const extra = gridSize % selected.length;
      let finalPool = [];

      selected.forEach((skill, idx) => {
        let key;
        if (contentType === "words") key = Object.keys(fluencyData.words).find(k => k.includes(skillMap[skill]));
        else if (contentType === "sentences") key = Object.keys(fluencyData.sentences).find(k => k.includes(skillMap[skill]));
        else key = Object.keys(fluencyData.words).find(k => k.includes(skillMap[skill])); // fallback

        let words = fluencyData.words[key] || [];
        words = words.sort(() => 0.5 - Math.random()); // shuffle

        const takeCount = perSkill + (idx < extra ? 1 : 0);
        finalPool.push(...words.slice(0, takeCount));
      });

      // Build table with dice top row
      let table = "<table><tr>";
      for (let c = 0; c < cols; c++) {
        table += `<td class="dice-cell"><img src="image/dice${c+1}.png" style="width:60px;height:60px;"></td>`;
      }
      table += "</tr>";

      let index = 0;
      for (let r = 1; r < rows; r++) {
        table += "<tr>";
        for (let c = 0; c < cols; c++) {
          const val = finalPool[index++] || "";
          const cellClass = val.split(" ").length > 3 ? "sentence-cell" : "word-cell";
          table += `<td class="${cellClass}">${val}</td>`;
        }
        table += "</tr>";
      }
      table += "</table>";

      document.getElementById("gridHeader").innerHTML = `
        <h2>Roll and Read</h2>
        <div class="subtitle">Skills: ${skillNames}</div>
      `;
      document.getElementById("gridContainer").innerHTML = table;
    }

    generateGrid();
  </script>

</body>
</html>
