<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phonics Board Game Generator</title>
  <script src="fluencyDataFull_v3.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 20px;
      text-align: center;
    }

    h1 { font-size: 26px; margin-bottom: 10px; }
    .subtitle { font-size: 16px; margin-bottom: 20px; }

    .skill-button-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .skill-button-grid .row {
      display: flex;
      justify-content: center;
      gap: 8px;
    }

    .skill-button {
      border: 2px solid #000;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    .skill-button.selected { background-color: #007bff; color: white; }

    table.board { border-collapse: collapse; margin: 0 auto; }
    td {
      width: 75px; height: 75px;
      text-align: center; vertical-align: middle;
    }

    .board-cell {
      border-radius: 50%;
      border: 2px solid black;
      font-size: 18px;
      font-weight: bold;
      color: black;
      word-wrap: break-word;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .empty-cell { border: none; background: none; }

    /* ✅ Ensure colors and circles print */
    @media print {
      @page { size: landscape; }
      body * { visibility: hidden; }
      #printableSection, #printableSection * { visibility: visible; }
      #printableSection { position: absolute; left: 0; top: 0; width: 100%; }

      body, .board-cell {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
    }
  </style>
</head>
<body>
  <h1>Phonics Board Game Generator</h1>
  <div class="subtitle">Select your skill(s) and generate a random path board.</div>

  <div class="skill-button-grid">
    <div class="row">
      <div class="skill-button" data-skill="0.1">Short A</div>
      <div class="skill-button" data-skill="0.2">Short O</div>
      <div class="skill-button" data-skill="0.3">Short I</div>
      <div class="skill-button" data-skill="0.4">Short U</div>
      <div class="skill-button" data-skill="0.5">Short E</div>
    </div>
    <div class="row">
      <div class="skill-button" data-skill="0.6">FLSZ</div>
      <div class="skill-button" data-skill="0.7">CVC & FLSZ</div>
      <div class="skill-button" data-skill="mixed">Mixed CVC</div>
    </div>
  </div>

  <button onclick="generateBoard()" style="font-size: 18px; padding: 10px 24px;">Generate Board</button>
  <button onclick="window.print()" style="font-size: 18px; padding: 10px 24px;">Print</button>

  <div id="printableSection" style="margin-top: 20px;"></div>

<script>
  const selectedSkills = new Set();
  const colors = ['#FF9999','#FFCC99','#FFFF99','#CCFF99','#99FFCC','#99CCFF','#CC99FF','#FF99CC'];

  const skillLabelMap = {
    "0.1": "Short A",
    "0.2": "Short O",
    "0.3": "Short I",
    "0.4": "Short U",
    "0.5": "Short E",
    "0.6": "FLSZ",
    "0.7": "FLSZ and CVC",
    "mixed": "Mixed CVC"
  };

  document.querySelectorAll('.skill-button').forEach(button => {
    button.addEventListener('click', () => {
      const skill = button.dataset.skill;
      if (selectedSkills.has(skill)) {
        selectedSkills.delete(skill);
        button.classList.remove('selected');
      } else {
        selectedSkills.add(skill);
        button.classList.add('selected');
      }
    });
  });

  // Define a fixed 7x7 path
  const pathCoords = [
    [0,0],[0,1],[0,2],[0,3],[0,4],[0,5],
    [1,5],[2,5],[3,5],
    [3,4],[3,3],[3,2],[3,1],[3,0],
    [4,0],[5,0],[6,0],[6,1],[6,2],[6,3],[6,4],[6,5],[6,6],
    [5,6],[4,6]
  ];

  function generateBoard() {
    const skills = Array.from(selectedSkills);
    if (skills.length === 0) {
      alert("Please select at least one skill.");
      return;
    }

    const allWords = [];
    for (const skill of skills) {
      const key = (skill === "mixed") ? "Mixed CVC Words" : `${skill} - ${skillLabelMap[skill]} Words`;
      if (window.fluencyData.words[key]) allWords.push(...window.fluencyData.words[key]);
    }

    if (allWords.length === 0) {
      alert("No words found for the selected skill(s).");
      return;
    }

    const shuffled = allWords.sort(() => 0.5 - Math.random());
    const wordsForPath = shuffled.slice(0, pathCoords.length);

    // ✅ Set START and FINISH
    wordsForPath[0] = "START";
    wordsForPath[wordsForPath.length - 1] = "FINISH!";

    // Create 7x7 table
    const table = document.createElement('table');
    table.className = 'board';
    for (let r = 0; r < 7; r++) {
      const row = table.insertRow();
      for (let c = 0; c < 7; c++) {
        const cell = row.insertCell();
        cell.className = 'empty-cell';
      }
    }

    // Fill path
    pathCoords.forEach((coord, i) => {
      const [r, c] = coord;
      const cell = table.rows[r].cells[c];
      cell.className = 'board-cell';
      cell.style.backgroundColor = colors[i % colors.length];
      cell.textContent = wordsForPath[i] || "";
    });

    const printableSection = document.getElementById('printableSection');
    printableSection.innerHTML = '';
    printableSection.appendChild(table);
  }
</script>
</body>
</html>
