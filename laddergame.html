<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CVC Word Ladder Generator</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      text-align: center;
      margin: 40px;
    }

    h1 {
      margin-bottom: 20px;
    }

    label {
      display: inline-block;
      margin: 0 10px;
      font-size: 16px;
    }

    .ladder-table {
      border-collapse: collapse;
      margin: 30px auto;
    }

    .ladder-table td {
      padding: 10px;
      vertical-align: middle;
      text-align: center;
    }

    .ladder-cell {
      border: 2px solid black;
      width: 120px;
      height: 50px;
      font-size: 24px;
      font-weight: bold;
    }

    .ladder-cell.bottom-open {
      border-left: 2px solid black;
      border-right: 2px solid black;
      border-top: 2px solid black;
      border-bottom: none;
    }

    .ladder-cell.top-open {
      border-left: 2px solid black;
      border-right: 2px solid black;
      border-top: none;
      border-bottom: 2px solid black;
    }

    .change-box {
      font-size: 18px;
      font-weight: bold;
      width: 80px;
      border: 2px solid black;
      padding: 5px 10px;
      display: inline-block;
      border-radius: 6px;
      background-color: #f9f9f9;
    }

    .picture img {
      height: 50px;
      width: auto;
    }

    button {
      font-size: 16px;
      margin: 20px 10px;
      padding: 10px 20px;
    }
  </style>
</head>
<body>

  <h1>CVC Word Ladder Generator</h1>

  <label><input type="checkbox" id="showHint"> Include hint (b → h)</label>
  <label><input type="checkbox" id="showPhoto"> Include photo</label>

  <br>
  <button onclick="generateLadder()">Generate</button>
  <button onclick="window.print()">Print</button>

  <div id="ladderContainer"></div>

<script>
  function getOneLetterDiff(w1, w2) {
    if (w1.length !== 3 || w2.length !== 3) return false;
    let diff = 0;
    for (let i = 0; i < 3; i++) {
      if (w1[i] !== w2[i]) diff++;
    }
    return diff === 1;
  }

  function generateWordLadder(words, steps = 6) {
    const shuffled = [...words].sort(() => Math.random() - 0.5);
    for (let start of shuffled) {
      const ladder = [start];
      const used = new Set([start]);

      while (ladder.length < steps) {
        const last = ladder[ladder.length - 1];
        const candidates = words.filter(
          w => !used.has(w) && getOneLetterDiff(last, w)
        );
        if (candidates.length === 0) break;
        const next = candidates[Math.floor(Math.random() * candidates.length)];
        ladder.push(next);
        used.add(next);
      }

      if (ladder.length === steps) return ladder.reverse(); // Start word ends at bottom
    }
    return null;
  }

  function generateLadder() {
    const showHint = document.getElementById('showHint').checked;
    const showPhoto = document.getElementById('showPhoto').checked;
    const container = document.getElementById('ladderContainer');
    const error = document.getElementById('errorContainer');

    container.innerHTML = "";
    error.innerHTML = "";

    if (!showHint && !showPhoto) {
      error.textContent = "Please select at least one option: Hint or Photo.";
      return;
    }

    const ladder = generateWordLadder(Object.keys(cvcLadderWords), 6);
    if (!ladder) {
      container.innerHTML = "<p>Could not generate a full ladder. Try again.</p>";
      return;
    }

    const table = document.createElement("table");
    table.className = "ladder-table";

    for (let i = 0; i < ladder.length; i++) {
      const row = document.createElement("tr");
      const word = ladder[i];
      const isTop = i === 0;
      const isBottom = i === ladder.length - 1;

      const left = document.createElement("td");
      const middle = document.createElement("td");
      const right = document.createElement("td");

      if (isBottom) {
        middle.className = "ladder-cell bottom-open";
        middle.innerHTML = `<strong>${word.split('').join(' ')}</strong>`;
      } else {
        middle.className = isTop ? "ladder-cell top-open" : "ladder-cell";
        middle.innerHTML = "_ _ _";
      }

      const prevWord = ladder[i + 1];
      if (!isBottom && getOneLetterDiff(prevWord, word)) {
        let diffIndex = -1;
        for (let j = 0; j < 3; j++) {
          if (prevWord[j] !== word[j]) diffIndex = j;
        }
        const fromChar = prevWord[diffIndex];
        const toChar = word[diffIndex];
        const hintBox = `<div class='change-box'>${fromChar} → ${toChar}</div>`;
        const img = `<div class='picture'><img src='images/${word}.png' alt='${word}'></div>`;

        if (i % 2 === 0) {
          left.innerHTML = showHint ? hintBox : "";
          right.innerHTML = showPhoto ? img : "";
        } else {
          left.innerHTML = showPhoto ? img : "";
          right.innerHTML = showHint ? hintBox : "";
        }
      }

      row.appendChild(left);
      row.appendChild(middle);
      row.appendChild(right);
      table.appendChild(row);
    }

    container.appendChild(table);
  }
</script>
</body>
</html>
