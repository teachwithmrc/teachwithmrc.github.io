<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rounding Generator</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  *{ box-sizing:border-box; }
  html, body{
    margin:0; padding:0;
    font-family:"Poppins", Arial, sans-serif;
    background:#fff; color:#111;
    overflow-x:hidden;
  }
  .wrap{ max-width:1100px; margin:0 auto; padding:12px; }

  /* ========= CONTROLS ========= */
  .controls{
    border:2px solid #111;
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }
  .controls-top{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    align-items:flex-end;
    justify-content:center;
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width:210px;
  }
  .field label{
    font-size:12px;
    font-weight:800;
  }
  select{
    height:42px;
    min-width:210px;
    border:2px solid #111;
    border-radius:10px;
    padding:8px 12px;
    font-family:"Poppins", Arial, sans-serif;
    font-size:14px;
    background:#fff;
  }

  .toggleRow{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
    align-items:center;
  }
  .toggle{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 12px;
    border:2px solid #111;
    border-radius:14px;
    font-weight:900;
    font-size:15px;
    user-select:none;
    background:#fff;
    line-height:1;
  }
  .toggle input[type="checkbox"]{
    appearance:none;
    -webkit-appearance:none;
    width:44px;
    height:26px;
    border:2px solid #111;
    border-radius:999px;
    position:relative;
    margin:0;
    padding:0;
    background:#fff;
    cursor:pointer;
    flex:0 0 auto;
    min-width:44px;
  }
  .toggle input[type="checkbox"]::after{
    content:"";
    position:absolute;
    top:50%;
    left:3px;
    width:18px;
    height:18px;
    border:2px solid #111;
    border-radius:999px;
    background:#fff;
    transform:translateY(-50%);
    transition:all .15s ease;
  }
  .toggle input[type="checkbox"]:checked{ background:#111; }
  .toggle input[type="checkbox"]:checked::after{ left:19px; background:#fff; }

  .toggle.disabled{
    opacity:.55;
    pointer-events:none;
  }

  .controls-actions{
    margin-top:12px;
    display:flex;
    justify-content:center;
    gap:14px;
    flex-wrap:wrap;
  }
  button{
    height:54px;
    padding:0 30px;
    border:2px solid #111;
    border-radius:14px;
    font-weight:900;
    font-size:18px;
    font-family:"Poppins", Arial, sans-serif;
    background:#111;
    color:#fff;
    cursor:pointer;
  }
  button.secondary{ background:#fff; color:#111; }

  .hint{
    margin-top:8px;
    text-align:center;
    font-size:13px;
    font-weight:700;
  }

  /* ========= SHEET ========= */
  .title{
    text-align:center;
    font-size:28px;
    font-weight:900;
    margin:6px 0 10px;
  }

  .grid{
    border:2px solid #111;
  }
  .row{
    display:grid;
    grid-template-columns: 1fr 1fr;
  }
  .cell{
    border-right:2px solid #111;
    border-bottom:2px solid #111;
    padding:12px 12px 18px;
    min-height:235px;
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:flex-start;
  }
  .row .cell:last-child{ border-right:none; }
  .grid .row:last-child .cell{ border-bottom:none; }

  /* Scaffolded: bigger, not smaller */
  body.scaffold .row{ grid-template-columns: 1fr; }
  body.scaffold .cell{
    min-height:265px;
    padding:14px 14px 22px;
  }
  body.scaffold .row .cell{ border-right:none !important; }

  .prompt{
    font-size:18px;
    font-weight:900;
    line-height:1.2;
  }

  /* New centered rewrite line */
  .rewrite{
    width:100%;
    text-align:center;
    font-size:22px;
    font-weight:900;
    letter-spacing:0.5px;
    margin-top:2px;
    margin-bottom:2px;
  }
  .rewrite .u{
    text-decoration: underline;
    text-decoration-thickness: 4px;
    text-underline-offset: 4px;
  }
  .rewrite .c{
    opacity:.35; /* commas */
  }

  .lines{
    font-size:15px;
    font-weight:800;
    display:flex;
    flex-direction:column;
    gap:8px;
    width:100%;
  }
  .lineRow{
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }
  .arrow{
    font-weight:900;
    font-size:18px;
    display:inline-block;
    width:18px;
    text-align:center;
  }

  .ansBox{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:170px;
    height:34px;
    border:2px solid #111;
    border-radius:7px;
    font-weight:900;
    font-size:16px;
    background:#fff;
  }
  .ansBox.empty{ color:transparent; }

  /* Number line area: extra breathing room + prevents clipping */
  .nlWrap{
    width:100%;
    display:flex;
    justify-content:center;
    padding-bottom:18px;
    min-height:135px;
  }
  .nlWrap svg{ max-width:560px; }

  .footer{
    text-align:center;
    font-size:12px;
    font-weight:800;
    margin-top:10px;
  }

  @media print{
    .controls{ display:none; }
    .wrap{ padding:0; max-width:none; }

    body{
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      zoom: 0.94;
    }
    body.scaffold{
      zoom: 1.02; /* scaffolded bigger in print */
    }

    .title{ font-size:24px; margin:4px 0 8px; }
    .cell{
      min-height:225px;
      padding:10px 10px 18px;
      gap:8px;
    }
    body.scaffold .cell{
      min-height:255px;
      padding:12px 12px 22px;
    }
    .prompt{ font-size:17px; }
    .rewrite{ font-size:22px; }
    .lines{ font-size:14px; }
    .footer{ font-size:11px; margin-top:6px; }
  }
</style>
</head>

<body>
<div class="wrap">

  <div class="controls">
    <div class="controls-top">
      <div class="field">
        <label for="nearest">Round to the Nearest</label>
        <select id="nearest">
          <option value="10" selected>Tens</option>
          <option value="100">Hundreds</option>
          <option value="1000">Thousands</option>
          <option value="10000">Ten Thousands</option>
        </select>
      </div>

      <div class="field">
        <label for="within">Numbers Up To</label>
        <select id="within">
          <option value="100" selected>100</option>
          <option value="1000">1,000</option>
          <option value="10000">10,000</option>
          <option value="100000">100,000</option>
        </select>
      </div>
    </div>

    <div class="toggleRow">
      <label class="toggle">
        <input id="scaffold" type="checkbox">
        Scaffolded (1 per line)
      </label>

      <label class="toggle" id="labelAllWrap">
        <input id="labelAll" type="checkbox">
        Label All Tick Marks
      </label>

      <label class="toggle">
        <input id="endpointsFilled" type="checkbox" checked>
        Endpoints Filled In
      </label>

      <label class="toggle">
        <input id="fillDownUp" type="checkbox">
        Fill Round Down/Up
      </label>

      <label class="toggle">
        <input id="showDot" type="checkbox" checked>
        Show Dot on Number Line
      </label>
    </div>

    <div class="controls-actions">
      <button type="button" id="btnGen">Generate</button>
      <button type="button" class="secondary" id="btnPrint">Print</button>
    </div>

    <div class="hint" id="hint"></div>
  </div>

  <div class="title" id="sheetTitle">Round to the Nearest Ten</div>

  <div class="grid" id="grid"></div>

  <div class="footer">Copyright - Generated from InterventionStation.com - @TeachWithMrC</div>
</div>

<script>
  const $ = (id) => document.getElementById(id);
  const PROBLEM_COUNT = 6; // fixed to 6

  function fmt(n){ return n.toLocaleString("en-US"); }

  function placeLabel(place){
    if(place === 10) return "Ten";
    if(place === 100) return "Hundred";
    if(place === 1000) return "Thousand";
    if(place === 10000) return "Ten Thousand";
    return String(place);
  }

  function setTitles(){
    const place = parseInt($("nearest").value, 10);
    $("sheetTitle").textContent = `Round to the Nearest ${placeLabel(place)}`;
  }

  function enforceWithinVsNearest(){
    const nearest = parseInt($("nearest").value, 10);
    const within = parseInt($("within").value, 10);

    // Keep "Numbers Up To" meaningful
    const minWithin = nearest * 10;
    if(within < minWithin){
      const options = [100, 1000, 10000, 100000];
      const next = options.find(v => v >= minWithin) || 100000;
      $("within").value = String(next);
    }

    // Disable Label All Tick Marks for thousands+
    const labelAllWrap = $("labelAllWrap");
    if(nearest >= 1000){
      $("labelAll").checked = false;
      labelAllWrap.classList.add("disabled");
    }else{
      labelAllWrap.classList.remove("disabled");
    }

    const withinNow = parseInt($("within").value, 10);

    // Also enforce the minimum number so the underlined digit exists (no "681 to nearest 1000")
    const minNum = Math.min(nearest, withinNow - 1);
    $("hint").textContent =
      `Generating numbers from ${fmt(minNum)} to ${fmt(withinNow - 1)} and rounding to the nearest ${fmt(nearest)}.`;
  }

  function roundDownTo(n, place){ return Math.floor(n / place) * place; }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  function pickUniqueNumbers(minInclusive, maxInclusive, count, place){
    const span = maxInclusive - minInclusive + 1;
    const seen = new Set();
    const result = [];
    let tries = 0;

    while(result.length < Math.min(count, span) && tries < 120000){
      tries++;
      const n = minInclusive + Math.floor(Math.random() * span);

      // reduce boring exact-boundary numbers (but still allow sometimes)
      if(n % place === 0 && Math.random() < 0.85) continue;

      if(seen.has(n)) continue;
      seen.add(n);
      result.push(n);
    }

    // if range is tight, fill remaining (rare)
    while(result.length < count){
      result.push(minInclusive + Math.floor(Math.random() * span));
    }

    return shuffle(result);
  }

  function makeAnsBox(text){
    const span = document.createElement("span");
    span.className = "ansBox" + (text === null ? " empty" : "");
    span.innerHTML = text === null ? "&nbsp;" : text;
    return span;
  }

  // Build centered rewrite number with underlined digit (the place being rounded to)
  function buildRewriteNumber(n, place){
    // underline digit at exponent = log10(place)
    const exp = Math.round(Math.log10(place)); // 10->1, 100->2, 1000->3, 10000->4

    const s = String(n); // no commas; we'll add commas visually
    const idxFromRight = exp; // tens = 1 => underline digit 2nd from right
    const underlineIndex = s.length - 1 - idxFromRight;

    // Add commas while preserving underline target:
    // We'll render per character of the comma-formatted number.
    const withCommas = n.toLocaleString("en-US"); // e.g., "8,202"
    const rawDigits = s.split("");

    // Map raw digit positions to comma-formatted positions:
    // Walk comma-formatted string; when char is digit, consume next raw digit index.
    let rawPos = 0;
    const container = document.createElement("div");
    container.className = "rewrite";

    for(const ch of withCommas){
      if(ch === ","){
        const sp = document.createElement("span");
        sp.className = "c";
        sp.textContent = ",";
        container.appendChild(sp);
        continue;
      }
      // digit
      const sp = document.createElement("span");
      const currentRawIndex = rawPos;
      sp.textContent = ch;

      if(currentRawIndex === underlineIndex){
        sp.className = "u";
      }
      container.appendChild(sp);
      rawPos++;
    }

    return container;
  }

  // SVG number line: down..up with 10 equal intervals
  // For nearest >= 1000, always label endpoints + midpoint only (prevents clutter)
  function numberLineSVG(n, down, up, place, opts){
    const bigPlace = place >= 1000;
    const labelAll = (!bigPlace && opts.labelAll);
    const midpointOnly = bigPlace; // endpoints + middle tick label

    const endpointsFilled = opts.endpointsFilled;
    const showDot = opts.showDot;

    const W = 560;
    const H = labelAll ? 128 : 118;

    const padL = 44, padR = 44;
    const lineY = 42;

    const x0 = padL;
    const x1 = W - padR;
    const stepX = (x1 - x0) / 10;
    const stepVal = place / 10;

    const ns = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(ns, "svg");
    svg.setAttribute("width", "100%");
    svg.setAttribute("viewBox", `0 0 ${W} ${H}`);

    // base line
    const base = document.createElementNS(ns, "line");
    base.setAttribute("x1", x0);
    base.setAttribute("y1", lineY);
    base.setAttribute("x2", x1);
    base.setAttribute("y2", lineY);
    base.setAttribute("stroke", "#111");
    base.setAttribute("stroke-width", "4");
    svg.appendChild(base);

    // Which ticks get labels?
    function shouldLabel(i){
      if(labelAll) return true;
      if(midpointOnly) return (i===0 || i===5 || i===10);
      return (i===0 || i===10);
    }

    // ticks + labels / endpoint boxes
    for(let i=0;i<=10;i++){
      const x = x0 + stepX*i;

      const tick = document.createElementNS(ns, "line");
      tick.setAttribute("x1", x);
      tick.setAttribute("y1", lineY - 10);
      tick.setAttribute("x2", x);
      tick.setAttribute("y2", lineY + 10);
      tick.setAttribute("stroke", "#111");
      tick.setAttribute("stroke-width", (i===0 || i===10) ? "4" : "3");
      svg.appendChild(tick);

      if(!shouldLabel(i)) continue;

      const val = down + (stepVal * i);

      // move label/boxes safely up so they never clip
      const labelY = lineY + 58;
      const boxY = lineY + 38;

      const isEndpoint = (i===0 || i===10);

      if(isEndpoint && !endpointsFilled){
        const boxW = 78, boxH = 30;
        const rect = document.createElementNS(ns, "rect");
        rect.setAttribute("x", x - boxW/2);
        rect.setAttribute("y", boxY);
        rect.setAttribute("width", boxW);
        rect.setAttribute("height", boxH);
        rect.setAttribute("rx", "7");
        rect.setAttribute("ry", "7");
        rect.setAttribute("fill", "#fff");
        rect.setAttribute("stroke", "#111");
        rect.setAttribute("stroke-width", "3");
        svg.appendChild(rect);
      }else{
        const t = document.createElementNS(ns, "text");
        t.setAttribute("x", x);
        t.setAttribute("y", labelY);
        t.setAttribute("text-anchor", "middle");
        t.setAttribute("font-family", "Poppins, Arial, sans-serif");
        t.setAttribute("font-weight", isEndpoint ? "800" : "700");
        t.setAttribute("font-size", isEndpoint ? "20" : (labelAll ? "12" : "14"));
        t.setAttribute("fill", "#111");
        t.textContent = fmt(val);
        svg.appendChild(t);
      }
    }

    // marker dot
    if(showDot){
      const iPos = (n - down) / stepVal;
      const markerX = x0 + stepX * iPos;

      const dot = document.createElementNS(ns, "circle");
      dot.setAttribute("cx", markerX);
      dot.setAttribute("cy", lineY);
      dot.setAttribute("r", "7");
      dot.setAttribute("fill", "#111");
      svg.appendChild(dot);
    }

    return svg;
  }

  function buildProblemCard(index, n, place, opts){
    const down = roundDownTo(n, place);
    const up = down + place;

    const card = document.createElement("div");
    card.className = "cell";

    const prompt = document.createElement("div");
    prompt.className = "prompt";
    prompt.textContent = `${index}. Round ${fmt(n)} to the nearest ${fmt(place)}.`;
    card.appendChild(prompt);

    // New centered rewrite number with underline
    card.appendChild(buildRewriteNumber(n, place));

    // Down / Up on separate lines with arrows
    const lines = document.createElement("div");
    lines.className = "lines";

    const row1 = document.createElement("div");
    row1.className = "lineRow";
    row1.appendChild(document.createTextNode("Round Down "));
    const downArrow = document.createElement("span");
    downArrow.className = "arrow";
    downArrow.textContent = "↓";
    row1.appendChild(downArrow);
    row1.appendChild(opts.fillDownUp ? makeAnsBox(fmt(down)) : makeAnsBox(null));

    const row2 = document.createElement("div");
    row2.className = "lineRow";
    row2.appendChild(document.createTextNode("Round Up "));
    const upArrow = document.createElement("span");
    upArrow.className = "arrow";
    upArrow.textContent = "↑";
    row2.appendChild(upArrow);
    row2.appendChild(opts.fillDownUp ? makeAnsBox(fmt(up)) : makeAnsBox(null));

    lines.appendChild(row1);
    lines.appendChild(row2);
    card.appendChild(lines);

    const nl = document.createElement("div");
    nl.className = "nlWrap";
    nl.appendChild(numberLineSVG(n, down, up, place, opts));
    card.appendChild(nl);

    return card;
  }

  function build(){
    enforceWithinVsNearest();
    setTitles();

    const place = parseInt($("nearest").value, 10);
    const within = parseInt($("within").value, 10);

    const opts = {
      scaffold: $("scaffold").checked,
      labelAll: $("labelAll").checked,
      endpointsFilled: $("endpointsFilled").checked,
      fillDownUp: $("fillDownUp").checked,
      showDot: $("showDot").checked
    };

    document.body.classList.toggle("scaffold", opts.scaffold);

    const max = Math.max(place, within - 1);
    const min = Math.min(place, within - 1);
    const minInclusive = min;
    const maxInclusive = within - 1;

    const nums = pickUniqueNumbers(minInclusive, maxInclusive, PROBLEM_COUNT, place);

    const grid = $("grid");
    grid.innerHTML = "";

    const perRow = opts.scaffold ? 1 : 2;
    const rows = Math.ceil(PROBLEM_COUNT / perRow);

    let idx = 0;
    for(let r=0;r<rows;r++){
      const row = document.createElement("div");
      row.className = "row";

      for(let c=0;c<perRow;c++){
        if(idx >= PROBLEM_COUNT) break;
        row.appendChild(buildProblemCard(idx+1, nums[idx], place, opts));
        idx++;
      }
      grid.appendChild(row);
    }
  }

  function init(){
    enforceWithinVsNearest();
    setTitles();
    build();
  }

  $("btnGen").addEventListener("click", build);
  $("btnPrint").addEventListener("click", ()=>window.print());

  ["nearest","within","scaffold","labelAll","endpointsFilled","fillDownUp","showDot"]
    .forEach(id => $(id).addEventListener("change", build));

  init();
</script>
</body>
</html>
