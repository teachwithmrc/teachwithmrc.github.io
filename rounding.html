<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rounding Generator</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  *{ box-sizing:border-box; }
  html, body{
    margin:0; padding:0;
    font-family:"Poppins", Arial, sans-serif;
    background:#fff; color:#111;
    overflow-x:hidden;
  }
  .wrap{ max-width:1100px; margin:0 auto; padding:12px; }

  /* ========= CONTROLS ========= */
  .controls{
    border:2px solid #111;
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }
  .controls-top{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    align-items:flex-end;
    justify-content:center;
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width:210px;
  }
  .field label{
    font-size:12px;
    font-weight:800;
  }
  select{
    height:42px;
    min-width:210px;
    border:2px solid #111;
    border-radius:10px;
    padding:8px 12px;
    font-family:"Poppins", Arial, sans-serif;
    font-size:14px;
    background:#fff;
  }

  .toggleRow{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
    align-items:center;
  }
  .toggle{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 12px;
    border:2px solid #111;
    border-radius:14px;
    font-weight:900;
    font-size:15px;
    user-select:none;
    background:#fff;
    line-height:1;
  }
  .toggle input[type="checkbox"]{
    appearance:none;
    -webkit-appearance:none;
    width:44px;
    height:26px;
    border:2px solid #111;
    border-radius:999px;
    position:relative;
    margin:0;
    padding:0;
    background:#fff;
    cursor:pointer;
    flex:0 0 auto;
    min-width:44px;
  }
  .toggle input[type="checkbox"]::after{
    content:"";
    position:absolute;
    top:50%;
    left:3px;
    width:18px;
    height:18px;
    border:2px solid #111;
    border-radius:999px;
    background:#fff;
    transform:translateY(-50%);
    transition:all .15s ease;
  }
  .toggle input[type="checkbox"]:checked{ background:#111; }
  .toggle input[type="checkbox"]:checked::after{ left:19px; background:#fff; }

  .controls-actions{
    margin-top:12px;
    display:flex;
    justify-content:center;
    gap:14px;
    flex-wrap:wrap;
  }
  button{
    height:54px;
    padding:0 30px;
    border:2px solid #111;
    border-radius:14px;
    font-weight:900;
    font-size:18px;
    font-family:"Poppins", Arial, sans-serif;
    background:#111;
    color:#fff;
    cursor:pointer;
  }
  button.secondary{ background:#fff; color:#111; }

  .hint{
    margin-top:8px;
    text-align:center;
    font-size:13px;
    font-weight:700;
  }

  /* ========= SHEET ========= */
  .title{
    text-align:center;
    font-size:28px;
    font-weight:900;
    margin:6px 0 10px;
  }

  .grid{
    border:2px solid #111;
  }
  .row{
    display:grid;
    grid-template-columns: 1fr 1fr; /* default 2 per row */
  }
  .cell{
    border-right:2px solid #111;
    border-bottom:2px solid #111;
    padding:12px 12px 18px; /* EXTRA bottom padding prevents cutoff */
    min-height:210px;
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:flex-start;
  }
  .row .cell:last-child{ border-right:none; }
  .grid .row:last-child .cell{ border-bottom:none; }

  body.scaffold .row{ grid-template-columns: 1fr; }
  body.scaffold .cell{ min-height:235px; }
  body.scaffold .row .cell{ border-right:none !important; }

  .prompt{
    font-size:18px;
    font-weight:900;
    line-height:1.2;
  }

  .lines{
    font-size:15px;
    font-weight:800;
    display:flex;
    flex-direction:column; /* NEW: forces next line */
    gap:8px;
    width:100%;
  }
  .lineRow{
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }
  .arrow{
    font-weight:900;
    font-size:18px;
    display:inline-block;
    width:18px;
    text-align:center;
  }

  /* Answer boxes */
  .ansBox{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:140px;
    height:34px;
    border:2px solid #111;
    border-radius:6px;
    font-weight:900;
    font-size:16px;
    background:#fff;
  }
  .ansBox.empty{ color:transparent; }
  .ansBox.empty::selection{ background:transparent; }

  /* Number line area: reserve space so endpoint boxes never clip */
  .nlWrap{
    width:100%;
    display:flex;
    justify-content:center;
    padding-bottom:12px;   /* critical buffer */
    min-height:120px;      /* guarantees space under SVG */
  }
  .nlWrap svg{ max-width:520px; }

  .footer{
    text-align:center;
    font-size:12px;
    font-weight:800;
    margin-top:10px;
  }

  @media print{
    .controls{ display:none; }
    .wrap{ padding:0; max-width:none; }
    body{
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      zoom: 0.94;
    }
    .title{ font-size:24px; margin:4px 0 8px; }
    .cell{
      min-height:200px;
      padding:10px 10px 18px; /* keep bottom buffer in print */
      gap:8px;
    }
    body.scaffold .cell{ min-height:225px; }
    .prompt{ font-size:17px; }
    .lines{ font-size:14px; }
    .footer{ font-size:11px; margin-top:6px; }
  }
</style>
</head>

<body>
<div class="wrap">

  <div class="controls">
    <div class="controls-top">
      <div class="field">
        <label for="nearest">Round to the Nearest</label>
        <select id="nearest">
          <option value="10" selected>Tens</option>
          <option value="100">Hundreds</option>
          <option value="1000">Thousands</option>
          <option value="10000">Ten Thousands</option>
        </select>
      </div>

      <div class="field">
        <label for="within">Numbers Up To</label>
        <select id="within">
          <option value="100" selected>100</option>
          <option value="1000">1,000</option>
          <option value="10000">10,000</option>
          <option value="100000">100,000</option>
        </select>
      </div>
    </div>

    <div class="toggleRow">
      <label class="toggle">
        <input id="scaffold" type="checkbox">
        Scaffolded (1 per line)
      </label>

      <label class="toggle">
        <input id="labelAll" type="checkbox">
        Label All Tick Marks
      </label>

      <label class="toggle">
        <input id="endpointsFilled" type="checkbox" checked>
        Endpoints Filled In
      </label>

      <label class="toggle">
        <input id="fillDownUp" type="checkbox">
        Fill Round Down/Up
      </label>

      <label class="toggle">
        <input id="showDot" type="checkbox" checked>
        Show Dot on Number Line
      </label>
    </div>

    <div class="controls-actions">
      <button type="button" id="btnGen">Generate</button>
      <button type="button" class="secondary" id="btnPrint">Print</button>
    </div>

    <div class="hint" id="hint"></div>
  </div>

  <div class="title" id="sheetTitle">Round to the Nearest Ten</div>

  <div class="grid" id="grid"></div>

  <div class="footer">Copyright - Generated from InterventionStation.com - @TeachWithMrC</div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  const PROBLEM_COUNT = 6; // ✅ fixed to 6 (3 rows of 2)

  function fmt(n){ return n.toLocaleString("en-US"); }

  function setTitles(){
    const place = parseInt($("nearest").value, 10);
    let label = "Ten";
    if(place === 100) label = "Hundred";
    if(place === 1000) label = "Thousand";
    if(place === 10000) label = "Ten Thousand";
    $("sheetTitle").textContent = `Round to the Nearest ${label}`;
  }

  function enforceWithinVsNearest(){
    const nearest = parseInt($("nearest").value, 10);
    const within = parseInt($("within").value, 10);

    const minWithin = nearest * 10; // good variety
    if(within < minWithin){
      const options = [100, 1000, 10000, 100000];
      const next = options.find(v => v >= minWithin) || 100000;
      $("within").value = String(next);
    }

    const withinNow = parseInt($("within").value, 10);
    $("hint").textContent =
      `Generating numbers from 0 to ${fmt(withinNow - 1)} and rounding to the nearest ${fmt(nearest)}.`;
  }

  function roundDownTo(n, place){ return Math.floor(n / place) * place; }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  function pickUniqueNumbers(maxExclusive, count, place){
    const seen = new Set();
    const result = [];
    let tries = 0;

    while(result.length < Math.min(count, maxExclusive) && tries < 120000){
      tries++;
      const n = Math.floor(Math.random() * maxExclusive);

      // reduce boring exact-boundary numbers (but still allow sometimes)
      if(n % place === 0 && Math.random() < 0.85) continue;

      if(seen.has(n)) continue;
      seen.add(n);
      result.push(n);
    }

    while(result.length < count){
      result.push(Math.floor(Math.random() * maxExclusive));
    }

    return shuffle(result);
  }

  function makeAnsBox(text){
    const span = document.createElement("span");
    span.className = "ansBox" + (text === null ? " empty" : "");
    span.innerHTML = text === null ? "&nbsp;" : text;
    return span;
  }

  // SVG number line: down..up, 10 equal intervals
  function numberLineSVG(n, down, up, place, opts){
    const showAll = opts.labelAll;
    const endpointsFilled = opts.endpointsFilled;
    const showDot = opts.showDot;

    // Give more height so endpoint boxes live safely ABOVE the cell border
    const W = 520;
    const H = showAll ? 125 : 110;

    const padL = 40, padR = 40;
    const lineY = 42;

    const x0 = padL;
    const x1 = W - padR;
    const stepX = (x1 - x0) / 10;   // 10 spaces
    const stepVal = place / 10;     // values step (1,10,100,1000)

    const ns = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(ns, "svg");
    svg.setAttribute("width", "100%");
    svg.setAttribute("viewBox", `0 0 ${W} ${H}`);

    // base line
    const base = document.createElementNS(ns, "line");
    base.setAttribute("x1", x0);
    base.setAttribute("y1", lineY);
    base.setAttribute("x2", x1);
    base.setAttribute("y2", lineY);
    base.setAttribute("stroke", "#111");
    base.setAttribute("stroke-width", "4");
    svg.appendChild(base);

    // ticks + labels / endpoint boxes
    for(let i=0;i<=10;i++){
      const x = x0 + stepX*i;

      const tick = document.createElementNS(ns, "line");
      tick.setAttribute("x1", x);
      tick.setAttribute("y1", lineY - 10);
      tick.setAttribute("x2", x);
      tick.setAttribute("y2", lineY + 10);
      tick.setAttribute("stroke", "#111");
      tick.setAttribute("stroke-width", (i===0 || i===10) ? "4" : "3");
      svg.appendChild(tick);

      const shouldLabel = showAll || i===0 || i===10;
      if(!shouldLabel) continue;

      const val = down + (stepVal * i);

      // Move endpoint boxes UP a bit so they never sit on the bottom edge
      const labelY = lineY + 52;
      const boxY = lineY + 36;

      if((i===0 || i===10) && !endpointsFilled){
        const boxW = 74, boxH = 28;
        const rect = document.createElementNS(ns, "rect");
        rect.setAttribute("x", x - boxW/2);
        rect.setAttribute("y", boxY);
        rect.setAttribute("width", boxW);
        rect.setAttribute("height", boxH);
        rect.setAttribute("rx", "7");
        rect.setAttribute("ry", "7");
        rect.setAttribute("fill", "#fff");
        rect.setAttribute("stroke", "#111");
        rect.setAttribute("stroke-width", "3");
        svg.appendChild(rect);
      } else {
        const t = document.createElementNS(ns, "text");
        t.setAttribute("x", x);
        t.setAttribute("y", labelY);
        t.setAttribute("text-anchor", "middle");
        t.setAttribute("font-family", "Poppins, Arial, sans-serif");
        t.setAttribute("font-weight", (i===0 || i===10) ? "800" : "700");
        t.setAttribute("font-size", (i===0 || i===10) ? "22" : "13");
        t.setAttribute("fill", "#111");
        t.textContent = fmt(val);
        svg.appendChild(t);
      }
    }

    // marker at n
    if(showDot){
      const iPos = (n - down) / stepVal;
      const markerX = x0 + stepX * iPos;
      const dot = document.createElementNS(ns, "circle");
      dot.setAttribute("cx", markerX);
      dot.setAttribute("cy", lineY);
      dot.setAttribute("r", "7");
      dot.setAttribute("fill", "#111");
      svg.appendChild(dot);
    }

    return svg;
  }

  function buildProblemCard(index, n, place, opts){
    const down = roundDownTo(n, place);
    const up = down + place;

    const card = document.createElement("div");
    card.className = "cell";

    // Prompt EXACT format requested
    const prompt = document.createElement("div");
    prompt.className = "prompt";
    prompt.textContent = `${index}. Round ${fmt(n)} to the nearest ${fmt(place)}.`;
    card.appendChild(prompt);

    // Round down/up lines on separate lines with arrows
    const lines = document.createElement("div");
    lines.className = "lines";

    const row1 = document.createElement("div");
    row1.className = "lineRow";
    row1.appendChild(document.createTextNode("Round Down "));
    const downArrow = document.createElement("span");
    downArrow.className = "arrow";
    downArrow.textContent = "↓";
    row1.appendChild(downArrow);
    row1.appendChild(
      opts.fillDownUp ? makeAnsBox(fmt(down)) : makeAnsBox(null)
    );

    const row2 = document.createElement("div");
    row2.className = "lineRow";
    row2.appendChild(document.createTextNode("Round Up "));
    const upArrow = document.createElement("span");
    upArrow.className = "arrow";
    upArrow.textContent = "↑";
    row2.appendChild(upArrow);
    row2.appendChild(
      opts.fillDownUp ? makeAnsBox(fmt(up)) : makeAnsBox(null)
    );

    lines.appendChild(row1);
    lines.appendChild(row2);
    card.appendChild(lines);

    const nl = document.createElement("div");
    nl.className = "nlWrap";
    nl.appendChild(numberLineSVG(n, down, up, place, opts));
    card.appendChild(nl);

    return card;
  }

  function build(){
    enforceWithinVsNearest();
    setTitles();

    const place = parseInt($("nearest").value, 10);
    const within = parseInt($("within").value, 10);

    const opts = {
      scaffold: $("scaffold").checked,
      labelAll: $("labelAll").checked,
      endpointsFilled: $("endpointsFilled").checked,
      fillDownUp: $("fillDownUp").checked,
      showDot: $("showDot").checked
    };

    document.body.classList.toggle("scaffold", opts.scaffold);

    const maxExclusive = Math.max(1, within);
    const nums = pickUniqueNumbers(maxExclusive, PROBLEM_COUNT, place);

    const grid = $("grid");
    grid.innerHTML = "";

    const perRow = opts.scaffold ? 1 : 2;
    const rows = Math.ceil(PROBLEM_COUNT / perRow);

    let idx = 0;
    for(let r=0;r<rows;r++){
      const row = document.createElement("div");
      row.className = "row";

      for(let c=0;c<perRow;c++){
        if(idx >= PROBLEM_COUNT) break;
        row.appendChild(buildProblemCard(idx+1, nums[idx], place, opts));
        idx++;
      }
      grid.appendChild(row);
    }
  }

  function init(){
    enforceWithinVsNearest();
    setTitles();
    build();
  }

  $("btnGen").addEventListener("click", build);
  $("btnPrint").addEventListener("click", ()=>window.print());

  ["nearest","within","scaffold","labelAll","endpointsFilled","fillDownUp","showDot"]
    .forEach(id => $(id).addEventListener("change", build));

  init();
</script>
</body>
</html>
