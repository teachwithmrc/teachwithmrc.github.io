<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rounding Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  *{ box-sizing:border-box; }
  html,body{
    margin:0;
    padding:0;
    font-family:"Poppins",Arial,sans-serif;
    color:#111;
    background:#fff;
  }
  .wrap{ max-width:1100px; margin:0 auto; padding:12px; }

  .controls{
    border:2px solid #111;
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }
  .controls-top{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    align-items:flex-end;
    gap:12px;
  }
  .field{ display:flex; flex-direction:column; gap:6px; min-width:210px; }
  .field label{ font-size:12px; font-weight:800; }
  select{
    height:42px;
    min-width:210px;
    border:2px solid #111;
    border-radius:10px;
    padding:8px 12px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:14px;
    background:#fff;
  }

  .toggleRow{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    align-items:center;
    gap:10px;
  }
  .toggle{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 12px;
    border:2px solid #111;
    border-radius:14px;
    font-weight:900;
    font-size:15px;
    user-select:none;
  }
  .toggle.disabled{ opacity:.55; pointer-events:none; }
  .toggle input[type="checkbox"]{
    appearance:none;
    width:44px;
    height:26px;
    min-width:44px;
    margin:0;
    border:2px solid #111;
    border-radius:999px;
    background:#fff;
    cursor:pointer;
    position:relative;
  }
  .toggle input[type="checkbox"]::after{
    content:"";
    position:absolute;
    top:50%;
    left:3px;
    width:18px;
    height:18px;
    border:2px solid #111;
    border-radius:999px;
    background:#fff;
    transform:translateY(-50%);
    transition:all .15s ease;
  }
  .toggle input[type="checkbox"]:checked{ background:#111; }
  .toggle input[type="checkbox"]:checked::after{ left:19px; }

  .controls-actions{
    margin-top:12px;
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:14px;
  }
  .btn{
    border:2px solid #111;
    border-radius:14px;
    height:54px;
    padding:0 30px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:18px;
    font-weight:900;
    cursor:pointer;
  }
  .btn-primary{ background:#6ec1ff; color:#fff; }
  .btn-secondary{ background:#fff; color:#111; }

  .hint, .learning-note{ text-align:center; font-size:13px; font-weight:700; margin-top:8px; }
  .learning-note{ color:#1d3a66; }

  .title{
    text-align:center;
    font-size:28px;
    font-weight:900;
    margin:6px 0 10px;
  }

  .grid{ border:2px solid #111; }
  .row{ display:grid; grid-template-columns:1fr 1fr; }
  .cell{
    border-right:2px solid #111;
    border-bottom:2px solid #111;
    padding:12px 12px 14px;
    min-height:245px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .row .cell:last-child{ border-right:none; }
  .grid .row:last-child .cell{ border-bottom:none; }

  body.scaffold .row{ grid-template-columns:1fr; }
  body.scaffold .cell{ min-height:265px; }
  body.scaffold .row .cell{ border-right:none !important; }

  .prompt{ font-size:21px; font-weight:900; line-height:1.2; }

  .rewrite{
    width:100%;
    text-align:center;
    font-size:34px;
    font-weight:900;
    letter-spacing:0.5px;
    margin:0;
  }
  .rewrite .u{
    text-decoration:underline;
    text-decoration-thickness:4px;
    text-underline-offset:4px;
  }
  .rewrite .c{ opacity:.35; }

  .downUp{
    width:100%;
    display:grid;
    grid-template-columns:1fr 1fr;
    column-gap:56px;
    row-gap:2px;
  }
  .duHead{ font-size:16px; font-weight:900; }
  .downUp{ padding:0 8px; }
  .duWrite{ margin-top:12px; min-height:1.35em; }

  .writeBlank{
    display:inline-block;
    border-bottom:3px solid #111;
    min-height:1.1em;
    vertical-align:middle;
  }
  .writeBlank--small{ width:240px; max-width:100%; }
  .writeBlank--full{ display:block; width:100%; min-width:100%; }

  .nlWrap{
    width:100%;
    display:flex;
    justify-content:center;
    min-height:118px;
    padding-bottom:2px;
  }
  .nlWrap svg{ max-width:610px; }

  .answerLine{
    width:100%;
    display:flex;
    flex-wrap:wrap;
    align-items:flex-end;
    gap:6px;
    font-size:17px;
    font-weight:800;
    line-height:1.3;
  }
  .answerLineBreak{ width:100%; flex-basis:100%; margin-top:6px; }


  @media print{
    .controls{ display:none; }
    .wrap{ max-width:none; padding:0; }
    body{ -webkit-print-color-adjust:exact; print-color-adjust:exact; zoom:.9; }
    body.scaffold{ zoom:.94; }
    .title{ font-size:22px; margin:2px 0 6px; }
    .cell{ min-height:200px; padding:8px 8px 10px; gap:6px; }
    body.scaffold .cell{ min-height:220px; }
    .prompt{ font-size:17px; }
    .rewrite{ font-size:26px; }
    .duHead{ font-size:13px; }
    .downUp{ column-gap:24px; padding:0 4px; }
    .duWrite{ margin-top:6px; }
    .nlWrap{ min-height:95px; }
    .answerLine{ font-size:14px; gap:4px; }
    .answerLineBreak{ margin-top:2px; }
    .writeBlank{ border-bottom-width:2px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="controls">
    <div class="controls-top">
      <div class="field">
        <label for="nearest">Round to the Nearest</label>
        <select id="nearest">
          <option value="10" selected>Tens</option>
          <option value="100">Hundreds</option>
          <option value="1000">Thousands</option>
          <option value="10000">Ten Thousands</option>
        </select>
      </div>
      <div class="field">
        <label for="within">Numbers Up To</label>
        <select id="within">
          <option value="100" selected>100</option>
          <option value="1000">1,000</option>
          <option value="10000">10,000</option>
          <option value="100000">100,000</option>
        </select>
      </div>
    </div>

    <div class="toggleRow">
      <label class="toggle"><input id="scaffold" type="checkbox">Scaffolded (1 per line)</label>
      <label class="toggle" id="labelAllWrap"><input id="labelAll" type="checkbox">Label All Tick Marks</label>
      <label class="toggle"><input id="endpointsFilled" type="checkbox" checked>Endpoints Filled In</label>
      <label class="toggle"><input id="fillDownUp" type="checkbox">Fill Round Down/Up</label>
      <label class="toggle"><input id="showDot" type="checkbox" checked>Show Dot on Number Line</label>
      <label class="toggle"><input id="showExplain" type="checkbox" checked>Include Explain-Your-Thinking Line</label>
    </div>

    <div class="controls-actions">
      <button type="button" id="btnGen" class="btn btn-primary">Generate</button>
      <button type="button" id="btnPrint" class="btn btn-secondary">Print</button>
    </div>

    <div class="hint" id="hint"></div>
    <div class="learning-note" id="learningNote"></div>
  </div>

  <div class="title" id="sheetTitle">Round to the Nearest Ten</div>
  <div class="grid" id="grid"></div>
</div>

<script>
  const $ = (id) => document.getElementById(id);
  const PROBLEM_COUNT = 6;

  function fmt(n){ return n.toLocaleString("en-US"); }
  function placeLabel(place){
    if(place === 10) return "Ten";
    if(place === 100) return "Hundred";
    if(place === 1000) return "Thousand";
    if(place === 10000) return "Ten Thousand";
    return String(place);
  }

  function setTitles(){
    const place = parseInt($("nearest").value, 10);
    $("sheetTitle").textContent = `Round to the Nearest ${placeLabel(place)}`;
  }

  function enforceWithinVsNearest(){
    const nearest = parseInt($("nearest").value, 10);
    const within = parseInt($("within").value, 10);

    const minWithin = nearest * 10;
    if(within < minWithin){
      const options = [100, 1000, 10000, 100000];
      const next = options.find(v => v >= minWithin) || 100000;
      $("within").value = String(next);
    }

    if(nearest >= 1000){
      $("labelAll").checked = false;
      $("labelAllWrap").classList.add("disabled");
    }else{
      $("labelAllWrap").classList.remove("disabled");
    }

    const withinNow = parseInt($("within").value, 10);
    $("hint").textContent = `Generating numbers from ${fmt(nearest)} to ${fmt(withinNow - 1)} and rounding to the nearest ${fmt(nearest)}.`;
    $("learningNote").textContent = "Tip: Have students locate the midpoint first, then decide whether the number is below or above it before they round.";
  }

  function roundDownTo(n, place){ return Math.floor(n / place) * place; }

  function makeWriteBlank(type = "small"){
    const blank = document.createElement("span");
    blank.className = `writeBlank ${type === "full" ? "writeBlank--full" : "writeBlank--small"}`;
    blank.setAttribute("aria-hidden", "true");
    return blank;
  }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  function pickUniqueNumbers(minInclusive, maxInclusive, count, place){
    const span = maxInclusive - minInclusive + 1;
    const seen = new Set();
    const result = [];
    let tries = 0;
    while(result.length < Math.min(count, span) && tries < 120000){
      tries++;
      const n = minInclusive + Math.floor(Math.random() * span);
      if(n % place === 0 && Math.random() < 0.85) continue;
      if(seen.has(n)) continue;
      seen.add(n);
      result.push(n);
    }
    while(result.length < count){
      result.push(minInclusive + Math.floor(Math.random() * span));
    }
    return shuffle(result);
  }

  function buildRewriteNumber(n, place){
    const exp = Math.round(Math.log10(place));
    const raw = String(n);
    const underlineIndex = raw.length - 1 - exp;
    const withCommas = n.toLocaleString("en-US");
    let rawPos = 0;

    const container = document.createElement("div");
    container.className = "rewrite";
    for(const ch of withCommas){
      if(ch === ","){
        const sp = document.createElement("span");
        sp.className = "c";
        sp.textContent = ",";
        container.appendChild(sp);
      }else{
        const sp = document.createElement("span");
        sp.textContent = ch;
        if(rawPos === underlineIndex) sp.className = "u";
        container.appendChild(sp);
        rawPos++;
      }
    }
    return container;
  }

  function numberLineSVG(n, down, up, place, opts){
    const bigPlace = place >= 1000;
    const labelAll = (!bigPlace && opts.labelAll);
    const endpointsAndMid = bigPlace;

    const W = 610;
    const H = labelAll ? 138 : 128;
    const padL = 44, padR = 44;
    const lineY = 40;

    const x0 = padL;
    const x1 = W - padR;
    const stepX = (x1 - x0) / 10;
    const stepVal = place / 10;

    const ns = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(ns, "svg");
    svg.setAttribute("width", "100%");
    svg.setAttribute("viewBox", `0 0 ${W} ${H}`);

    const base = document.createElementNS(ns, "line");
    base.setAttribute("x1", x0); base.setAttribute("y1", lineY);
    base.setAttribute("x2", x1); base.setAttribute("y2", lineY);
    base.setAttribute("stroke", "#111"); base.setAttribute("stroke-width", "4");
    svg.appendChild(base);

    function shouldLabel(i){
      if(labelAll) return true;
      if(endpointsAndMid) return (i===0 || i===5 || i===10);
      return (i===0 || i===10);
    }

    for(let i=0;i<=10;i++){
      const x = x0 + stepX*i;

      const tick = document.createElementNS(ns, "line");
      tick.setAttribute("x1", x); tick.setAttribute("y1", lineY - 10);
      tick.setAttribute("x2", x); tick.setAttribute("y2", lineY + 10);
      tick.setAttribute("stroke", "#111");
      tick.setAttribute("stroke-width", (i===0 || i===10) ? "4" : "3");
      svg.appendChild(tick);

      if(!shouldLabel(i)) continue;
      const val = down + (stepVal * i);
      const isEndpoint = (i===0 || i===10);

      const t = document.createElementNS(ns, "text");
      t.setAttribute("x", x); t.setAttribute("y", lineY + 52);
      t.setAttribute("text-anchor", "middle");
      t.setAttribute("font-family", "Poppins, Arial, sans-serif");
      t.setAttribute("font-weight", isEndpoint ? "800" : "700");
      t.setAttribute("font-size", isEndpoint ? "18" : (labelAll ? "12" : "14"));
      t.setAttribute("fill", "#111");
      t.textContent = (isEndpoint && !opts.endpointsFilled) ? "" : fmt(val);
      svg.appendChild(t);

      if(isEndpoint && !opts.endpointsFilled){
        const y = lineY + 84;
        const halfLen = 40;
        const blankLine = document.createElementNS(ns, "line");
        blankLine.setAttribute("x1", x - halfLen);
        blankLine.setAttribute("y1", y);
        blankLine.setAttribute("x2", x + halfLen);
        blankLine.setAttribute("y2", y);
        blankLine.setAttribute("stroke", "#111");
        blankLine.setAttribute("stroke-width", "4");
        blankLine.setAttribute("stroke-linecap", "round");
        svg.appendChild(blankLine);
      }
    }

    if(opts.showDot){
      const iPos = (n - down) / stepVal;
      const markerX = x0 + stepX * iPos;
      const dot = document.createElementNS(ns, "circle");
      dot.setAttribute("cx", markerX);
      dot.setAttribute("cy", lineY);
      dot.setAttribute("r", "7");
      dot.setAttribute("fill", "#111");
      svg.appendChild(dot);
    }

    return svg;
  }

  function buildProblemCard(index, n, place, opts){
    const down = roundDownTo(n, place);
    const up = down + place;
    const midpoint = down + (place / 2);
    const roundsUp = n >= midpoint;

    const card = document.createElement("div");
    card.className = "cell";

    const prompt = document.createElement("div");
    prompt.className = "prompt";
    prompt.textContent = `${index}. Round ${fmt(n)} to the nearest ${fmt(place)}.`;
    card.appendChild(prompt);

    card.appendChild(buildRewriteNumber(n, place));

    const downUp = document.createElement("div");
    downUp.className = "downUp";

    const dHead = document.createElement("div");
    dHead.className = "duHead";
    dHead.textContent = "Round Down ↓";
    const uHead = document.createElement("div");
    uHead.className = "duHead";
    uHead.textContent = "Round Up ↑";

    const dWrite = document.createElement("div");
    dWrite.className = "duWrite";
    if(opts.fillDownUp){
      dWrite.textContent = fmt(down);
      dWrite.style.fontWeight = "900";
      dWrite.style.fontSize = "16px";
    }else{
      dWrite.appendChild(makeWriteBlank("small"));
    }

    const uWrite = document.createElement("div");
    uWrite.className = "duWrite";
    if(opts.fillDownUp){
      uWrite.textContent = fmt(up);
      uWrite.style.fontWeight = "900";
      uWrite.style.fontSize = "16px";
    }else{
      uWrite.appendChild(makeWriteBlank("small"));
    }

    downUp.appendChild(dHead);
    downUp.appendChild(uHead);
    downUp.appendChild(dWrite);
    downUp.appendChild(uWrite);
    card.appendChild(downUp);

    const nl = document.createElement("div");
    nl.className = "nlWrap";
    nl.appendChild(numberLineSVG(n, down, up, place, opts));
    card.appendChild(nl);

    if(opts.showExplain){
      const answer = document.createElement("div");
      answer.className = "answerLine";
      if(opts.fillDownUp){
        answer.textContent = `I rounded to ${fmt(roundsUp ? up : down)} because ${fmt(n)} is closer to ${fmt(roundsUp ? up : down)}.`;
      }else{
        answer.appendChild(document.createTextNode("I rounded to "));
        answer.appendChild(makeWriteBlank("small"));
        answer.appendChild(document.createTextNode(" because"));
        const secondLine = document.createElement("span");
        secondLine.className = "answerLineBreak";
        secondLine.appendChild(makeWriteBlank("full"));
        answer.appendChild(secondLine);
      }
      card.appendChild(answer);
    }

    return card;
  }

  function build(){
    enforceWithinVsNearest();
    setTitles();

    const place = parseInt($("nearest").value, 10);
    const within = parseInt($("within").value, 10);

    const opts = {
      scaffold: $("scaffold").checked,
      labelAll: $("labelAll").checked,
      endpointsFilled: $("endpointsFilled").checked,
      fillDownUp: $("fillDownUp").checked,
      showDot: $("showDot").checked,
      showExplain: $("showExplain").checked
    };

    document.body.classList.toggle("scaffold", opts.scaffold);

    const minInclusive = Math.min(place, within - 1);
    const maxInclusive = within - 1;
    const nums = pickUniqueNumbers(minInclusive, maxInclusive, PROBLEM_COUNT, place);

    const grid = $("grid");
    grid.innerHTML = "";

    const perRow = opts.scaffold ? 1 : 2;
    const rows = Math.ceil(PROBLEM_COUNT / perRow);

    let idx = 0;
    for(let r=0;r<rows;r++){
      const row = document.createElement("div");
      row.className = "row";
      for(let c=0;c<perRow;c++){
        if(idx >= PROBLEM_COUNT) break;
        row.appendChild(buildProblemCard(idx + 1, nums[idx], place, opts));
        idx++;
      }
      grid.appendChild(row);
    }
  }

  function init(){
    enforceWithinVsNearest();
    setTitles();
    build();
  }

  $("btnGen").addEventListener("click", build);
  $("btnPrint").addEventListener("click", () => window.print());
  ["nearest","within","scaffold","labelAll","endpointsFilled","fillDownUp","showDot","showExplain"]
    .forEach(id => $(id).addEventListener("change", build));

  init();
</script>
</body>
</html>
