<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Master Word Ladders</title>

  <!-- DATA SOURCES -->
  <!-- CVC (with blends modes) -->
  <script src="blendsmaster.js" defer></script>
  <!-- Digraphs -->
  <script src="digraphs_master_FINAL_v2.js" defer></script>
  <!-- Glued Sounds -->
  <script src="glued_sounds_full.js" defer></script>
  <!-- R-Controlled -->
  <script src="rControlled_full_max.js" defer></script>
  <!-- VCe -->
  <script src="vceWordLadders_6words_full.js" defer></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    @font-face { font-family:'BoxesFont'; src:local('BoxesFont'), url('fonts/boxes2.otf') format('opentype'); }
    @font-face { font-family:'UnderlineFont'; src:local('UnderlineFont'), url('fonts/underlines.otf') format('opentype'); }

    :root{
      --cvc:#e9f2ff;          --cvc-selected:#1976d2;
      --dig:#f3e9ff;          --dig-selected:#8e24aa;
      --glued:#e8fff4;        --glued-selected:#2e7d32;
      --rctrl:#f0f5ff;        --rctrl-selected:#3f51b5;
      --vce:#fff5e6;          --vce-selected:#ef6c00;
    }

    body { font-family:'Poppins',sans-serif; margin:10px; text-align:center; background:#fafafa; }
    h1 { font-size:32px; margin-bottom:2px; }
    .subtitle { font-size:16px; margin-bottom:8px; }

    .layout { display:grid; grid-template-columns:1fr 1fr; gap:12px; max-width:1100px; margin:0 auto; }
    @media(max-width:900px){ .layout{ display:block; } }

    .section { border:2px solid #000; background:#fff; border-radius:14px; padding:14px; }

    .skill-button{
      display:block; width:100%; margin:8px 0; padding:12px;
      font-size:18px; font-weight:700; cursor:pointer; border:2px solid #000; border-radius:12px;
      transition:filter .15s ease;
    }
    .skill-button:hover{ filter:brightness(.97); }
    .skill-button.cvc   { background:var(--cvc); }
    .skill-button.dig   { background:var(--dig); }
    .skill-button.glued { background:var(--glued); }
    .skill-button.rctrl { background:var(--rctrl); }
    .skill-button.vce   { background:var(--vce); }

    .skill-button.cvc.selected   { background:var(--cvc-selected); color:#fff; }
    .skill-button.dig.selected   { background:var(--dig-selected); color:#fff; }
    .skill-button.glued.selected { background:var(--glued-selected); color:#fff; }
    .skill-button.rctrl.selected { background:var(--rctrl-selected); color:#fff; }
    .skill-button.vce.selected   { background:var(--vce-selected); color:#fff; }

    .controls { display:flex; justify-content:center; align-items:center; gap:14px; flex-wrap:wrap; margin:8px 0; }
    label { margin:0 5px; font-size:14px; }
    button { font-size:16px; padding:8px 12px; cursor:pointer; }

    #ladderOutput { margin-top:8px; margin-bottom:60px; }
    #copyright { font-size:12px; text-align:right; width:100%; }

    @media print {
      body * { visibility:hidden; }
      #ladderOutput, #ladderOutput * { visibility:visible; }
      #ladderOutput { position:absolute; top:0; left:0; width:100%; margin:0; padding:10px; box-sizing:border-box; }
      @page { margin:0.5in; }
    }
  </style>
</head>
<body>
  <h1>Master Word Ladders</h1>
  <p class="subtitle"><strong>Directions:</strong> Start at the top of the ladder and spell the correct words.</p>

  <div class="layout">
    <!-- LEFT: Skill buttons -->
    <div class="section">
      <button class="skill-button cvc"   data-skill="CVC">Short Vowels (CVC)</button>
      <button class="skill-button dig"   data-skill="Digraphs">Digraphs</button>
      <button class="skill-button glued" data-skill="Glued">Glued Sounds</button>
      <button class="skill-button rctrl" data-skill="RControlled">R-Controlled</button>
      <button class="skill-button vce"   data-skill="VCe">VCe (Silent E)</button>
    </div>

    <!-- RIGHT: Options -->
    <div class="section">
      <div style="font-weight:700; margin-bottom:4px;">Blends</div>
      <div class="controls" id="blendOptions">
        <label id="blend-no"><input type="radio" name="blendMode" value="no" checked> No Blends</label>
        <label id="blend-with"><input type="radio" name="blendMode" value="with"> With Blends</label>
        <label id="blend-only"><input type="radio" name="blendMode" value="only"> Only Blends</label>
      </div>

      <div style="font-weight:700; margin-top:6px;">Display</div>
      <div class="controls">
        <label><input type="radio" name="cellStyle" value="elkonin" checked> Elkonin Boxes</label>
        <label><input type="radio" name="cellStyle" value="underlines"> Underlines</label>
        <label><input type="checkbox" id="boldChanged" checked> Bold Changed Part</label>
      </div>

      <div class="controls">
        <button id="btnGenerate">Generate Ladder</button>
        <button onclick="window.print()">Print Page</button>
      </div>
    </div>
  </div>

  <div id="ladderOutput"></div>

  <script>
    let selectedSkill = "CVC"; // default
    document.querySelectorAll('.skill-button').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.skill-button').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedSkill = btn.dataset.skill;
        // toggle blends availability
        document.getElementById('blend-with').style.opacity = (selectedSkill==="CVC"||selectedSkill==="Digraphs")?1:0.4;
        document.getElementById('blend-with').querySelector('input').disabled = !(selectedSkill==="CVC"||selectedSkill==="Digraphs");
        document.getElementById('blend-only').style.opacity = (selectedSkill==="CVC")?1:0.4;
        document.getElementById('blend-only').querySelector('input').disabled = !(selectedSkill==="CVC");
      });
    });
    document.querySelector('.skill-button.cvc').classList.add('selected');

    function splitWordByPattern(word, pattern){
      const chunks=[]; let i=0;
      for (let d of pattern){ const len=d==='3'?3:(d==='2'?2:1); chunks.push(word.slice(i,i+len)); i+=len; }
      return chunks;
    }
    function renderPatternDigits(pattern,useFont,boldChanged,map){
      const isU=useFont==='UnderlineFont';
      return Array.from(pattern).map((d,i)=>{
        const bold = boldChanged && map && map[i];
        return `<span style="${isU?'display:inline-block;margin:0 6px;':''}${bold?'font-weight:700;':''}">${d}</span>`;
      }).join('');
    }

    function buildRow(word, prev, isFirst, isLast, useFont, boldChanged, imgSrc, patterns, type){
      const patt = patterns[word]||'?'; const prevP = patterns[prev]||'?';
      let map=null;
      if(!isFirst && boldChanged && type!=="cvc"){ // only pattern-based
        const a=splitWordByPattern(prev,prevP), b=splitWordByPattern(word,patt);
        map=b.map((c,i)=>c!==(a[i]||'')); 
      }
      const disp=isFirst
        ? `<div style="font-size:32px;font-weight:600;">${word}</div>`
        : (type==="cvc"
          ? `<div style="display:flex;justify-content:center;font-family:${useFont};font-size:90px;letter-spacing:3px;font-weight:600;">
              ${word.split('').map((ch,i)=>`<span style="font-weight:${(prev[i]!==ch&&boldChanged)?'bold':'normal'};">1</span>`).join('')}
             </div>`
          : `<div style="font-family:${useFont};font-size:${useFont==='UnderlineFont'?'85px':'100px'};">${renderPatternDigits(patt,useFont,boldChanged,map)}</div>`
        );
      const borders=!isLast?'border-bottom:4px solid #000;border-left:4px solid #000;border-right:4px solid #000;':'border-left:4px solid #000;border-right:4px solid #000;';
      const hint = (!isFirst)
        ? (()=>{ if(type==="cvc"){ for(let i=0;i<word.length;i++){ if((prev[i]||'')!==word[i]) return `${prev[i]} → ${word[i]}`;} }
                 else{ const A=splitWordByPattern(prev,prevP), B=splitWordByPattern(word,patt);
                       for(let i=0;i<Math.min(A.length,B.length);i++){ if(A[i]!==B[i]) return `${A[i]} → ${B[i]}`;} }
                 return '? → ?'; })()
        : '';
      return `<tr>
        <td style="width:140px;"><img src="${imgSrc}" style="width:110px;height:110px;object-fit:contain;"></td>
        <td style="${borders}">${disp}</td>
        <td style="width:170px;">${!isFirst?`<div style="background:#f0f0f0;border:3px solid #000;border-radius:12px;padding:6px 10px;font-size:22px;">${hint}</div>`:''}</td>
      </tr>`;
    }

    document.getElementById('btnGenerate').addEventListener('click',()=>{
      const cellStyle=document.querySelector('input[name="cellStyle"]:checked').value;
      const useFont=(cellStyle==='underlines')?'UnderlineFont':'BoxesFont';
      const bold=document.getElementById('boldChanged').checked;
      const blendSel=document.querySelector('input[name="blendMode"]:checked').value;

      let ladders=[],patterns={},images={},title="",type="pattern";

      if(selectedSkill==="CVC"){ 
        title="CVC Word Ladder"; type="cvc";
        const modeMap={no:"CVC",with:"Include Blends",only:"Only Blends"};
        ladders=getLaddersByMode(modeMap[blendSel]); patterns=rWordPatterns; images=rWordImages;
      }
      else if(selectedSkill==="Digraphs"){
        title="Digraph Word Ladder";
        const mode=(blendSel==="with")?"Include Blends":"Digraphs";
        ladders=getLaddersByMode(mode); patterns=rWordPatterns; images=rWordImages;
      }
      else if(selectedSkill==="Glued"){
        title="Glued Sounds Word Ladder"; ladders=gluedWordLadders; patterns=gluedWordPatterns; images=gluedWordImages;
      }
      else if(selectedSkill==="RControlled"){
        title="R-Controlled Word Ladder"; ladders=rControlledWordLadders||[]; patterns=rControlledPatterns||{}; images=rControlledImages||{};
      }
      else if(selectedSkill==="VCe"){
        title="VCe Word Ladder"; ladders=vceWordLadders||[]; patterns=vceWordPatterns||{}; images=vceWordImages||{};
      }

      if(!ladders||!ladders.length){ alert("No ladders found for "+selectedSkill); return; }
      const ladder=ladders[Math.floor(Math.random()*ladders.length)];
      const rows=ladder.map((w,i)=>buildRow(w,ladder[i-1]||"",i===0,i===ladder.length-1,useFont,bold,images[w]||'https://via.placeholder.com/110?text=?',patterns,type)).join('');

      document.getElementById('ladderOutput').innerHTML=`
        <div style="display:flex;flex-direction:column;align-items:center;width:98%;margin:0 auto;">
          <h2 style="font-size:24px;">${title}</h2>
          <table style="border-collapse:collapse;margin:0 auto;width:100%;max-width:600px;">${rows}</table>
          <div id="copyright">Copyright - InterventionStation.com - @TeachwithMrC</div>
        </div>`;
    });
  </script>
</body>
</html>
