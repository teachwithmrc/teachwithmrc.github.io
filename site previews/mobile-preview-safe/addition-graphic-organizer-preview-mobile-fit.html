<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Addition Graphic Organizer - Mobile Preview</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --preview-ratio: 1.4375;
    --preview-scale: 0.72;
    --ink:#111;
    --p1:#f5f5f5;
    --p2:#f7ead8;
    --p3:#e7f2fb;
    --p4:#e5f6e9;
    --p5:#fcecc8;
    --p6:#f9e3f1;
    --p7:#e1f4f6;
  }

  *{ box-sizing:border-box; }

  html,body{
    margin:0;
    padding:0;
    font-family:"Poppins",Arial,sans-serif;
    color:var(--ink);
    background:#fff;
  }

  .wrap{ max-width:460px; margin:0 auto; padding:10px; }

  .usage-steps{
    border:2px solid #111;
    border-radius:12px;
    background:#f8fbff;
    padding:10px 12px;
    margin-bottom:10px;
  }

  .usage-steps h2{
    margin:0 0 8px;
    font-size:30px;
    line-height:1.05;
    font-weight:900;
    text-align:center;
  }

  .usage-steps p{
    margin:0;
    text-align:center;
    font-size:13px;
    font-weight:700;
    line-height:1.35;
  }

  .controls{
    border:2px solid #111;
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }

  .controls-top{
    display:grid;
    grid-template-columns:1fr 1fr;
    align-items:flex-end;
    gap:12px;
  }

  .field{ display:flex; flex-direction:column; gap:8px; min-width:0; }

  .field label{ font-size:16px; font-weight:900; }

  select{
    height:56px;
    width:100%;
    border:2px solid #111;
    border-radius:10px;
    padding:8px 10px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:20px;
    font-weight:800;
    background:#fff;
  }

  .controls-mid{
    margin-top:10px;
  }

  .toggle{
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px 10px;
    border:2px solid #111;
    border-radius:12px;
    font-weight:900;
    font-size:13px;
    line-height:1.2;
    user-select:none;
    background:#fff;
  }

  .toggle input[type="checkbox"]{
    appearance:none;
    width:38px;
    height:22px;
    min-width:38px;
    margin:0;
    border:2px solid #111;
    border-radius:999px;
    background:#fff;
    cursor:pointer;
    position:relative;
  }

  .toggle input[type="checkbox"]::after{
    content:"";
    position:absolute;
    top:50%;
    left:3px;
    width:14px;
    height:14px;
    border:2px solid #111;
    border-radius:999px;
    background:#fff;
    transform:translateY(-50%);
    transition:all .15s ease;
  }

  .toggle input[type="checkbox"]:checked{ background:#111; }
  .toggle input[type="checkbox"]:checked::after{ left:17px; }

  .controls-actions{
    margin-top:12px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }

  .btn{
    border:2px solid #111;
    border-radius:14px;
    height:52px;
    padding:0 8px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:17px;
    font-weight:900;
    cursor:pointer;
  }

  .btn-primary{ background:#6ec1ff; color:#fff; }
  .btn-secondary{ background:#fff; color:#111; }

  .hint{
    margin-top:8px;
    text-align:center;
    font-size:13px;
    font-weight:700;
    line-height:1.35;
  }

  .hidden-options{ display:none; }

  .preview-shell{
    position:relative;
    margin-top:4px;
    width:100%;
    aspect-ratio:var(--preview-ratio);
    overflow:hidden;
    border:2px solid #111;
    background:#fff;
  }

  .preview-content{
    position:absolute;
    left:50%;
    top:0;
    width:calc(100% / var(--preview-scale));
    transform:translateX(-50%) scale(var(--preview-scale));
    transform-origin:top center;
    padding:10px;
    filter:none;
  }

  .sheet{
    border:2px solid #111;
    padding:10px 10px 8px;
    background:#fff;
  }

  .sheet-header{
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:8px;
    margin-bottom:8px;
  }

  .sheet-title{
    margin:0;
    font-size:24px;
    line-height:1.1;
    font-weight:900;
  }

  .name-line{
    white-space:nowrap;
    font-family:Arial,sans-serif;
    font-size:16px;
    font-weight:800;
  }

  .name-line .line{
    display:inline-block;
    width:120px;
    border-bottom:2px solid #111;
    transform:translateY(-2px);
    margin-left:4px;
  }

  .problems{
    display:grid;
    grid-template-columns:1fr 1fr;
    border:2px solid #111;
  }

  .problem-wrap{
    --cell-size:37px;
    --cell-gap:4px;
    --op-width:26px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:7px;
    padding:8px 8px 9px;
    border-right:2px solid #111;
    min-height:258px;
  }

  .problem-wrap:last-child{ border-right:none; }

  .problem-top{
    display:flex;
    align-items:center;
    justify-content:center;
    width:100%;
  }

  .problem-head{
    border:2px solid #111;
    border-radius:4px;
    background:#fff;
    padding:5px 8px;
    font-weight:800;
    font-size:0.9rem;
    line-height:1.1;
    min-height:36px;
    display:inline-flex;
    align-items:center;
    gap:5px;
    max-width:100%;
  }

  .problem-head.blank{
    border-style:dashed;
    color:#8c96a8;
    font-weight:600;
  }

  .problem-badge{
    width:20px;
    height:20px;
    border:2px solid #111;
    border-radius:50%;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:0.68rem;
    font-weight:800;
    line-height:1;
    background:#fff;
    flex:0 0 auto;
  }

  .problem-dot{
    font-size:1rem;
    font-weight:800;
    line-height:1;
    margin:0 1px 0 0;
    flex:0 0 auto;
  }

  .problem-text{
    display:inline-flex;
    align-items:center;
    line-height:1.05;
    font-size:1.1rem;
    font-weight:800;
    letter-spacing:0.2px;
  }

  .add-table{
    display:flex;
    flex-direction:column;
    gap:0;
    align-items:center;
  }

  .table-row{
    display:grid;
    gap:var(--cell-gap);
    align-items:center;
    justify-items:stretch;
    width:max-content;
  }

  .op-cell{
    width:var(--op-width);
    height:var(--cell-size);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:1.8rem;
    font-weight:700;
    line-height:1;
    color:#111;
  }

  .digit-cell{
    width:var(--cell-size);
    height:var(--cell-size);
    border:2px solid #111;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:1.48rem;
    font-weight:800;
    line-height:1;
    background:#fff;
  }

  .carry-row{ margin-bottom:6px; }

  .carry-row .op-cell{
    height:calc(var(--cell-size) * 0.68);
    font-size:1.18rem;
  }

  .carry-row .digit-cell{
    height:calc(var(--cell-size) * 0.68);
    font-size:1.08rem;
    border-color:#9ba6bb;
  }

  .line-row{
    display:grid;
    gap:var(--cell-gap);
    align-items:center;
    margin:0;
    width:max-content;
  }

  .line-spacer{ width:var(--op-width); height:0; }

  .sum-line{
    height:0;
    border-top:4px solid #000;
    align-self:center;
    margin:1px 0;
  }

  .sheet-footer{
    margin-top:8px;
    font-size:11px;
    line-height:1.35;
    font-weight:700;
    text-align:left;
  }

  .copyright{
    margin-top:8px;
    text-align:center;
    font-size:12px;
    font-weight:700;
    letter-spacing:.2px;
  }

  .preview-watermark{
    position:absolute;
    inset:0;
    z-index:118;
    pointer-events:none;
    opacity:.52;
    background-image:
      repeating-linear-gradient(
        -26deg,
        rgba(0,0,0,.08) 0 18px,
        rgba(255,255,255,.06) 18px 36px
      ),
      url("data:image/svg+xml,%3Csvg width='340' height='220' viewBox='0 0 340 220' xmlns='http://www.w3.org/2000/svg'%3E%3Cg transform='rotate(-22 170 110)'%3E%3Ctext x='18' y='90' fill='%23000' fill-opacity='.26' font-family='Poppins' font-size='34' font-weight='900'%3EPREVIEW ONLY%3C/text%3E%3Ctext x='44' y='146' fill='%23000' fill-opacity='.2' font-family='Poppins' font-size='22' font-weight='800'%3ENOT FOR CLASSROOM USE%3C/text%3E%3C/g%3E%3C/svg%3E");
    background-size:auto, 340px 220px;
    background-repeat:repeat;
  }

  .preview-paywall{
    position:absolute;
    left:0;
    right:0;
    top:auto;
    bottom:0;
    z-index:120;
    pointer-events:none;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    padding:6px;
    background:linear-gradient(to top, rgba(0,0,0,.62), rgba(0,0,0,0));
  }

  .preview-paywall-card{
    width:min(96%, 420px);
    border:1px solid #fff;
    border-radius:10px;
    background:rgba(17,17,17,.90);
    color:#fff;
    text-align:center;
    padding:7px 8px 6px;
    box-shadow:0 8px 20px rgba(0,0,0,.3);
    pointer-events:auto;
  }

  .preview-paywall-card h3{
    margin:0 0 2px;
    font-size:.72rem;
    line-height:1.2;
    font-weight:900;
    letter-spacing:.02em;
    text-transform:uppercase;
  }

  .preview-paywall-card p{
    margin:0 0 4px;
    font-size:.62rem;
    line-height:1.2;
    opacity:.95;
    font-weight:600;
  }

  .preview-paywall-card a{
    display:inline-block;
    text-decoration:none;
    background:#fff;
    color:#111;
    border-radius:7px;
    padding:4px 8px;
    font-size:.62rem;
    font-weight:900;
  }

  @media screen and (max-width:430px){
    :root{ --preview-scale:0.66; }
    .controls-top{ grid-template-columns:1fr; }
  }

  @media print{
    body{ display:none !important; }
  }
</style>
</head>
<body oncontextmenu="return false;">
<div class="wrap">
  <section class="usage-steps" aria-label="How this preview works">
    <h2>Addition Organizer Preview</h2>
    <p>Pick the two addends, then tap <strong>Generate Preview</strong> to refresh the worksheet sample.</p>
  </section>

  <div class="controls">
    <div class="controls-top">
      <div class="field">
        <label for="digitsA">Addend A Digits</label>
        <select id="digitsA">
          <option value="2" selected>2 digits</option>
          <option value="3">3 digits</option>
          <option value="4">4 digits</option>
          <option value="5">5 digits</option>
          <option value="6">6 digits</option>
        </select>
      </div>

      <div class="field">
        <label for="digitsB">Addend B Digits</label>
        <select id="digitsB">
          <option value="1" selected>1 digit</option>
          <option value="2">2 digits</option>
          <option value="3">3 digits</option>
          <option value="4">4 digits</option>
          <option value="5">5 digits</option>
          <option value="6">6 digits</option>
        </select>
      </div>
    </div>

    <div class="controls-mid">
      <label class="toggle" for="scaffoldToggle">
        <input id="scaffoldToggle" type="checkbox">
        Fill Addends in Boxes
      </label>
    </div>

    <div class="controls-actions">
      <button type="button" id="btnGen" class="btn btn-primary">Generate Preview</button>
      <button type="button" id="btnPrint" class="btn btn-secondary">Print</button>
    </div>

    <div class="hidden-options" aria-hidden="true">
      <input id="colorToggle" type="checkbox" checked>
      <input id="showProblemEq" type="checkbox" checked>
      <input id="requireRegrouping" type="checkbox">
    </div>

    <div class="hint" id="hint"></div>
  </div>

  <div class="preview-shell" aria-label="Addition Organizer Preview">
    <div class="preview-content">
      <section class="sheet" id="worksheetHost"></section>
      <div class="copyright">Copyright - InterventionStation.com - @TeachwithMrC</div>
    </div>

    <div class="preview-watermark" aria-hidden="true"></div>
    <div class="preview-paywall" aria-hidden="false">
      <div class="preview-paywall-card">
        <h3>Premium Resource</h3>
        <p>Generate is enabled in preview mode. Join membership to unlock full worksheet visibility and printing.</p>
        <a href="https://member.interventionstation.com/join" target="_blank" rel="noopener">Join Membership</a>
      </div>
    </div>
  </div>
</div>

<script>
  (function syncPreviewRatioToGif(){
    const refGif = "https://assets.cdn.filesafe.space/F9vnmU5R8sOuTGoxp5by/media/699fd28c753f15732d25dd10.gif";
    const img = new Image();
    img.onload = function(){
      if (img.naturalWidth > 0 && img.naturalHeight > 0) {
        const ratio = img.naturalWidth / img.naturalHeight;
        document.documentElement.style.setProperty("--preview-ratio", String(ratio));
      }
    };
    img.src = refGif;
  })();

  const $ = (id) => document.getElementById(id);
  const PROBLEMS_PER_PAGE = 2;

  const PLACE_COLORS = [
    "var(--p1)",
    "var(--p2)",
    "var(--p3)",
    "var(--p4)",
    "var(--p5)",
    "var(--p6)",
    "var(--p7)"
  ];

  function randInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function randomWithDigits(digits){
    const min = Math.pow(10, digits - 1);
    const max = Math.pow(10, digits) - 1;
    return randInt(min, max);
  }

  function hasRegrouping(a, b){
    const aLow = String(a).split("").reverse().map(Number);
    const bLow = String(b).split("").reverse().map(Number);
    const places = Math.max(aLow.length, bLow.length);

    for(let i = 0; i < places; i += 1){
      const ad = aLow[i] ?? 0;
      const bd = bLow[i] ?? 0;
      if(ad + bd >= 10) return true;
    }
    return false;
  }

  function randomAdditionProblem(aDigits, bDigits, requireRegrouping){
    let attempts = 0;
    while(attempts < 50000){
      attempts += 1;
      const a = randomWithDigits(aDigits);
      const b = randomWithDigits(bDigits);
      if(hasRegrouping(a, b) === requireRegrouping) return { a, b };
    }

    return { a: randomWithDigits(aDigits), b: randomWithDigits(bDigits) };
  }

  function buildProblems(aDigits, bDigits, requireRegrouping){
    const problems = [];
    const seen = new Set();

    while(problems.length < PROBLEMS_PER_PAGE){
      const next = randomAdditionProblem(aDigits, bDigits, requireRegrouping);
      const key = `${next.a}+${next.b}`;
      if(seen.has(key)) continue;
      seen.add(key);
      problems.push(next);
    }

    return problems;
  }

  function numberToDigits(num, digits){
    return String(num).padStart(digits, "0").split("");
  }

  function alignedDigitRow(totalCols, number, digits, scaffoldOn){
    const row = new Array(totalCols).fill("");
    if(!scaffoldOn) return row;

    const vals = numberToDigits(number, digits);
    const start = totalCols - digits;
    for(let i = 0; i < vals.length; i += 1){
      row[start + i] = vals[i];
    }
    return row;
  }

  function cellStyleByColumn(colIndex, totalCols, colorOn){
    if(!colorOn) return "";
    const placeFromRight = totalCols - 1 - colIndex;
    const color = PLACE_COLORS[placeFromRight % PLACE_COLORS.length];
    return `background:${color};`;
  }

  function rowCellsWithValues(totalCols, colorOn, values){
    const cells = [];
    for(let i = 0; i < totalCols; i += 1){
      const value = values && values[i] !== "" && values[i] !== undefined ? values[i] : "&nbsp;";
      cells.push(`<div class="digit-cell" style="${cellStyleByColumn(i, totalCols, colorOn)}">${value}</div>`);
    }
    return cells.join("");
  }

  function problemLetter(index){
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    return letters[index] || "A";
  }

  function problemHtml(problem, index, totalCols, showEq, colorOn, scaffoldOn, aDigits, bDigits){
    const letter = problemLetter(index);
    const headHtml = showEq
      ? `<div class="problem-head"><span class="problem-badge">${letter}</span><span class="problem-dot">.</span><span class="problem-text">${problem.a} + ${problem.b}</span></div>`
      : `<div class="problem-head blank"><span class="problem-badge">${letter}</span><span class="problem-dot">.</span><span class="problem-text">____ + ____</span></div>`;

    const rowTemplate = `grid-template-columns: var(--op-width) repeat(${totalCols}, var(--cell-size));`;
    const lineTemplate = `grid-template-columns: var(--op-width) calc(${totalCols} * var(--cell-size) + ${(totalCols - 1)} * var(--cell-gap));`;

    const carryRow = new Array(totalCols).fill("");
    const aRow = alignedDigitRow(totalCols, problem.a, aDigits, scaffoldOn);
    const bRow = alignedDigitRow(totalCols, problem.b, bDigits, scaffoldOn);
    const sRow = new Array(totalCols).fill("");

    return `
      <section class="problem-wrap">
        <div class="problem-top">${headHtml}</div>

        <div class="add-table">
          <div class="table-row carry-row" style="${rowTemplate}">
            <div class="op-cell">&nbsp;</div>
            ${rowCellsWithValues(totalCols, false, carryRow)}
          </div>

          <div class="table-row" style="${rowTemplate}">
            <div class="op-cell">&nbsp;</div>
            ${rowCellsWithValues(totalCols, colorOn, aRow)}
          </div>

          <div class="table-row" style="${rowTemplate}">
            <div class="op-cell">+</div>
            ${rowCellsWithValues(totalCols, colorOn, bRow)}
          </div>

          <div class="line-row" style="${lineTemplate}">
            <div class="line-spacer"></div>
            <div class="sum-line"></div>
          </div>

          <div class="table-row" style="${rowTemplate}">
            <div class="op-cell">&nbsp;</div>
            ${rowCellsWithValues(totalCols, colorOn, sRow)}
          </div>
        </div>
      </section>
    `;
  }

  function updateHint(){
    const aDigits = Number($("digitsA").value);
    const bDigits = Number($("digitsB").value);

    const aMin = Math.pow(10, aDigits - 1);
    const aMax = Math.pow(10, aDigits) - 1;
    const bMin = Math.pow(10, bDigits - 1);
    const bMax = Math.pow(10, bDigits) - 1;

    const fillText = $("scaffoldToggle").checked ? "Prefilled addends enabled." : "Blank addend boxes.";
    $("hint").textContent = `Generating ${aDigits}-digit + ${bDigits}-digit problems (${aMin.toLocaleString("en-US")}-${aMax.toLocaleString("en-US")} and ${bMin.toLocaleString("en-US")}-${bMax.toLocaleString("en-US")}). ${fillText}`;
  }

  function build(){
    const aDigits = Number($("digitsA").value);
    const bDigits = Number($("digitsB").value);

    const opts = {
      colorOn: $("colorToggle").checked,
      showEq: $("showProblemEq").checked,
      scaffoldOn: $("scaffoldToggle").checked,
      requireRegrouping: $("requireRegrouping").checked
    };

    const problems = buildProblems(aDigits, bDigits, opts.requireRegrouping);
    const totalCols = Math.max(aDigits, bDigits);

    const host = $("worksheetHost");
    host.innerHTML = `
      <header class="sheet-header">
        <h2 class="sheet-title">Addition Graphic Organizer</h2>
        <div class="name-line">Name:<span class="line"></span></div>
      </header>

      <div class="problems">
        ${problems.map((p, i) => problemHtml(p, i, totalCols, opts.showEq, opts.colorOn, opts.scaffoldOn, aDigits, bDigits)).join("")}
      </div>

      <div class="sheet-footer">Advanced organizer: students place digits, regroup if needed, and solve in the table boxes.</div>
    `;

    updateHint();
  }

  function lockedPreviewAction(){
    alert("This feature is locked in Preview Mode.\nPlease join membership for full worksheet access.");
  }

  function blockShortcuts(event){
    const blocked = (event.ctrlKey || event.metaKey) && ["p","s","u"].includes(event.key.toLowerCase());
    if(blocked) event.preventDefault();
  }

  document.addEventListener("keydown", blockShortcuts);

  $("btnGen").addEventListener("click", build);
  $("btnPrint").addEventListener("click", lockedPreviewAction);
  ["digitsA", "digitsB", "scaffoldToggle"].forEach(id => $(id).addEventListener("change", build));

  build();
</script>
</body>
</html>
