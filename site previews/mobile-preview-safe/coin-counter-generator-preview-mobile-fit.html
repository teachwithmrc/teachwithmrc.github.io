<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Coin Counter Generator - Mobile Preview</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --preview-ratio: 1.4375;
    --preview-scale: 0.70;
    --ink:#111;
    --line:#111;
  }

  *{ box-sizing:border-box; }
  html,body{ margin:0; padding:0; font-family:"Poppins",Arial,sans-serif; color:var(--ink); background:#fff; }
  .wrap{ max-width:460px; margin:0 auto; padding:10px; }

  .usage-steps{ border:2px solid var(--line); border-radius:12px; background:#f8fbff; padding:10px 12px; margin-bottom:10px; }
  .usage-steps h2{ margin:0 0 8px; font-size:30px; line-height:1.05; font-weight:900; text-align:center; }
  .usage-steps p{ margin:0; text-align:center; font-size:13px; font-weight:700; line-height:1.35; }

  .controls{ border:2px solid var(--line); border-radius:12px; padding:12px; margin-bottom:12px; }
  .controls-top{ display:grid; grid-template-columns:1fr; gap:12px; align-items:flex-end; }
  .field{ display:flex; flex-direction:column; gap:8px; min-width:0; }
  .field label{ font-size:16px; font-weight:900; }
  select{
    height:56px; width:100%; border:2px solid var(--line); border-radius:10px; padding:8px 10px;
    font-family:"Poppins",Arial,sans-serif; font-size:20px; font-weight:800; background:#fff;
  }

  .controls-actions{ margin-top:12px; display:grid; grid-template-columns:1fr; gap:10px; }
  .btn{
    border:2px solid var(--line); border-radius:14px; height:52px; padding:0 8px;
    font-family:"Poppins",Arial,sans-serif; font-size:17px; font-weight:900; cursor:pointer;
  }
  .btn-primary{ background:#6ec1ff; color:#fff; }
  .hint{ margin-top:8px; text-align:center; font-size:13px; font-weight:700; line-height:1.35; }

  .preview-shell{
    position:relative; width:100%; aspect-ratio:var(--preview-ratio); overflow:hidden;
    border:2px solid var(--line); background:#fff;
  }
  .preview-content{
    position:absolute; left:50%; top:0; width:calc(100% / var(--preview-scale));
    transform:translateX(-50%) scale(var(--preview-scale)); transform-origin:top center; padding:10px;
  }

  .sheet{ border:2px solid var(--line); padding:10px; background:#fff; }
  .sheet-header{
    display:flex; align-items:flex-end; justify-content:space-between; gap:8px;
    border-bottom:2px solid #bdbdbd; padding-bottom:6px; margin-bottom:8px;
  }
  .sheet-title{ margin:0; font-size:25px; line-height:1.1; font-weight:900; }
  .directions{ margin:2px 0 0; font-size:12px; line-height:1.25; font-weight:700; }
  .name-line{ white-space:nowrap; font-family:Arial,sans-serif; font-size:16px; font-weight:800; }
  .name-line .line{ display:inline-block; width:112px; border-bottom:2px solid var(--line); transform:translateY(-2px); margin-left:4px; }

  .problems{ display:grid; grid-template-columns:1fr; gap:6px; }
  .problem{
    border:2px solid #cfd6e3; border-radius:8px; padding:6px;
    display:grid; grid-template-columns:26px 1fr 120px; gap:6px; align-items:center; min-height:94px;
  }
  .pnum{ text-align:center; font-size:0.98rem; font-weight:900; }
  .coin-area{
    min-height:78px; display:flex; flex-wrap:nowrap; gap:4px; align-items:flex-end; align-content:flex-end;
    overflow:hidden; padding:0 2px;
  }
  .coin-item{
    width:var(--coin-size, 36px); display:flex; align-items:flex-end; justify-content:center;
    flex:0 0 auto; min-height:100%;
  }
  .coin-img{ width:var(--coin-size, 36px); height:var(--coin-size, 36px); object-fit:contain; display:block; }
  .answer{ text-align:right; font-size:0.86rem; font-weight:800; line-height:1.2; }
  .answer .line{ display:inline-block; width:58px; border-bottom:2px solid #222; transform:translateY(-2px); margin-left:4px; }

  .sheet-footer{ margin-top:6px; text-align:right; font-size:10px; font-weight:700; color:#666; }
  .copyright{ margin-top:8px; text-align:center; font-size:12px; font-weight:700; letter-spacing:.2px; }

  .preview-watermark{
    position:absolute; inset:0; z-index:118; pointer-events:none; opacity:.52;
    background-image:
      repeating-linear-gradient(-26deg, rgba(0,0,0,.08) 0 18px, rgba(255,255,255,.06) 18px 36px),
      url("data:image/svg+xml,%3Csvg width='340' height='220' viewBox='0 0 340 220' xmlns='http://www.w3.org/2000/svg'%3E%3Cg transform='rotate(-22 170 110)'%3E%3Ctext x='18' y='90' fill='%23000' fill-opacity='.26' font-family='Poppins' font-size='34' font-weight='900'%3EPREVIEW ONLY%3C/text%3E%3Ctext x='44' y='146' fill='%23000' fill-opacity='.2' font-family='Poppins' font-size='22' font-weight='800'%3ENOT FOR CLASSROOM USE%3C/text%3E%3C/g%3E%3C/svg%3E");
    background-size:auto, 340px 220px; background-repeat:repeat;
  }
  .preview-paywall{
    position:absolute; left:0; right:0; bottom:0; z-index:120; pointer-events:none; display:flex;
    align-items:flex-end; justify-content:center; padding:6px; background:linear-gradient(to top, rgba(0,0,0,.62), rgba(0,0,0,0));
  }
  .preview-paywall-card{
    width:min(96%, 420px); border:1px solid #fff; border-radius:10px; background:rgba(17,17,17,.90);
    color:#fff; text-align:center; padding:7px 8px 6px; box-shadow:0 8px 20px rgba(0,0,0,.3); pointer-events:auto;
  }
  .preview-paywall-card h3{ margin:0 0 2px; font-size:.72rem; line-height:1.2; font-weight:900; letter-spacing:.02em; text-transform:uppercase; }
  .preview-paywall-card p{ margin:0 0 4px; font-size:.62rem; line-height:1.2; opacity:.95; font-weight:600; }
  .preview-paywall-card a{ display:inline-block; text-decoration:none; background:#fff; color:#111; border-radius:7px; padding:4px 8px; font-size:.62rem; font-weight:900; }

  @media screen and (max-width:430px){ :root{ --preview-scale:0.655; } }
  @media print{ body{ display:none !important; } }
</style>
</head>
<body oncontextmenu="return false;">
<div class="wrap">
  <section class="usage-steps" aria-label="How this preview works">
    <h2>Coin Counter Preview</h2>
    <p>Choose whether to show dots, then tap <strong>Generate Preview</strong>.</p>
  </section>

  <div class="controls">
    <div class="controls-top">
      <div class="field">
        <label for="showDots">Show Dots on Coins</label>
        <select id="showDots">
          <option value="no" selected>No</option>
          <option value="yes">Yes</option>
        </select>
      </div>
    </div>

    <div class="controls-actions">
      <button type="button" id="btnGen" class="btn btn-primary">Generate Preview</button>
    </div>

    <div class="hint" id="hint"></div>
  </div>

  <div class="preview-shell" aria-label="Coin Counter preview worksheet">
    <div class="preview-content">
      <section class="sheet" id="worksheetHost"></section>
      <div class="copyright">Copyright - InterventionStation.com - @TeachwithMrC</div>
    </div>

    <div class="preview-watermark" aria-hidden="true"></div>
    <div class="preview-paywall" aria-hidden="false">
      <div class="preview-paywall-card">
        <h3>Premium Resource</h3>
        <p>Generate is enabled in preview mode. Join membership to unlock full worksheet visibility and printing.</p>
        <a href="https://member.interventionstation.com/join" target="_blank" rel="noopener">Join Membership</a>
      </div>
    </div>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);
  const MAX_AMOUNT = 60;
  const PROBLEM_COUNT = 6;
  const DIME_BASE_SIZE = 36;
  const COIN_RENDER_ORDER = ["quarter","dime","nickel","penny"];
  const ALLOWED_KEYS = ["quarter","dime","nickel"];

  const COINS = [
    {
      key: "quarter",
      label: "Quarter (25c)",
      value: 25,
      ratio: 1.355,
      front: {
        coin: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f715cda9ca3b4afc8.png",
        dot: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fa41b87e63abb7442.png"
      }
    },
    {
      key: "dime",
      label: "Dime (10c)",
      value: 10,
      ratio: 1,
      front: {
        coin: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f7213971802a4d866.png",
        dot: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f715cda2f49b4afc9.png"
      }
    },
    {
      key: "nickel",
      label: "Nickel (5c)",
      value: 5,
      ratio: 1.184,
      front: {
        coin: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f30ec4a3836469e61.png",
        dot: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fa41b87e109bb7445.png"
      }
    },
    {
      key: "penny",
      label: "Penny (1c)",
      value: 1,
      ratio: 1.064,
      front: {
        coin: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7f3fdd0e810fca84ef.png",
        dot: "https://storage.googleapis.com/msgsndr/F9vnmU5R8sOuTGoxp5by/media/698d1f7fa41b876939bb7443.png"
      }
    }
  ];

  function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }

  function orderCoinsForDisplay(picks){
    return COIN_RENDER_ORDER.flatMap((key) => picks.filter((coin) => coin.key === key));
  }

  function shuffleInPlace(items){
    for(let i = items.length - 1; i > 0; i -= 1){
      const j = randInt(0, i);
      [items[i], items[j]] = [items[j], items[i]];
    }
    return items;
  }

  function buildCombinationBuckets(allowed, topAmount, maxCoins){
    const buckets = new Map();
    const counts = Array(allowed.length).fill(0);

    function addCurrentCombination(total){
      const picks = [];
      for(let idx = 0; idx < allowed.length; idx += 1){
        for(let c = 0; c < counts[idx]; c += 1) picks.push(allowed[idx]);
      }
      const ordered = orderCoinsForDisplay(picks);
      if(!buckets.has(total)) buckets.set(total, []);
      buckets.get(total).push({ picks: ordered, total });
    }

    function walk(index, remainingAmount, remainingCoins, runningTotal, usedCoins){
      if(index === allowed.length){
        if(usedCoins > 0 && runningTotal > 0) addCurrentCombination(runningTotal);
        return;
      }

      const coin = allowed[index];
      const maxByAmount = Math.floor(remainingAmount / coin.value);
      const maxCount = Math.min(maxByAmount, remainingCoins);

      for(let count = 0; count <= maxCount; count += 1){
        counts[index] = count;
        walk(
          index + 1,
          remainingAmount - (count * coin.value),
          remainingCoins - count,
          runningTotal + (count * coin.value),
          usedCoins + count
        );
      }
      counts[index] = 0;
    }

    walk(0, topAmount, maxCoins, 0, 0);
    return buckets;
  }

  function getCoinSizePx(coin){
    return Math.round(DIME_BASE_SIZE * (coin.ratio || 1));
  }

  function coinHTML(coin, styleMode){
    const src = coin.front[styleMode] || coin.front.coin;
    const coinSize = getCoinSizePx(coin);
    return `
      <div class="coin-item" style="--coin-size:${coinSize}px;">
        <img class="coin-img" src="${src}" alt="${coin.label}" loading="lazy">
      </div>
    `;
  }

  function renderWorksheet(){
    const styleMode = $("showDots").value === "yes" ? "dot" : "coin";
    const allowed = COINS.filter((coin) => ALLOWED_KEYS.includes(coin.key));

    const smallest = allowed.reduce((min, c) => Math.min(min, c.value), Number.POSITIVE_INFINITY);
    const maxCoins = Math.max(1, Math.min(15, Math.floor(MAX_AMOUNT / smallest)));
    const buckets = buildCombinationBuckets(allowed, MAX_AMOUNT, maxCoins);
    const allTotals = [...buckets.keys()];

    if(!allTotals.length){
      $("worksheetHost").innerHTML = "<div style='text-align:center;font-weight:800;'>No coin combinations available.</div>";
      $("hint").textContent = "No problems could be generated for the current settings.";
      return;
    }

    const totalsPool = shuffleInPlace([...allTotals]);
    const rows = [];

    for(let i = 1; i <= PROBLEM_COUNT; i += 1){
      if(!totalsPool.length) totalsPool.push(...shuffleInPlace([...allTotals]));
      const total = totalsPool.pop();
      const combosForTotal = buckets.get(total) || [];
      const problem = combosForTotal[randInt(0, combosForTotal.length - 1)];
      const orderedPicks = orderCoinsForDisplay(problem.picks);

      rows.push(`
        <article class="problem">
          <div class="pnum">${i}.</div>
          <div class="coin-area">${orderedPicks.map((coin) => coinHTML(coin, styleMode)).join("")}</div>
          <div class="answer">Total: <span class="line"></span> c</div>
        </article>
      `);
    }

    $("worksheetHost").innerHTML = `
      <header class="sheet-header">
        <div>
          <h2 class="sheet-title">Counting Coins</h2>
          <p class="directions"><strong>Directions:</strong> Count the coins and write the total in cents.</p>
        </div>
        <div class="name-line">Name:<span class="line"></span></div>
      </header>
      <div class="problems">${rows.join("")}</div>
      <div class="sheet-footer">Preview setup: quarters, dimes, and nickels up to 60 cents.</div>
    `;

    $("hint").textContent = styleMode === "dot" ? "Dots are ON for this preview." : "Dots are OFF for this preview.";
  }

  function blockShortcuts(event){
    const blocked = (event.ctrlKey || event.metaKey) && ["p","s","u"].includes(event.key.toLowerCase());
    if(blocked) event.preventDefault();
  }

  document.addEventListener("keydown", blockShortcuts);
  $("btnGen").addEventListener("click", renderWorksheet);

  renderWorksheet();
</script>
</body>
</html>
