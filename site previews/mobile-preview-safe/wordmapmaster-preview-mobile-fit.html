<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Word Mapping Generator - Mobile Preview</title>
<script src="../../newtry_FULL.js" defer></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{ --preview-ratio:1.4375; --preview-scale:0.70; }
  @font-face {
    font-family:'BoxesFont';
    src:url('../../fonts/boxes2.otf') format('opentype');
    font-display:swap;
  }
  @font-face {
    font-family:'BoxesFontFallback';
    src:url('../../fonts/boxes.ttf') format('truetype');
    font-display:swap;
  }
  *{ box-sizing:border-box; }
  html,body{ margin:0; padding:0; font-family:"Poppins",Arial,sans-serif; color:#111; background:#fff; }
  .wrap{ max-width:460px; margin:0 auto; padding:10px; }

  .usage-steps{ border:2px solid #111; border-radius:12px; background:#f8fbff; padding:10px 12px; margin-bottom:10px; }
  .usage-steps h2{ margin:0 0 8px; font-size:30px; line-height:1.05; font-weight:900; text-align:center; }
  .usage-steps p{ margin:0; text-align:center; font-size:13px; font-weight:700; line-height:1.35; }

  .controls{ border:2px solid #111; border-radius:12px; padding:12px; margin-bottom:12px; }
  .controls-actions{ margin-top:4px; display:grid; grid-template-columns:1fr; gap:10px; }
  .btn{ border:2px solid #111; border-radius:14px; height:52px; padding:0 8px; font-family:"Poppins",Arial,sans-serif; font-size:17px; font-weight:900; cursor:pointer; }
  .btn-primary{ background:#6ec1ff; color:#fff; }

  .skills-note{ margin-top:8px; text-align:center; font-size:13px; font-weight:800; color:#1d3a66; }
  details.skills-dropdown{ margin-top:8px; border:2px solid #111; border-radius:10px; padding:8px; background:#fff; }
  details.skills-dropdown > summary{ cursor:pointer; font-size:13px; font-weight:900; list-style:none; text-align:center; }
  details.skills-dropdown > summary::-webkit-details-marker{ display:none; }
  .skill-preview{ width:100%; border-collapse:collapse; margin-top:8px; }
  .skill-preview td{ width:20%; border:2px solid #111; text-align:center; vertical-align:middle; font-size:11px; font-weight:700; padding:7px 4px; background:#f8fbff; user-select:none; pointer-events:none; }

  .hint{ margin-top:8px; text-align:center; font-size:13px; font-weight:700; line-height:1.35; }

  .preview-shell{ position:relative; margin-top:4px; width:100%; aspect-ratio:var(--preview-ratio); overflow:hidden; border:2px solid #111; background:#fff; }
  .preview-content{ position:absolute; left:50%; top:0; width:calc(100% / var(--preview-scale)); transform:translateX(-50%) scale(var(--preview-scale)); transform-origin:top center; padding:10px; }

  .sheet{ border:2px solid #111; padding:10px; background:#fff; }
  .name-line{ font-family:Arial,sans-serif; font-size:18px; font-weight:800; margin:0 0 8px; }
  .title{ text-align:center; font-size:25px; font-weight:900; line-height:1.1; margin:4px 0 5px; }
  .directions{ text-align:center; font-size:13px; font-weight:700; line-height:1.3; margin-bottom:8px; }

  .word-table{ width:100%; border-collapse:collapse; border:2px solid #111; }
  .word-table td{ width:50%; border:2px solid #111; padding:8px 6px; vertical-align:middle; text-align:center; min-height:114px; }
  .word{ font-size:23px; font-weight:900; line-height:1.1; margin-bottom:8px; }
  .pattern{
    font-size:56px;
    transform:scale(1.3);
    display:inline-block;
    font-family:'BoxesFont', 'BoxesFontFallback', 'Courier New', monospace;
    font-weight:normal;
    line-height:1;
    margin-top:8px;
    margin-bottom:10px;
  }

  .copyright{ margin-top:8px; text-align:center; font-size:12px; font-weight:700; letter-spacing:.2px; }

  .preview-watermark{ position:absolute; inset:0; z-index:118; pointer-events:none; opacity:.52; background-image:repeating-linear-gradient(-26deg, rgba(0,0,0,.08) 0 18px, rgba(255,255,255,.06) 18px 36px), url("data:image/svg+xml,%3Csvg width='340' height='220' viewBox='0 0 340 220' xmlns='http://www.w3.org/2000/svg'%3E%3Cg transform='rotate(-22 170 110)'%3E%3Ctext x='18' y='90' fill='%23000' fill-opacity='.26' font-family='Poppins' font-size='34' font-weight='900'%3EPREVIEW ONLY%3C/text%3E%3Ctext x='44' y='146' fill='%23000' fill-opacity='.2' font-family='Poppins' font-size='22' font-weight='800'%3ENOT FOR CLASSROOM USE%3C/text%3E%3C/g%3E%3C/svg%3E"); background-size:auto, 340px 220px; background-repeat:repeat; }
  .preview-paywall{ position:absolute; left:0; right:0; bottom:0; z-index:120; pointer-events:none; display:flex; align-items:flex-end; justify-content:center; padding:6px; background:linear-gradient(to top, rgba(0,0,0,.62), rgba(0,0,0,0)); }
  .preview-paywall-card{ width:min(96%, 420px); border:1px solid #fff; border-radius:10px; background:rgba(17,17,17,.90); color:#fff; text-align:center; padding:7px 8px 6px; box-shadow:0 8px 20px rgba(0,0,0,.3); pointer-events:auto; }
  .preview-paywall-card h3{ margin:0 0 2px; font-size:.72rem; line-height:1.2; font-weight:900; letter-spacing:.02em; text-transform:uppercase; }
  .preview-paywall-card p{ margin:0 0 4px; font-size:.62rem; line-height:1.2; opacity:.95; font-weight:600; }
  .preview-paywall-card a{ display:inline-block; text-decoration:none; background:#fff; color:#111; border-radius:7px; padding:4px 8px; font-size:.62rem; font-weight:900; }

  @media screen and (max-width:430px){ :root{ --preview-scale:0.64; } }
  @media print{ body{ display:none !important; } }
</style>
</head>
<body oncontextmenu="return false;">
<div class="wrap">
  <section class="usage-steps" aria-label="How this preview works">
    <h2>Word Mapping Preview</h2>
    <p>Tap <strong>Generate Preview</strong> to refresh a digraph worksheet mix (with or without blends).</p>
  </section>

  <div class="controls">
    <div class="controls-actions">
      <button type="button" id="btnGen" class="btn btn-primary">Generate Preview</button>
    </div>

    <div class="skills-note">Over 40 phonics skills are available in the full generator.</div>

    <details class="skills-dropdown">
      <summary>See More Phonics Skills</summary>
      <table class="skill-preview" aria-hidden="true">
        <tr>
          <td>Short Vowels</td>
          <td>Digraphs</td>
          <td>Glued Sounds</td>
          <td>VCe</td>
          <td>R-Controlled</td>
        </tr>
        <tr>
          <td>Vowel Teams</td>
          <td>Diphthongs</td>
          <td>Variant Vowels</td>
          <td>Soft Endings</td>
          <td>Mixed Review</td>
        </tr>
      </table>
    </details>

    <div class="hint" id="hint"></div>
  </div>

  <div class="preview-shell" aria-label="Word Mapping Preview">
    <div class="preview-content">
      <section class="sheet" id="output"></section>
      <div class="copyright">Copyright - InterventionStation.com - @TeachwithMrC</div>
    </div>

    <div class="preview-watermark" aria-hidden="true"></div>
    <div class="preview-paywall" aria-hidden="false">
      <div class="preview-paywall-card">
        <h3>Premium Resource</h3>
        <p>Generate is enabled in preview mode. Join membership to unlock full worksheet visibility and printing.</p>
        <a href="https://member.interventionstation.com/join" target="_blank" rel="noopener">Join Membership</a>
      </div>
    </div>
  </div>
</div>

<script>
  (function syncPreviewRatioToGif(){
    const refGif = "https://assets.cdn.filesafe.space/F9vnmU5R8sOuTGoxp5by/media/699fd28c753f15732d25dd10.gif";
    const img = new Image();
    img.onload = function(){
      if (img.naturalWidth > 0 && img.naturalHeight > 0) {
        const ratio = img.naturalWidth / img.naturalHeight;
        document.documentElement.style.setProperty("--preview-ratio", String(ratio));
      }
    };
    img.src = refGif;
  })();

  const $ = (id) => document.getElementById(id);

  function shuffle(arr){
    const copy = [...arr];
    for(let i = copy.length - 1; i > 0; i -= 1){
      const j = Math.floor(Math.random() * (i + 1));
      [copy[i], copy[j]] = [copy[j], copy[i]];
    }
    return copy;
  }

  function dedupe(list){
    const seen = new Set();
    const out = [];
    for(const w of list){
      const key = (w && w.word && w.pattern) ? `${w.word}|${w.pattern}` : JSON.stringify(w);
      if(!seen.has(key)){ seen.add(key); out.push(w); }
    }
    return out;
  }

  function getDigraphPool(source){
    const bases = ["Digraph(ck)","Digraph(sh)","Digraph(th)","Digraph(ch)","Digraph(wh)"];
    const suffixes = ["", " with Blends", " with Digraphs and Blends"];
    let words = [];
    for(const base of bases){
      for(const suffix of suffixes){
        const key = `${base}${suffix}`;
        if(Array.isArray(source[key])) words = words.concat(source[key]);
      }
    }
    return dedupe(words);
  }

  function renderPattern(pattern){
    return String(pattern || "").trim() || "&nbsp;";
  }

  function updateHint(){
    $("hint").textContent = "Generating a mixed digraph set (with and without blends).";
  }

  function build(){
    if(typeof soundBoxWords === "undefined"){
      $("output").innerHTML = '<div style="font-size:14px;font-weight:700;text-align:center;">Word data is unavailable. Please check <code>newtry_FULL.js</code>.</div>';
      $("hint").textContent = "Could not load phonics word data.";
      return;
    }

    let words = getDigraphPool(soundBoxWords);
    if(!Array.isArray(words) || !words.length){
      $("output").innerHTML = '<div style="font-size:14px;font-weight:700;text-align:center;">No words found for this setting.</div>';
      $("hint").textContent = "No words available for the selected option.";
      return;
    }

    words = shuffle(words);
    while(words.length < 8) words = words.concat(words);
    const picked = words.slice(0, 8);

    const rows = [];
    for(let r = 0; r < 4; r += 1){
      const left = picked[r * 2];
      const right = picked[(r * 2) + 1];
      rows.push(`
        <tr>
          <td>
            <div class="word">${left.word}</div>
            <div class="pattern">${renderPattern(left.pattern)}</div>
          </td>
          <td>
            <div class="word">${right.word}</div>
            <div class="pattern">${renderPattern(right.pattern)}</div>
          </td>
        </tr>
      `);
    }

    const title = "Digraph Word Mapping";

    $("output").innerHTML = `
      <div class="name-line">Name: ______________________</div>
      <div class="title">${title}</div>
      <div class="directions">Read each word, map the sounds in the boxes, then read the word again.</div>
      <table class="word-table">${rows.join("")}</table>
    `;

    updateHint();
  }

  function blockShortcuts(event){ const blocked = (event.ctrlKey || event.metaKey) && ["p","s","u"].includes(event.key.toLowerCase()); if(blocked) event.preventDefault(); }

  document.addEventListener("keydown", blockShortcuts);

  function wire(){
    $("btnGen").addEventListener("click", build);
    build();
  }

  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", wire);
  else wire();
</script>
</body>
</html>
