<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Addition Generator - Mobile Preview</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --preview-ratio: 1.4375;
    --preview-scale: 0.72;
  }
  *{ box-sizing:border-box; }
  html,body{
    margin:0;
    padding:0;
    font-family:"Poppins",Arial,sans-serif;
    color:#111;
    background:#fff;
  }
  .wrap{ max-width:460px; margin:0 auto; padding:10px; }

  .usage-steps{
    border:2px solid #111;
    border-radius:12px;
    background:#f8fbff;
    padding:10px 12px;
    margin-bottom:10px;
  }
  .usage-steps h2{
    margin:0 0 8px;
    font-size:30px;
    line-height:1.05;
    font-weight:900;
    text-align:center;
  }
  .usage-steps p{
    margin:0;
    text-align:center;
    font-size:13px;
    font-weight:700;
    line-height:1.35;
  }

  .controls{
    border:2px solid #111;
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }
  .controls-top{
    display:grid;
    grid-template-columns:1fr 1fr;
    align-items:flex-end;
    gap:12px;
  }
  .field{ display:flex; flex-direction:column; gap:8px; min-width:0; }
  .field label{ font-size:16px; font-weight:900; }
  select{
    height:56px;
    width:100%;
    border:2px solid #111;
    border-radius:10px;
    padding:8px 10px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:20px;
    font-weight:800;
    background:#fff;
  }

  .controls-actions{
    margin-top:12px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }
  .btn{
    border:2px solid #111;
    border-radius:14px;
    height:52px;
    padding:0 8px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:17px;
    font-weight:900;
    cursor:pointer;
  }
  .btn-primary{ background:#6ec1ff; color:#fff; }
  .btn-secondary{ background:#fff; color:#111; }

  .hidden-options{ display:none; }

  .hint{
    margin-top:8px;
    text-align:center;
    font-size:13px;
    font-weight:700;
    color:#1d3a66;
  }

  .nameLine{
    font-family:Arial,sans-serif;
    font-size:20px;
    font-weight:800;
    margin:4px 0 8px;
  }

  .title{
    text-align:center;
    font-size:28px;
    font-weight:900;
    margin:6px 0 10px;
  }

  .grid{ border:2px solid #111; }
  .row{ display:grid; grid-template-columns:1fr 1fr; }
  .cell{
    border-right:2px solid #111;
    border-bottom:2px solid #111;
    padding:12px 12px 14px;
    min-height:245px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .row .cell:last-child{ border-right:none; }
  .grid .row:last-child .cell{ border-bottom:none; }

  .prompt{ font-size:20px; font-weight:900; line-height:1.2; }

  .problemCard{
    margin-top:4px;
    border:2px solid #111;
    padding:10px;
    min-height:150px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .vertical{
    font-family:"Poppins",Arial,sans-serif;
    font-size:38px;
    line-height:1.1;
    font-weight:900;
    text-align:right;
    min-width:150px;
  }
  .vertical .line{
    border-top:4px solid #111;
    margin-top:6px;
    padding-top:8px;
  }
  .plus{ margin-right:8px; }

  .answerBlank{
    display:block;
    min-height:1.2em;
    border-bottom:4px solid #111;
  }

  .copyright{
    margin-top:10px;
    text-align:center;
    font-size:13px;
    font-weight:700;
    letter-spacing:.2px;
  }

  .preview-shell{
    position:relative;
    margin-top:4px;
    width:100%;
    aspect-ratio:var(--preview-ratio);
    overflow:hidden;
    border:2px solid #111;
    background:#fff;
  }

  .preview-content{
    position:absolute;
    left:50%;
    top:0;
    width:calc(100% / var(--preview-scale));
    transform:translateX(-50%) scale(var(--preview-scale));
    transform-origin:top center;
    padding:10px;
  }

  .preview-watermark{
    position:absolute;
    inset:0;
    z-index:118;
    pointer-events:none;
    opacity:.52;
    background-image:
      repeating-linear-gradient(
        -26deg,
        rgba(0,0,0,.08) 0 18px,
        rgba(255,255,255,.06) 18px 36px
      ),
      url("data:image/svg+xml,%3Csvg width='340' height='220' viewBox='0 0 340 220' xmlns='http://www.w3.org/2000/svg'%3E%3Cg transform='rotate(-22 170 110)'%3E%3Ctext x='18' y='90' fill='%23000' fill-opacity='.26' font-family='Poppins' font-size='34' font-weight='900'%3EPREVIEW ONLY%3C/text%3E%3Ctext x='44' y='146' fill='%23000' fill-opacity='.2' font-family='Poppins' font-size='22' font-weight='800'%3ENOT FOR CLASSROOM USE%3C/text%3E%3C/g%3E%3C/svg%3E");
    background-size:auto, 340px 220px;
    background-repeat:repeat;
  }

  .preview-paywall{
    position:absolute;
    left:0;
    right:0;
    bottom:0;
    z-index:120;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    padding:6px;
    pointer-events:none;
    background:linear-gradient(to top, rgba(0,0,0,.62), rgba(0,0,0,0));
  }

  .preview-paywall-card{
    width:min(96%, 420px);
    border:1px solid #fff;
    border-radius:10px;
    background:rgba(17,17,17,.90);
    color:#fff;
    text-align:center;
    padding:7px 8px 6px;
    box-shadow:0 8px 20px rgba(0,0,0,.3);
    pointer-events:auto;
  }

  .preview-paywall-card h3{
    margin:0 0 2px;
    font-size:.72rem;
    line-height:1.2;
    font-weight:900;
    letter-spacing:.02em;
    text-transform:uppercase;
  }

  .preview-paywall-card p{
    margin:0 0 4px;
    font-size:.62rem;
    line-height:1.2;
    opacity:.95;
    font-weight:600;
  }

  .preview-paywall-card a{
    display:inline-block;
    text-decoration:none;
    background:#fff;
    color:#111;
    border-radius:7px;
    padding:4px 8px;
    font-size:.62rem;
    font-weight:900;
  }

  @media screen and (max-width:430px){
    :root{ --preview-scale: 0.66; }
    .controls-top{ grid-template-columns:1fr; }
    .vertical{ font-size:34px; min-width:130px; }
  }

  @media print{
    body{ display:none !important; }
  }
</style>
</head>
<body oncontextmenu="return false;">
<div class="wrap">
  <section class="usage-steps" aria-label="How this preview works">
    <h2>Addition Generator Preview</h2>
    <p>Tap <strong>Generate Preview</strong> to refresh the worksheet sample.</p>
  </section>

  <div class="controls">
    <div class="controls-top">
      <div class="field">
        <label for="digits">Addend Digits</label>
        <select id="digits">
          <option value="2" selected>2 Digits</option>
          <option value="3">3 Digits</option>
          <option value="4">4 Digits</option>
        </select>
      </div>
      <div class="field">
        <label for="mode">Problem Mode</label>
        <select id="mode">
          <option value="mixed" selected>Mixed</option>
          <option value="regroup">Regrouping</option>
          <option value="no-regroup">No Regrouping</option>
        </select>
      </div>
    </div>

    <div class="controls-actions">
      <button type="button" id="btnGen" class="btn btn-primary">Generate Preview</button>
      <button type="button" id="btnPrint" class="btn btn-secondary">Print</button>
    </div>

    <div class="hidden-options" aria-hidden="true">
      <input id="showAnswers" type="checkbox">
    </div>

    <div class="hint" id="hint"></div>
  </div>

  <div class="preview-shell" aria-label="Addition Generator Preview">
    <div class="preview-content">
      <div class="nameLine">Name: ______________________</div>
      <div class="title" id="sheetTitle">Addition Practice</div>
      <div class="grid" id="grid"></div>
      <div class="copyright">Copyright - InterventionStation.com - @TeachwithMrC</div>
    </div>

    <div class="preview-watermark" aria-hidden="true"></div>
    <div class="preview-paywall" aria-hidden="false">
      <div class="preview-paywall-card">
        <h3>Premium Resource</h3>
        <p>Generate is enabled in preview mode. Join membership to unlock full worksheet visibility and printing.</p>
        <a href="https://member.interventionstation.com/join" target="_blank" rel="noopener">Join Membership</a>
      </div>
    </div>
  </div>
</div>

<script>
  (function syncPreviewRatioToGif(){
    const refGif = "https://assets.cdn.filesafe.space/F9vnmU5R8sOuTGoxp5by/media/699fd28c753f15732d25dd10.gif";
    const img = new Image();
    img.onload = function(){
      if (img.naturalWidth > 0 && img.naturalHeight > 0) {
        const ratio = img.naturalWidth / img.naturalHeight;
        document.documentElement.style.setProperty("--preview-ratio", String(ratio));
      }
    };
    img.src = refGif;
  })();

  const $ = (id) => document.getElementById(id);
  const PROBLEM_COUNT = 2;

  function setTitle(){
    const digits = parseInt($("digits").value, 10);
    $("sheetTitle").textContent = `${digits}-Digit Addition Practice`;
  }

  function randomInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function maxForDigits(d){
    if(d <= 1) return 9;
    return Math.pow(10, d) - 1;
  }

  function minForDigits(d){
    if(d <= 1) return 0;
    return Math.pow(10, d - 1);
  }

  function hasRegroup(a, b){
    let x = a;
    let y = b;
    while(x > 0 || y > 0){
      if((x % 10) + (y % 10) >= 10) return true;
      x = Math.floor(x / 10);
      y = Math.floor(y / 10);
    }
    return false;
  }

  function pickProblem(digits, mode){
    const min = minForDigits(digits);
    const max = maxForDigits(digits);

    for(let i = 0; i < 800; i++){
      const a = randomInt(min, max);
      const b = randomInt(min, max);
      const regroup = hasRegroup(a, b);
      if(mode === "regroup" && !regroup) continue;
      if(mode === "no-regroup" && regroup) continue;
      return { a, b };
    }

    return { a: randomInt(min, max), b: randomInt(min, max) };
  }

  function fmt(n){
    return n.toLocaleString("en-US");
  }

  function makeVerticalProblem(index, a, b){
    const card = document.createElement("div");
    card.className = "cell";

    const prompt = document.createElement("div");
    prompt.className = "prompt";
    prompt.textContent = `${index}. Solve.`;

    const box = document.createElement("div");
    box.className = "problemCard";

    const vertical = document.createElement("div");
    vertical.className = "vertical";
    vertical.innerHTML = `
      <div>${fmt(a)}</div>
      <div><span class="plus">+</span>${fmt(b)}</div>
      <div class="line"><span class="answerBlank" aria-hidden="true"></span></div>
    `;

    box.appendChild(vertical);
    card.appendChild(prompt);
    card.appendChild(box);
    return card;
  }

  function build(){
    const digits = parseInt($("digits").value, 10);
    const mode = $("mode").value;

    setTitle();
    $("hint").textContent = `Generating ${digits}-digit addition problems (${mode.replace("-", " ")}).`;

    const grid = $("grid");
    grid.innerHTML = "";

    const row = document.createElement("div");
    row.className = "row";

    for(let i = 0; i < PROBLEM_COUNT; i++){
      const p = pickProblem(digits, mode);
      row.appendChild(makeVerticalProblem(i + 1, p.a, p.b));
    }

    grid.appendChild(row);
  }

  function lockedPreviewAction(){
    alert("This feature is locked in Preview Mode.\nPlease join membership for full worksheet access.");
  }

  function blockShortcuts(event){
    const blocked = (event.ctrlKey || event.metaKey) && ["p","s","u"].includes(event.key.toLowerCase());
    if(blocked) event.preventDefault();
  }

  document.addEventListener("keydown", blockShortcuts);

  $("btnGen").addEventListener("click", build);
  $("btnPrint").addEventListener("click", lockedPreviewAction);
  ["digits", "mode"].forEach(id => $(id).addEventListener("change", build));

  setTitle();
  build();
</script>
</body>
</html>
