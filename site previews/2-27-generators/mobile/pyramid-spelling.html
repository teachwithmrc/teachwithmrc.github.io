<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pyramid Spelling - Mobile Preview</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --preview-ratio: 1.4375;
    --crop-top: 300px;
  }
  *{ box-sizing:border-box; }
  html,body{
    margin:0;
    padding:0;
    font-family:"Poppins",Arial,sans-serif;
    color:#111;
    background:#fff;
  }
  .wrap{ max-width:460px; margin:0 auto; padding:10px; }

  .usage-steps{
    border:2px solid #111;
    border-radius:12px;
    background:#f8fbff;
    padding:10px 12px;
    margin-bottom:10px;
  }
  .usage-steps h2{
    margin:0 0 8px;
    font-size:clamp(22px,7vw,30px);
    line-height:1.05;
    font-weight:900;
    text-align:center;
  }
  .usage-steps p{
    margin:0;
    text-align:center;
    font-size:13px;
    font-weight:700;
    line-height:1.35;
  }

  .controls{
    border:2px solid #111;
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }
  .controls-top{
    display:grid;
    grid-template-columns:1fr 1fr;
    align-items:flex-end;
    gap:12px;
  }
  .field{ display:flex; flex-direction:column; gap:8px; min-width:0; }
  .field label{ font-size:16px; font-weight:900; }
  select{
    height:56px;
    width:100%;
    border:2px solid #111;
    border-radius:10px;
    padding:8px 10px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:18px;
    font-weight:800;
    background:#fff;
  }

  .controls-actions{
    margin-top:12px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }
  .btn{
    border:2px solid #111;
    border-radius:14px;
    height:52px;
    padding:0 8px;
    font-family:"Poppins",Arial,sans-serif;
    font-size:17px;
    font-weight:900;
    cursor:pointer;
  }
  .btn-primary{ background:#6ec1ff; color:#fff; }
  .btn-secondary{ background:#fff; color:#111; }

  .status{
    margin:10px 0 0;
    text-align:center;
    font-size:12px;
    font-weight:700;
    color:#444;
    min-height:1.2em;
  }

  .preview-shell{
    position:relative;
    margin-top:4px;
    width:100%;
    aspect-ratio:var(--preview-ratio);
    overflow:hidden;
    border:2px solid #111;
    background:#fff;
  }

  .preview-frame{
    position:absolute;
    inset:0;
    width:100%;
    height:calc(100% + var(--crop-top));
    transform:translateY(calc(-1 * var(--crop-top)));
    border:0;
    background:#fff;
  }

  .preview-watermark{
    position:absolute;
    inset:0;
    z-index:118;
    pointer-events:none;
    opacity:.52;
    background-image:
      repeating-linear-gradient(
        -26deg,
        rgba(0,0,0,.08) 0 18px,
        rgba(255,255,255,.06) 18px 36px
      ),
      url("data:image/svg+xml,%3Csvg width='340' height='220' viewBox='0 0 340 220' xmlns='http://www.w3.org/2000/svg'%3E%3Cg transform='rotate(-22 170 110)'%3E%3Ctext x='18' y='90' fill='%23000' fill-opacity='.26' font-family='Poppins' font-size='34' font-weight='900'%3EPREVIEW ONLY%3C/text%3E%3Ctext x='44' y='146' fill='%23000' fill-opacity='.2' font-family='Poppins' font-size='22' font-weight='800'%3ENOT FOR CLASSROOM USE%3C/text%3E%3C/g%3E%3C/svg%3E");
    background-size:auto, 340px 220px;
    background-repeat:repeat;
  }

  @media (max-width:430px){
    .controls-top{ grid-template-columns:1fr; }
    :root{ --crop-top: 255px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <section class="usage-steps" aria-label="How this preview works">
    <h2>Pyramid Spelling Preview</h2>
    <p>Tap <strong>Generate Preview</strong> to refresh the worksheet sample.</p>
  </section>

  <div class="controls">
    <div class="controls-top">
      <div class="field">
        <label for="difficulty">Difficulty</label>
        <select id="difficulty">
          <option>Standard</option>
          <option>Mixed</option>
          <option>Challenge</option>
        </select>
      </div>
      <div class="field">
        <label for="problems">Problems</label>
        <select id="problems">
          <option>4 Problems</option>
          <option>6 Problems</option>
          <option>8 Problems</option>
        </select>
      </div>
    </div>

    <div class="controls-actions">
      <button type="button" id="btnGen" class="btn btn-primary">Generate Preview</button>
      <button type="button" id="btnPrint" class="btn btn-secondary">Print</button>
    </div>
    <p id="status" class="status">Ready.</p>
  </div>

  <div class="preview-shell" aria-label="Pyramid Spelling Preview">
    <iframe id="previewFrame" class="preview-frame" title="Pyramid Spelling generated preview"></iframe>
    <div class="preview-watermark" aria-hidden="true"></div>
  </div>
</div>

<script>
  (function(){
    const SOURCE = "../../pyramid-spelling-generator-preview.html";
    const REF_GIF = "https://assets.cdn.filesafe.space/F9vnmU5R8sOuTGoxp5by/media/699fd28c753f15732d25dd10.gif";

    const frame = document.getElementById("previewFrame");
    const status = document.getElementById("status");
    const btnGen = document.getElementById("btnGen");
    const btnPrint = document.getElementById("btnPrint");

    function syncPreviewRatio(){
      const img = new Image();
      img.onload = function(){
        if(img.naturalWidth > 0 && img.naturalHeight > 0){
          const ratio = img.naturalWidth / img.naturalHeight;
          document.documentElement.style.setProperty("--preview-ratio", String(ratio));
        }
      };
      img.src = REF_GIF;
    }

    function clickGenerateInDoc(doc){
      if(!doc) return false;
      const nodes = doc.querySelectorAll('button,input[type="button"],input[type="submit"],a[role="button"]');
      for(const node of nodes){
        if(node.disabled) continue;
        const label = (((node.textContent || "") + " " + (node.value || "") + " " + (node.getAttribute("aria-label") || "")).trim()).toLowerCase();
        if(!label) continue;
        if(
          label.includes("generate") ||
          label.includes("try me") ||
          label.includes("regenerate") ||
          label.includes("create") ||
          label.includes("build")
        ){
          node.click();
          return true;
        }
      }
      return false;
    }

    function walkAndGenerate(win, depth){
      if(!win || depth > 7) return false;
      let clicked = false;
      try{
        const doc = win.document;
        clicked = clickGenerateInDoc(doc) || clicked;
        const iframes = doc.querySelectorAll("iframe");
        for(const fr of iframes){
          try{ clicked = walkAndGenerate(fr.contentWindow, depth + 1) || clicked; }
          catch(err){}
        }
      }catch(err){}
      return clicked;
    }

    function loadFresh(){
      const url = new URL(encodeURI(SOURCE), window.location.href);
      url.searchParams.set("seed", Date.now().toString(36) + Math.random().toString(36).slice(2,8));
      frame.dataset.autoGenerate = "1";
      status.textContent = "Loading preview...";
      frame.src = url.toString();
    }

    frame.addEventListener("load", function(){
      if(frame.dataset.autoGenerate !== "1"){
        status.textContent = "Preview loaded.";
        return;
      }

      frame.dataset.autoGenerate = "0";
      let finished = false;
      [260, 900, 1700].forEach(function(ms, idx){
        setTimeout(function(){
          if(finished) return;
          const clicked = walkAndGenerate(frame.contentWindow, 0);
          if(clicked){
            finished = true;
            status.textContent = "Generated preview.";
          }else if(idx === 2){
            status.textContent = "Preview loaded.";
          }
        }, ms);
      });
    });

    btnGen.addEventListener("click", loadFresh);

    btnPrint.addEventListener("click", function(){
      try{
        const clicked = walkAndGenerate(frame.contentWindow, 0);
        if(clicked){
          setTimeout(function(){ frame.contentWindow.print(); }, 260);
        }else{
          frame.contentWindow.print();
        }
      }catch(err){
        status.textContent = "Print is blocked in this preview.";
      }
    });

    syncPreviewRatio();
    loadFresh();
  })();
</script>
</body>
</html>
